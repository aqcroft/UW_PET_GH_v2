<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>UW Partner Earnings Tool</title>
<script src="https://cdn.tailwindcss.com"></script>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<style>
  @keyframes slideDown { 0%{opacity:0;transform:scale(0.95)} 100%{opacity:1;transform:scale(1)} }
  @keyframes confetti { 0%{transform:translateY(0) rotate(0deg);opacity:1} 100%{transform:translateY(100vh) rotate(360deg);opacity:0} }
  @keyframes bounceOnce { 0%,100%{transform:translateY(0)} 25%{transform:translateY(-20px)} 50%{transform:translateY(0)} 75%{transform:translateY(-10px)} }
  @keyframes pulseTwice { 0%,100%{transform:scale(1);opacity:1} 25%{transform:scale(1.4);opacity:0.65} 50%{transform:scale(1);opacity:1} 75%{transform:scale(1.4);opacity:0.65} }
  @keyframes tabPulse { 0%,100%{box-shadow:3px 0 14px rgba(124,58,237,0.35)} 25%{box-shadow:3px 0 26px rgba(219,39,119,0.8)} 50%{box-shadow:3px 0 14px rgba(124,58,237,0.35)} 75%{box-shadow:3px 0 26px rgba(219,39,119,0.8)} }
  @keyframes coachFadeIn { 0%{opacity:0;transform:translateY(4px)} 100%{opacity:1;transform:translateY(0)} }
  @keyframes coachFadeOut { 0%{opacity:1} 100%{opacity:0} }
  @keyframes arrowBounce { 0%,100%{transform:translateX(0)} 50%{transform:translateX(4px)} }
  .animate-slideDown { animation: slideDown 0.2s ease-out forwards; }
  .animate-confetti { animation: confetti 3s ease-in forwards; }
  .animate-bounceOnce { animation: bounceOnce 0.6s ease-in-out; }
  .pulse-twice { animation: pulseTwice 0.9s ease-in-out 1 forwards; }
  .tab-pulse { animation: tabPulse 0.9s ease-in-out 2; }
  .coach-in { animation: coachFadeIn 0.4s ease-out forwards; }
  .coach-out { animation: coachFadeOut 0.4s ease-in forwards; }
  .arrow-bounce { animation: arrowBounce 0.7s ease-in-out infinite; }
  * { box-sizing: border-box; }
  @media (orientation: landscape) and (max-height: 500px) {
    .accordion-list { display: grid !important; grid-template-columns: 1fr 1fr !important; gap: 0.4rem !important; align-items: start !important; }
    .accordion-list > div { overflow: visible !important; }
  }
  .profile-bubble-wrap { position:fixed; top:0.75rem; right:0.75rem; z-index:100; display:flex; flex-direction:column; align-items:flex-end; gap:0.3rem; }
  .profile-photo-btn { width:3.25rem; height:3.25rem; border-radius:50%; overflow:hidden; border:2.5px solid #fff; box-shadow:0 4px 16px rgba(124,58,237,0.35),0 2px 6px rgba(0,0,0,0.18); cursor:pointer; background:linear-gradient(135deg,#7c3aed,#db2777); display:flex; align-items:center; justify-content:center; transition:transform 0.18s; flex-shrink:0; align-self:flex-end; }
  .profile-photo-btn:hover { transform:scale(1.07); }
  .profile-photo-btn img { width:100%; height:100%; object-fit:cover; }
  .profile-photo-btn .initials { color:white; font-weight:800; font-size:1.1rem; letter-spacing:-0.02em; }
  .bubble-name-wrap { text-align:right; transition:opacity 0.35s ease,max-height 0.35s ease,margin 0.35s ease; max-height:3rem; overflow:hidden; margin-bottom:0; }
  .bubble-name-wrap.hidden { opacity:0; max-height:0; pointer-events:none; margin-bottom:-0.3rem; }
  .bubble-name-primary { font-size:0.78rem; font-weight:700; color:#1f2937; line-height:1.3; }
  .bubble-name-secondary { font-size:0.68rem; color:#6b7280; line-height:1.3; }
  .fab-actions { display:flex; flex-direction:column; align-items:flex-end; gap:0.4rem; max-height:0; opacity:0; overflow:hidden; transform:translateY(-12px); transition:max-height 0.35s ease,opacity 0.3s ease,transform 0.3s ease; }
  .fab-actions.open { max-height:16rem; opacity:1; transform:translateY(0); }
  .fab-action-btn { display:flex; align-items:center; gap:0.45rem; padding:0.45rem 0.75rem; border-radius:2rem; border:none; cursor:pointer; font-size:0.8rem; font-weight:700; white-space:nowrap; background:white; color:#1f2937; text-decoration:none; transition:transform 0.15s; }
  .fab-action-btn:hover { transform:scale(1.04); }
  .fab-btn-jumpin { box-shadow:3px 3px 10px rgba(109,40,217,0.3); }
  .fab-btn-bookin { box-shadow:3px 3px 10px rgba(168,85,247,0.3); }
  .fab-btn-sayhi  { box-shadow:3px 3px 10px rgba(219,39,119,0.3); }
  .fab-icon { font-size:1rem; line-height:1; }
  .sayhi-icons-row { display:flex; justify-content:flex-end; gap:0.4rem; max-height:0; opacity:0; overflow:hidden; transform:translateY(-6px); transition:max-height 0.3s ease,opacity 0.25s ease,transform 0.25s ease; }
  .sayhi-icons-row.open { max-height:3rem; opacity:1; transform:translateY(0); }
  .fab-icon-circle { width:2.2rem; height:2.2rem; border-radius:50%; background:white; border:1.5px solid #e5e7eb; box-shadow:2px 2px 8px rgba(219,39,119,0.2); display:flex; align-items:center; justify-content:center; cursor:pointer; flex-shrink:0; text-decoration:none; transition:transform 0.15s,background 0.15s; }
  .fab-icon-circle:hover { transform:scale(1.1); background:#fdf2f8; }
  .fab-icon-circle svg { width:1rem; height:1rem; }
  .contact-panel-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.35); opacity:0; pointer-events:none; transition:opacity 0.35s ease; z-index:150; }
  .contact-panel-overlay.visible { opacity:1; pointer-events:auto; }
  .contact-panel { position:fixed; top:0; left:0; height:100%; width:min(22rem,88vw); background:white; box-shadow:6px 0 32px rgba(0,0,0,0.22); transform:translateX(-100%); transition:transform 0.38s cubic-bezier(0.4,0,0.2,1); z-index:151; display:flex; flex-direction:column; overflow-y:auto; }
  .contact-panel.open { transform:translateX(0); }
  .left-pull-tab { position:fixed; top:50%; left:0; transform:translateY(-50%); z-index:152; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:0.2rem; color:white; border-radius:0 0.6rem 0.6rem 0; padding:0.7rem 0.45rem; cursor:pointer; transition:transform 0.38s cubic-bezier(0.4,0,0.2,1),box-shadow 0.2s,background 0.4s; user-select:none; }
  .left-pull-tab.tab-grey { background:#9ca3af; box-shadow:3px 0 10px rgba(0,0,0,0.15); }
  .left-pull-tab.tab-coloured { background:linear-gradient(135deg,#7c3aed,#db2777); box-shadow:3px 0 14px rgba(124,58,237,0.35); }
  .left-pull-tab:hover { filter:brightness(1.08); }
  .left-pull-tab.panel-open { transform:translateY(-50%) translateX(min(22rem,88vw)); }
  .pull-tab-emoji { font-size:1.15rem; line-height:1; margin-bottom:0.3rem; }
  .pull-tab-label { writing-mode:vertical-rl; text-orientation:mixed; font-size:0.6rem; font-weight:800; letter-spacing:0.06em; text-transform:uppercase; line-height:1.2; }
  .intro-modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center; z-index:300; padding:1rem; }
  .tooltip-wrap { position:relative; display:inline-flex; align-items:center; }
  .tooltip-box { position:absolute; bottom:calc(100% + 8px); left:50%; transform:translateX(-50%); background:#4b5563; color:white; font-size:0.75rem; border-radius:0.5rem; padding:0.5rem 0.75rem; max-width:260px; white-space:normal; text-align:center; line-height:1.5; z-index:400; box-shadow:0 4px 14px rgba(0,0,0,0.22); pointer-events:none; }
  .tooltip-box::after { content:''; position:absolute; top:100%; left:50%; transform:translateX(-50%); border:5px solid transparent; border-top-color:#4b5563; }
  .coaching-lane { border-radius:0.6rem; padding:0.65rem 0.9rem; margin-bottom:0.85rem; min-height:2.8rem; display:flex; align-items:center; gap:0.5rem; transition:border-color 0.3s,background 0.3s; }
  .coaching-lane.inactive { border:1.5px dashed #d1d5db; background:#f9fafb; }
  .coaching-lane.active { border:1.5px solid #c4b5fd; background:linear-gradient(135deg,#f5f3ff,#eff6ff); }
  .revenue-panel { border-radius:0.75rem; border:2px solid #e5e7eb; overflow:hidden; }
  .revenue-panel.locked { border-color:#e5e7eb; }
  .revenue-panel.unlocked { border-color:#a78bfa; }
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useRef, useCallback, useEffect } = React;

const CONTACT = {
  displayName:'Adrian', fullName:'Adrian Croft', title:'UW Partner',
  photoUrl:'https://raw.githubusercontent.com/aqcroft/UW_PET_GH_v2/main/Adrian_Croft.jpg',
  whatsappNumber:'447787400800',
  whatsappMessage:"Hi Adrian, I've just used your earnings tool and I'd like to know more",
  email:'adrian.croft@uw.partners', emailSubject:'Your UW earnings tool',
  emailBody:"Hi Adrian, I've just used your earnings tool and I'd like to know more",
  phone:'+447787400800', calendarUrl:'https://tidycal.com/aqcroft/uwcost',
  registrationUrl:'https://uw.partners/adrian.croft/partner/join',
  savingsUrl:'https://uw.partners/adrian.croft/join',
};
const whatsappUrl=()=>`https://wa.me/${CONTACT.whatsappNumber}?text=${encodeURIComponent(CONTACT.whatsappMessage)}`;
const emailUrl=()=>`mailto:${CONTACT.email}?subject=${encodeURIComponent(CONTACT.emailSubject)}&body=${encodeURIComponent(CONTACT.emailBody)}`;
const phoneUrl=()=>`tel:${CONTACT.phone}`;

/* â”€â”€ SVG Icons â”€â”€ */
const TrendingUp=({style})=>(<svg style={style||{width:'1rem',height:'1rem',flexShrink:0}} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/></svg>);
const RefreshCw=({style})=>(<svg style={style||{width:'1rem',height:'1rem',flexShrink:0}} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>);
const Lock=({style})=>(<svg style={style||{width:'1rem',height:'1rem',flexShrink:0}} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>);
const X=({style})=>(<svg style={style||{width:'1rem',height:'1rem',flexShrink:0}} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12"/></svg>);
const ChevronDown=({style})=>(<svg style={style||{width:'1rem',height:'1rem',flexShrink:0}} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7"/></svg>);
const ChevronUp=({style})=>(<svg style={style||{width:'1rem',height:'1rem',flexShrink:0}} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 15l7-7 7 7"/></svg>);
const SM={width:'1rem',height:'1rem',flexShrink:0};
const MD={width:'1.25rem',height:'1.25rem',flexShrink:0};
const XS={width:'0.875rem',height:'0.875rem',flexShrink:0};

/* â”€â”€ Pulsing ğŸ’¡ emoji (global rule: pulse twice, never loop) â”€â”€ */
const PulsingBulb=({size='1rem',onDone})=>{
  const [pulsing,setPulsing]=useState(true);
  useEffect(()=>{const t=setTimeout(()=>{setPulsing(false);if(onDone)onDone();},950);return()=>clearTimeout(t);},[]);
  return <span className={pulsing?'pulse-twice':''} style={{display:'inline-flex',alignItems:'center',fontSize:size,lineHeight:1}}>ğŸ’¡</span>;
};

/* â”€â”€ Static ğŸ’¡ (no pulse) â”€â”€ */
const Bulb=({size='1rem'})=><span style={{fontSize:size,lineHeight:1,flexShrink:0}}>ğŸ’¡</span>;

/* â”€â”€ Icon helpers â”€â”€ */
const WaIcon=()=>(<svg viewBox="0 0 24 24" fill="#374151" style={{width:'1.15rem',height:'1.15rem'}}><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>);
const EmailIcon=()=>(<svg viewBox="0 0 24 24" fill="none" stroke="#374151" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={{width:'1.15rem',height:'1.15rem'}}><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>);
const PhoneIcon=()=>(<svg viewBox="0 0 24 24" fill="none" stroke="#374151" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={{width:'1.15rem',height:'1.15rem'}}><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07A19.5 19.5 0 013.07 9.81a19.79 19.79 0 01-3.07-8.69A2 2 0 012.18 1h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L6.91 8.09a16 16 0 006 6l.56-.56a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 16.92z"/></svg>);

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ITEM 1 â€” INTRO MODAL (gradient header band)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const IntroModal=({onClose})=>(
  <div className="intro-modal-overlay">
    <div className="animate-slideDown" style={{background:'white',borderRadius:'1rem',overflow:'hidden',maxWidth:'26rem',width:'100%',boxShadow:'0 20px 60px rgba(0,0,0,0.35)'}}>
      {/* Gradient header band */}
      <div style={{background:'linear-gradient(135deg,#7c3aed,#db2777)',padding:'1.4rem 1.5rem 1.2rem',textAlign:'center'}}>
        <div style={{fontSize:'1.5rem',marginBottom:'0.3rem'}}>ğŸ‘‹</div>
        <h2 style={{fontSize:'1.35rem',fontWeight:'800',color:'white',margin:'0 0 0.1rem',lineHeight:1.25}}>Welcome to this</h2>
        <h2 style={{fontSize:'1.35rem',fontWeight:'800',color:'white',margin:0,lineHeight:1.25}}>interactive earnings tool</h2>
      </div>
      {/* Body */}
      <div style={{padding:'1.25rem 1.5rem 1.5rem',textAlign:'center'}}>
        {/* Gold subheading */}
        <p style={{fontWeight:'700',color:'#92400e',fontSize:'0.95rem',margin:'0 0 1.1rem',background:'#fefce8',padding:'0.5rem 0.75rem',borderRadius:'0.5rem',border:'1px solid #fde68a'}}>
          5 conversations up to Â£2000? Explore how
        </p>
        <p style={{fontSize:'0.875rem',color:'#374151',margin:'0 0 0.7rem',lineHeight:1.65}}>
          UW Partners help people save on essential services they already use: broadband, energy and mobile.
        </p>
        <p style={{fontSize:'0.875rem',color:'#374151',margin:'0 0 0.7rem',lineHeight:1.65,fontWeight:'700'}}>
          Bundles build benefits â€” for customers and Partners.<br/>When customers win, Partners win. ğŸ†
        </p>
        <p style={{fontSize:'0.875rem',color:'#374151',margin:'0 0 0.85rem',lineHeight:1.65}}>
          Add customers and watch the numbers change.
        </p>
        {/* Item 2 lightbulb line: dark grey, bold italic */}
        <p style={{fontSize:'0.875rem',color:'#374151',fontWeight:'700',fontStyle:'italic',margin:'0 0 1.4rem',lineHeight:1.5}}>
          ğŸ’¡ Explore, experiment and learn as you play.
        </p>
        <button onClick={onClose} style={{width:'100%',padding:'0.85rem',background:'linear-gradient(135deg,#7c3aed,#db2777)',border:'none',borderRadius:'0.6rem',color:'white',fontWeight:'800',fontSize:'1.05rem',cursor:'pointer',boxShadow:'0 4px 14px rgba(124,58,237,0.4)'}}>
          Let's go ğŸš€
        </button>
      </div>
    </div>
  </div>
);

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ITEM 4 â€” COACHING LANE (fixed area below circles)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const CoachingLane=({message,showArrow,arrowTargetIndex})=>{
  const [visible,setVisible]=useState(false);
  const [displayed,setDisplayed]=useState(null);
  const [fading,setFading]=useState(false);
  const timerRef=useRef(null);

  const show=(msg)=>{
    if(timerRef.current)clearTimeout(timerRef.current);
    setFading(false);setDisplayed(msg);setVisible(true);
    // auto-dismiss after 6s (not for partner prompt â€” handled externally)
    if(!showArrow){
      timerRef.current=setTimeout(()=>{setFading(true);setTimeout(()=>{setVisible(false);setDisplayed(null);setFading(false);},400);},6000);
    }
  };

  useEffect(()=>{
    if(message){show(message);}
    else{setFading(true);setTimeout(()=>{setVisible(false);setDisplayed(null);setFading(false);},400);}
    return()=>{if(timerRef.current)clearTimeout(timerRef.current);};
  },[message]);

  const isActive=visible&&displayed;
  return(
    <div className={`coaching-lane ${isActive?'active':'inactive'}`} style={{position:'relative'}}>
      {!isActive&&(
        <span style={{fontSize:'0.85rem',filter:'grayscale(1)',opacity:0.4,lineHeight:1}}>ğŸ’¡</span>
      )}
      {isActive&&(
        <span className={fading?'coach-out':'coach-in'} style={{display:'flex',alignItems:'flex-start',gap:'0.45rem',width:'100%'}}>
          <span style={{fontSize:'0.95rem',lineHeight:1,flexShrink:0,marginTop:'0.05rem'}}>ğŸ’¡</span>
          <span style={{fontSize:'0.82rem',fontWeight:'700',fontStyle:'italic',color:'#374151',lineHeight:1.5,flex:1}}>{displayed}</span>
          {showArrow&&(
            <span className="arrow-bounce" style={{fontSize:'0.9rem',color:'#92400e',flexShrink:0}}>â†’</span>
          )}
        </span>
      )}
    </div>
  );
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONTACT PANEL + LEFT TAB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const ContactPanel=({grandTotal,isOpen,onClose,tabColoured,onTabClick})=>{
  const initials=CONTACT.fullName.split(' ').map(n=>n[0]).join('').slice(0,2);
  const [tabPulseKey,setTabPulseKey]=useState(0);
  const prevTabColoured=useRef(false);
  useEffect(()=>{
    if(tabColoured&&!prevTabColoured.current){
      // delay pulse so it fires after celebration visuals finish (item 10)
      setTimeout(()=>setTabPulseKey(k=>k+1),500);
    }
    prevTabColoured.current=tabColoured;
  },[tabColoured]);
  const tabClass=`left-pull-tab${isOpen?' panel-open':''} ${tabColoured?'tab-coloured':'tab-grey'}`;
  return(
    <>
      <div className={`contact-panel-overlay${isOpen?' visible':''}`} onClick={onClose}/>
      <div key={`tab-${tabPulseKey}`} className={`${tabClass}${tabPulseKey>0?' tab-pulse':''}`} onClick={onTabClick}>
        <span className="pull-tab-emoji" style={{filter:tabColoured?'none':'grayscale(1)'}}>
          {isOpen?'âœ•':tabColoured?'âœ¨':'ğŸ‘‹'}
        </span>
        <span className="pull-tab-label">{isOpen?'Close':tabColoured?'Next Steps':'Get in touch'}</span>
      </div>
      <div className={`contact-panel${isOpen?' open':''}`}>
        <div style={{background:'linear-gradient(135deg,rgba(124,58,237,0.75),rgba(219,39,119,0.75))',padding:'1.6rem 1.25rem 1.3rem',textAlign:'center',position:'relative',flexShrink:0}}>
          <button onClick={onClose} style={{position:'absolute',top:'0.75rem',right:'0.75rem',width:'1.75rem',height:'1.75rem',borderRadius:'50%',background:'rgba(255,255,255,0.15)',border:'none',cursor:'pointer',color:'rgba(255,255,255,0.8)',fontSize:'0.9rem',display:'flex',alignItems:'center',justifyContent:'center'}}>âœ•</button>
          <img src={CONTACT.photoUrl} alt={CONTACT.fullName} style={{width:'4rem',height:'4rem',borderRadius:'50%',border:'2.5px solid rgba(255,255,255,0.7)',objectFit:'cover',margin:'0 auto 0.5rem',display:'block'}} onError={e=>{e.currentTarget.style.display='none';e.currentTarget.nextSibling.style.display='flex';}}/>
          <div style={{width:'4rem',height:'4rem',borderRadius:'50%',border:'2.5px solid rgba(255,255,255,0.7)',background:'rgba(124,58,237,0.6)',margin:'0 auto 0.5rem',display:'none',alignItems:'center',justifyContent:'center',fontWeight:'800',fontSize:'1.2rem',color:'white'}}>{initials}</div>
          <p style={{color:'white',fontWeight:'700',fontSize:'0.85rem',margin:'0 0 0.75rem',lineHeight:1.3}}>{CONTACT.fullName} Â· {CONTACT.title}</p>
          <span style={{color:'rgba(255,255,255,0.85)',fontWeight:'700',fontSize:'0.95rem',display:'block',marginBottom:'0.2rem'}}>What would an extra</span>
          <span style={{display:'block',fontWeight:'800',fontSize:'0.95rem',marginBottom:'0.45rem',lineHeight:'1.3'}}>
            <span style={{color:'#fde68a'}}>Â£{grandTotal.toLocaleString()} </span>
            <span style={{color:'rgba(255,255,255,0.85)'}}>mean to you?</span>
          </span>
          <span style={{color:'rgba(255,255,255,0.72)',fontSize:'0.82rem',fontStyle:'italic',lineHeight:'1.4',display:'block'}}>Are you ready to make it happen?</span>
        </div>
        <div style={{padding:'1rem',display:'flex',flexDirection:'column',gap:'0.5rem',flex:1}}>
          {/* 1. Jump in */}
          <a href={CONTACT.registrationUrl} target="_blank" rel="noopener noreferrer" style={{minHeight:'5.5rem',borderRadius:'0.75rem',display:'flex',alignItems:'center',gap:'0.7rem',padding:'0.8rem 0.9rem',background:'white',boxShadow:'3px 3px 10px rgba(109,40,217,0.3)',textDecoration:'none',transition:'transform 0.15s'}} onMouseEnter={e=>e.currentTarget.style.transform='scale(1.02)'} onMouseLeave={e=>e.currentTarget.style.transform='scale(1)'} onClick={onClose}>
            <span style={{fontSize:'1.3rem',lineHeight:1,flexShrink:0}}>ğŸ”¥</span>
            <span style={{flex:1}}><span style={{fontWeight:'700',fontSize:'0.9rem',display:'block',color:'#1f2937'}}>Jump in</span><span style={{fontSize:'0.73rem',marginTop:'0.2rem',display:'block',fontStyle:'italic',lineHeight:'1.35',color:'#6b7280'}}>"I'm ready to get registered and start earning"</span></span>
          </a>
          {/* 2. Book in */}
          <a href={CONTACT.calendarUrl} target="_blank" rel="noopener noreferrer" style={{minHeight:'5.5rem',borderRadius:'0.75rem',display:'flex',alignItems:'center',gap:'0.7rem',padding:'0.8rem 0.9rem',background:'white',boxShadow:'3px 3px 10px rgba(168,85,247,0.3)',textDecoration:'none',transition:'transform 0.15s'}} onMouseEnter={e=>e.currentTarget.style.transform='scale(1.02)'} onMouseLeave={e=>e.currentTarget.style.transform='scale(1)'} onClick={onClose}>
            <span style={{fontSize:'1.3rem',lineHeight:1,flexShrink:0}}>ğŸ—“ï¸</span>
            <span style={{flex:1}}><span style={{fontWeight:'700',fontSize:'0.9rem',display:'block',color:'#1f2937'}}>Book in</span><span style={{fontSize:'0.73rem',marginTop:'0.2rem',display:'block',fontStyle:'italic',lineHeight:'1.35',color:'#6b7280'}}>"I've got questions and I'd love a chat"</span></span>
          </a>
          {/* 3. Explore Savings â€” item 11: third position */}
          <a href={CONTACT.savingsUrl} target="_blank" rel="noopener noreferrer" style={{minHeight:'5.5rem',borderRadius:'0.75rem',display:'flex',alignItems:'center',gap:'0.7rem',padding:'0.8rem 0.9rem',background:'white',boxShadow:'3px 3px 10px rgba(234,179,8,0.3)',textDecoration:'none',transition:'transform 0.15s'}} onMouseEnter={e=>e.currentTarget.style.transform='scale(1.02)'} onMouseLeave={e=>e.currentTarget.style.transform='scale(1)'} onClick={onClose}>
            <span style={{fontSize:'1.3rem',lineHeight:1,flexShrink:0}}>ğŸ’¡</span>
            <span style={{flex:1}}><span style={{fontWeight:'700',fontSize:'0.9rem',display:'block',color:'#1f2937'}}>Explore Savings</span><span style={{fontSize:'0.73rem',marginTop:'0.2rem',display:'block',fontStyle:'italic',lineHeight:'1.35',color:'#6b7280'}}>See how much you could save as a customer.</span></span>
          </a>
          {/* 4. Say hi */}
          <div style={{borderRadius:'0.75rem',background:'white',boxShadow:'3px 3px 10px rgba(219,39,119,0.3)',padding:'0.8rem 0.9rem 0.85rem'}}>
            <div style={{display:'flex',alignItems:'center',gap:'0.7rem',marginBottom:'0.65rem'}}>
              <span style={{fontSize:'1.3rem',lineHeight:1,flexShrink:0}}>ğŸ‘‹</span>
              <span style={{flex:1}}><span style={{fontWeight:'700',fontSize:'0.9rem',display:'block',color:'#1f2937'}}>Say hi</span><span style={{fontSize:'0.73rem',marginTop:'0.2rem',display:'block',fontStyle:'italic',lineHeight:'1.35',color:'#6b7280'}}>"I'd love help with my next step"</span></span>
            </div>
            <div style={{display:'flex',gap:'0.6rem',justifyContent:'center'}}>
              {[{href:whatsappUrl(),icon:<WaIcon/>,title:'WhatsApp'},{href:emailUrl(),icon:<EmailIcon/>,title:'Email'},{href:phoneUrl(),icon:<PhoneIcon/>,title:'Call'}].map(btn=>(
                <a key={btn.title} href={btn.href} target="_blank" rel="noopener noreferrer" title={btn.title} style={{width:'2.5rem',height:'2.5rem',borderRadius:'50%',background:'#f3f4f6',border:'1.5px solid #e5e7eb',display:'flex',alignItems:'center',justifyContent:'center',cursor:'pointer',transition:'background 0.15s,transform 0.15s',flexShrink:0,textDecoration:'none'}} onMouseEnter={e=>{e.currentTarget.style.background='#e5e7eb';e.currentTarget.style.transform='scale(1.1)';}} onMouseLeave={e=>{e.currentTarget.style.background='#f3f4f6';e.currentTarget.style.transform='scale(1)';}} onClick={onClose}>{btn.icon}</a>
              ))}
            </div>
          </div>
        </div>
      </div>
    </>
  );
};

/* â”€â”€ Profile Bubble (unchanged) â”€â”€ */
const ProfileBubble=()=>{
  const [open,setOpen]=useState(false);
  const [sayhiOpen,setSayhiOpen]=useState(false);
  const toggle=()=>{const n=!open;setOpen(n);if(!n)setSayhiOpen(false);};
  return(
    <div className="profile-bubble-wrap">
      <button className="profile-photo-btn" onClick={toggle} aria-label={open?'Close menu':'Open menu'}>
        <img src={CONTACT.photoUrl} alt={CONTACT.fullName} onError={e=>{e.currentTarget.style.display='none';e.currentTarget.nextSibling.style.display='flex';}}/>
        <span className="initials" style={{display:'none'}}>{CONTACT.fullName.split(' ').map(n=>n[0]).join('').slice(0,2)}</span>
      </button>
      <div className={`bubble-name-wrap${open?' hidden':''}`}><div className="bubble-name-primary">{CONTACT.fullName}</div><div className="bubble-name-secondary">{CONTACT.title}</div></div>
      <div className={`fab-actions${open?' open':''}`}>
        <a href={CONTACT.registrationUrl} target="_blank" rel="noopener noreferrer" className="fab-action-btn fab-btn-jumpin" onClick={()=>setOpen(false)}><span className="fab-icon">ğŸ”¥</span><span>Jump in</span></a>
        <a href={CONTACT.calendarUrl} target="_blank" rel="noopener noreferrer" className="fab-action-btn fab-btn-bookin" onClick={()=>setOpen(false)}><span className="fab-icon">ğŸ—“ï¸</span><span>Book in</span></a>
        <div style={{display:'flex',flexDirection:'column',alignItems:'flex-end',gap:'0.3rem'}}>
          <button className="fab-action-btn fab-btn-sayhi" onClick={e=>{e.stopPropagation();setSayhiOpen(s=>!s);}}><span className="fab-icon">ğŸ‘‹</span><span>Say hi</span></button>
          <div className={`sayhi-icons-row${sayhiOpen?' open':''}`}>
            <a href={whatsappUrl()} target="_blank" rel="noopener noreferrer" className="fab-icon-circle"><svg viewBox="0 0 24 24" fill="#374151"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg></a>
            <a href={emailUrl()} className="fab-icon-circle"><svg viewBox="0 0 24 24" fill="none" stroke="#374151" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a>
            <a href={phoneUrl()} className="fab-icon-circle"><svg viewBox="0 0 24 24" fill="none" stroke="#374151" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07A19.5 19.5 0 013.07 9.81a19.79 19.79 0 01-3.07-8.69A2 2 0 012.18 1h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L6.91 8.09a16 16 0 006 6l.56-.56a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 16.92z"/></svg></a>
          </div>
        </div>
      </div>
    </div>
  );
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ITEM 18 â€” INFO ACCORDION (Recurring Income fixed)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const box={background:'#f5f3ff',borderRadius:'0.5rem',padding:'0.75rem',marginBottom:'0.5rem'};
const closing={fontStyle:'italic',fontWeight:'700',color:'#374151',margin:0};
const scbSummary=(isOpen)=>(<span>Upfront payment when we support a Partner to introduce a homeowner.{' '}<span style={{fontStyle:'italic',fontSize:'0.72rem',color:'#7c3aed',opacity:isOpen?1:0,transition:'opacity 0.15s'}}>ğŸ”“ Unlocks at 6 Personal Customers.</span></span>);
const mbSummary=(isOpen)=>(<span>Up to Â£400 when a Partner we introduce reaches QD*.<br/><span style={{fontStyle:'italic',fontSize:'0.72rem',color:'#7c3aed',opacity:isOpen?1:0,transition:'opacity 0.15s'}}>ğŸ”“ Unlocks at 3 Personal Customers.</span></span>);

const sections=[
  {id:'cb',icon:<span style={{fontSize:'1.1rem'}}>ğŸ’·</span>,title:'Customer Bonus',summary:'Upfront payment when we introduce a homeowner customer.',
    detail:(<div style={{fontSize:'0.875rem',color:'#374151'}}><p style={{marginBottom:'0.5rem'}}>Paid when services go live:</p><div style={{...box,display:'grid',gridTemplateColumns:'1fr 1fr',gap:'0.25rem'}}><span>1ï¸âƒ£ service â€” Â£50</span><span>3ï¸âƒ£ services â€” Â£250</span><span>2ï¸âƒ£ services â€” Â£100</span><span>4ï¸âƒ£ services â€” Â£300</span></div><p style={closing}>ğŸ’¡ The more customers we introduce, the more we earn.</p></div>)},
  {id:'hab',icon:<span style={{fontSize:'1.1rem'}}>ğŸ”¥</span>,title:'High Activity Bonus',summary:'Extra reward for multiple 3+ service homeowners in one calendar month.',
    detail:(<div style={{fontSize:'0.875rem',color:'#374151'}}><p style={{marginBottom:'0.5rem'}}>On top of Customer Bonus:</p><div style={box}><div>2ï¸âƒ£ or more homeowners â€” Â£50 each</div><div>4ï¸âƒ£ or more homeowners â€” Â£100 each</div></div><p style={closing}>ğŸ’¡ With Customer Bonus that's up to Â£400 per homeowner.</p></div>)},
  {id:'ri',icon:<RefreshCw style={{...SM,color:'#2563eb'}}/>,title:'Recurring (Residual) Income',summary:"Ongoing monthly income from our personal customers and our team's customers.",
    detail:(<div style={{fontSize:'0.875rem',color:'#374151'}}>
      <p style={{marginBottom:'0.5rem'}}>A recurring profit share of customers' bills which increases as customers add more services.</p>
      <div style={{...box,marginBottom:'0.5rem'}}>
        {/* Item 18: single unlock at QD/3 customers, personal first, then team */}
        <p style={{fontStyle:'italic',fontSize:'0.72rem',color:'#7c3aed',margin:'0 0 0.5rem',lineHeight:'1.3'}}>ğŸ”“ Unlocks at 3 personal customers (QD)</p>
        <p style={{margin:'0 0 0.35rem',display:'flex',alignItems:'center',gap:'0.3rem'}}><RefreshCw style={{width:'0.75rem',height:'0.75rem',flexShrink:0,color:'#2563eb'}}/><span style={{fontSize:'0.8rem'}}>ğŸ‘¤</span><strong>Personal Customers</strong><span style={{fontWeight:'400',fontStyle:'italic',color:'#6b7280',fontSize:'0.8rem'}}>â€” % of bill, typically</span></p>
        <div style={{marginBottom:'0.4rem',paddingLeft:'0.25rem'}}>
          <div>â€¢ Tenant â€” Â£2â€“Â£3 /month <span style={{color:'#6b7280',fontSize:'0.72rem'}}>(after first bill paid)</span></div>
          <div>â€¢ Homeowner â€” Â£3â€“Â£5 /month <span style={{color:'#6b7280',fontSize:'0.72rem'}}>(after a set period)</span></div>
        </div>
        <div style={{borderTop:'1px solid #c4b5fd',paddingTop:'0.4rem'}}>
          <p style={{margin:'0 0 0.35rem',display:'flex',alignItems:'center',gap:'0.3rem'}}><RefreshCw style={{width:'0.75rem',height:'0.75rem',flexShrink:0,color:'#2563eb'}}/><span style={{fontSize:'0.8rem'}}>ğŸ‘¥</span><strong>Team (Group) Customers</strong><span style={{fontWeight:'400',fontStyle:'italic',color:'#6b7280',fontSize:'0.8rem'}}>â€” pence per service, typically</span></p>
          <div style={{paddingLeft:'0.25rem'}}>â€¢ 30â€“50p /month per customer</div>
        </div>
      </div>
      <p style={closing}>ğŸ’¡ Grows steadily as our customers and team expand.</p>
    </div>)},
  {id:'scb',icon:<span style={{fontSize:'1.1rem'}}>ğŸ¤</span>,title:'Supporting Customer Bonus â€ ',summary:scbSummary,
    detail:(<div style={{fontSize:'0.875rem',color:'#374151'}}><p style={{marginBottom:'0.5rem'}}>We receive <strong>50%</strong> of the full Customer Bonus.</p><div style={{...box,fontSize:'0.8rem',marginBottom:'0.5rem'}}><div style={{marginBottom:'0.25rem'}}>â±ï¸ <strong>First 45 days</strong> â€” in addition to their Customer Bonus</div><div style={{marginBottom:'0.4rem'}}>â¡ï¸ <strong>After 45 days</strong> â€” Customer Bonus is shared 50:50</div><div style={{borderTop:'1px solid #c4b5fd',paddingTop:'0.4rem',display:'grid',gridTemplateColumns:'1fr 1fr',gap:'0.25rem'}}><span>1ï¸âƒ£ service â€” Â£25</span><span>3ï¸âƒ£ services â€” Â£125</span><span>2ï¸âƒ£ services â€” Â£50</span><span>4ï¸âƒ£ services â€” Â£150</span></div></div><p style={closing}>ğŸ’¡ An extra income stream from helping Partners introduce homeowners.</p></div>)},
  {id:'mb',icon:<span style={{fontSize:'1.1rem'}}>ğŸ“</span>,title:'Mentor Bonus â€ ',summary:mbSummary,
    detail:(<div style={{fontSize:'0.875rem',color:'#374151'}}><p style={{marginBottom:'0.5rem',fontWeight:'600'}}>QD* = 3 Personal Customers + 1 Partner introduced</p><div style={box}><div style={{display:'flex',alignItems:'center',gap:'0.4rem'}}><span>ğŸ“</span><span>Mentor Bonus â€” Â£100</span></div><div style={{display:'flex',alignItems:'center',gap:'0.4rem',marginTop:'0.25rem'}}><TrendingUp style={{width:'0.75rem',height:'0.75rem',color:'#374151'}}/><span>30 days Mentor Fast Starter Bonus â€” Â£300</span></div><div style={{borderTop:'1px solid #c4b5fd',marginTop:'0.5rem',paddingTop:'0.5rem',paddingLeft:'1.5rem'}}>Total â€” Â£400 per Partner</div></div><p style={closing}>ğŸ’¡ Rewarding us for developing new Partners â€” with even more for Fast Starter.</p></div>)},
];

const HowPaidPopup=({onClose})=>{
  const [openId,setOpenId]=useState(null);
  const headerRefs=useRef({});
  const toggle=useCallback((id)=>{const opening=openId!==id;setOpenId(opening?id:null);if(opening&&headerRefs.current[id])headerRefs.current[id].scrollIntoView({behavior:'instant',block:'start'});},[openId]);
  return(
    <div style={{position:'fixed',inset:0,background:'rgba(0,0,0,0.5)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:200,padding:'0.75rem'}} onClick={onClose}>
      <div style={{background:'white',borderRadius:'0.75rem',boxShadow:'0 20px 50px rgba(0,0,0,0.3)',maxWidth:'28rem',width:'100%',display:'flex',flexDirection:'column',height:'85vh'}} onClick={e=>e.stopPropagation()}>
        <div style={{padding:'1rem 1rem 0.6rem',borderBottom:'1px solid #f3f4f6',display:'flex',alignItems:'flex-start',justifyContent:'space-between',flexShrink:0}}>
          <div><h3 style={{fontSize:'1.05rem',fontWeight:'700',color:'#111827',margin:0}}>How Are UW Partners Paid?</h3><p style={{fontSize:'0.75rem',color:'#6b7280',marginTop:'0.2rem',marginBottom:0}}>We earn upfront income â€” and recurring income over time.</p></div>
          <button onClick={onClose} style={{marginLeft:'0.75rem',width:'1.75rem',height:'1.75rem',borderRadius:'50%',background:'#f3f4f6',border:'none',cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',flexShrink:0}}><X style={{...XS,color:'#4b5563'}}/></button>
        </div>
        <div className="accordion-list" style={{overflowY:'auto',flex:1,padding:'0.6rem',display:'flex',flexDirection:'column',gap:'0.4rem'}}>
          {sections.map(s=>{const isOpen=openId===s.id;return(
            <div key={s.id} style={{border:'1px solid #e5e7eb',borderRadius:'0.6rem',overflow:'hidden',background:'white'}}>
              <button ref={el=>headerRefs.current[s.id]=el} style={{width:'100%',display:'flex',alignItems:'center',gap:'0.6rem',padding:'0.6rem 0.75rem',textAlign:'left',background:'none',border:'none',cursor:'pointer'}} onClick={()=>toggle(s.id)}>
                <span style={{flexShrink:0,display:'flex',alignItems:'center'}}>{s.icon}</span>
                <div style={{flex:1,minWidth:0}}><p style={{fontWeight:'600',fontSize:'0.85rem',color:'#111827',margin:'0 0 0.1rem'}}>{s.title}</p><p style={{fontSize:'0.78rem',color:'#6b7280',margin:0,lineHeight:'1.4'}}>{typeof s.summary==='function'?s.summary(isOpen):s.summary}</p></div>
                {isOpen?<ChevronUp style={{...SM,color:'#9ca3af'}}/>:<ChevronDown style={{...SM,color:'#9ca3af'}}/>}
              </button>
              {isOpen&&<div style={{padding:'0.25rem 0.75rem 0.75rem',borderTop:'1px solid #f3f4f6',background:'#faf9ff'}}>{s.detail}</div>}
            </div>
          );})}
          <p style={{fontSize:'0.7rem',color:'#9ca3af',textAlign:'center',margin:'0.25rem 0 0.1rem',fontStyle:'italic',lineHeight:'1.6'}}>â€  Complete Fast Starter Bonus on the main screen to see<br/>a worked example of Supporting and Mentor Bonuses.</p>
        </div>
      </div>
    </div>
  );
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN TRACKER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const UWTracker=()=>{
  const [showIntro,setShowIntro]=useState(true);
  const [showCelebration,setShowCelebration]=useState(false);
  const [showContactPanel,setShowContactPanel]=useState(false);
  const [tabColoured,setTabColoured]=useState(false);
  const [selectedCircle,setSelectedCircle]=useState(null);
  const [showResetConfirm,setShowResetConfirm]=useState(false);
  const [showInfoPopup,setShowInfoPopup]=useState(false);
  const [includeYou,setIncludeYou]=useState(true);
  const [youTooltipVisible,setYouTooltipVisible]=useState(false);
  const [youBulbPulsed,setYouBulbPulsed]=useState(false);
  const [fastStarterAchieved,setFastStarterAchieved]=useState(false);
  const [infoBulbPulsed,setInfoBulbPulsed]=useState(false);
  const [showBestGuess,setShowBestGuess]=useState(false);
  const [hasInteracted,setHasInteracted]=useState(false);
  // Coaching lane state
  const [coachMsg,setCoachMsg]=useState(null);
  const [coachArrow,setCoachArrow]=useState(false);
  // Session flags
  const qdShown=useRef(false);
  const mixShown=useRef(false);
  const inactivityTimer=useRef(null);
  const previouslyQualified=useRef(false);
  // Stage reveal
  const [stageRevealShown,setStageRevealShown]=useState(false);

  const [customers,setCustomers]=useState([
    {type:'own',services:0,isPartner:false},
    {type:null,services:0,isPartner:false},
    {type:null,services:0,isPartner:false},
    {type:null,services:0,isPartner:false},
    {type:null,services:0,isPartner:false},
    {type:null,services:0,isPartner:false},
  ]);

  /* â”€â”€ Derived values (earnings logic UNCHANGED) â”€â”€ */
  const calculateCB=(customer,index)=>{
    if(!includeYou&&index===0){if(customer.type==='homeowner'){if(customer.services===1)return 50;if(customer.services===2)return 100;if(customer.services===3)return 250;if(customer.services===4)return 300;}return 0;}
    if(customer.type==='own'||customer.type==='renting')return 0;
    if(customer.type==='homeowner'){if(customer.services===1)return 50;if(customer.services===2)return 100;if(customer.services===3)return 250;if(customer.services===4)return 300;}
    return 0;
  };
  const highActivityCustomers=customers.filter((c,i)=>includeYou?i>0&&c.type==='homeowner'&&(c.services===3||c.services===4):c.type==='homeowner'&&(c.services===3||c.services===4)).length;
  const habPerCustomer=highActivityCustomers>=4?100:highActivityCustomers>=2?50:0;
  const totalHAB=highActivityCustomers*habPerCustomer;
  const totalCB=customers.reduce((sum,c,i)=>sum+calculateCB(c,i),0);
  const hasPartner=customers.some((c,i)=>includeYou?i>0&&c.isPartner:c.isPartner);
  const allCirclesFilled=customers.every(c=>c.type!==null);
  const qualifiesForFastStarter=allCirclesFilled&&hasPartner;
  const fastStarterBonus=qualifiesForFastStarter?500:0;
  const grandTotal=totalCB+totalHAB+fastStarterBonus;
  const tenantCount=customers.filter((c,i)=>includeYou?i>0&&c.type==='renting':c.type==='renting').length;
  const residualIncome=tenantCount*2.5;
  const supportingBonus=Math.round(totalCB/2);
  const partnerTotalEarnings=supportingBonus+100+300;
  const recurringActive=tenantCount>0;

  /* â”€â”€ QD coaching (item 7) â”€â”€ */
  const filledNonYou=customers.filter((c,i)=>includeYou?i>0&&c.type!==null:c.type!==null).length;
  const totalForQD=(includeYou?1:0)+filledNonYou;

  /* â”€â”€ Mix prompt logic (item 6) â”€â”€ */
  const filledCustomers=customers.filter((c,i)=>includeYou?i>0&&c.type!==null:c.type!==null);
  const totalFilled=filledCustomers.length;
  const totalCircles=includeYou?5:6;
  const oneRemaining=totalFilled===(totalCircles-1);
  const allHomeowners=filledCustomers.length>0&&filledCustomers.every(c=>c.type==='homeowner');
  const allTenants=filledCustomers.length>0&&filledCustomers.every(c=>c.type==='renting');

  useEffect(()=>{
    // QD message
    if(!qdShown.current&&totalForQD>=3){
      qdShown.current=true;
      setCoachArrow(false);
      setCoachMsg('QD* achieved ğŸ‰ Recurring (residual) income unlocked. Watch as your income builds.');
      return;
    }
    // Mix prompt (item 6) â€” only if QD already shown or not yet reached
    if(!mixShown.current&&oneRemaining&&!qualifiesForFastStarter){
      if(allHomeowners){mixShown.current=true;setCoachArrow(false);setCoachMsg('All homeowners so far. Try adding a tenant to see what changes.');}
      else if(allTenants){mixShown.current=true;setCoachArrow(false);setCoachMsg('All tenants so far. Try adding a homeowner to see what changes.');}
    }
  },[totalForQD,oneRemaining,allHomeowners,allTenants,qualifiesForFastStarter]);

  /* â”€â”€ Partner prompt coaching (item 8) â”€â”€ */
  useEffect(()=>{
    if(allCirclesFilled&&!hasPartner&&!qualifiesForFastStarter){
      setCoachArrow(true);
      setCoachMsg('Tap one grey P above to upgrade a customer â†’ partner');
    }else if(allCirclesFilled&&hasPartner){
      setCoachArrow(false);
    }
  },[allCirclesFilled,hasPartner,qualifiesForFastStarter]);

  /* â”€â”€ Inactivity prompt (item 17) â”€â”€ */
  const resetInactivity=useCallback(()=>{
    if(inactivityTimer.current)clearTimeout(inactivityTimer.current);
    if(fastStarterAchieved&&stageRevealShown){
      inactivityTimer.current=setTimeout(()=>{
        setCoachArrow(false);
        setCoachMsg('Ready for next steps? Your options are waiting on the left.');
      },9000);
    }
  },[fastStarterAchieved,stageRevealShown]);

  useEffect(()=>{resetInactivity();},[fastStarterAchieved,stageRevealShown]);

  const circleColor=(c)=>{if(c.type===null)return{border:'#d1d5db',text:'#9ca3af',bg:'#f9fafb'};if(c.type==='own')return{border:'#9ca3af',text:'#374151',bg:'#f3f4f6'};if(c.type==='renting')return{border:'#2563eb',text:'#1d4ed8',bg:'#eff6ff'};return{border:'#7c3aed',text:'#6d28d9',bg:'#f5f3ff'};};
  const getCircleOpacity=(index)=>{if(index===0&&includeYou)return 1;if(!includeYou){for(let i=0;i<index;i++)if(customers[i].type===null)return 0.3;return 1;}for(let i=1;i<index;i++)if(customers[i].type===null)return 0.3;return 1;};
  const canSelectCircle=(index)=>{if(index===0&&includeYou)return false;if(!includeYou){if(allCirclesFilled)return true;for(let i=0;i<index;i++)if(customers[i].type===null)return false;return true;}if(allCirclesFilled)return true;for(let i=1;i<index;i++)if(customers[i].type===null)return false;return true;};
  const ordinal=(n)=>n===1?'1st':n===2?'2nd':n===3?'3rd':`${n}th`;

  /* â”€â”€ Celebration + stage reveal (items 9, 15, 16) â”€â”€ */
  const triggerCelebration=()=>{
    setShowCelebration(true);
    setCoachMsg(null);
    setTimeout(()=>{
      setShowCelebration(false);
      setFastStarterAchieved(true);
      // Stage reveal coaching (item 16)
      setCoachMsg("You've seen what you can earn. Now see what happens when you help others.");
      setTimeout(()=>{
        setStageRevealShown(true);
        setCoachMsg(null);
        // Tab colours after reveal (item 10)
        setTabColoured(true);
      },4500);
    },3000);
  };

  const handlePartnerBadgeClick=(e,index)=>{
    e.stopPropagation();
    if((index===0&&includeYou)||customers[index].type===null)return;
    const wasQualified=qualifiesForFastStarter;
    const nc=[...customers];nc[index]={...nc[index],isPartner:!nc[index].isPartner};setCustomers(nc);
    const nowQualifies=nc.every(c=>c.type!==null)&&nc.some((c,i)=>includeYou?i>0&&c.isPartner:c.isPartner);
    if(!wasQualified&&nowQualifies&&!previouslyQualified.current){previouslyQualified.current=true;setTimeout(triggerCelebration,200);}
    if(!nowQualifies)previouslyQualified.current=false;
    resetInactivity();
  };

  const handleCircleClick=(index)=>{
    if((index===0&&includeYou)||!canSelectCircle(index))return;
    if(!hasInteracted){setHasInteracted(true);setShowBestGuess(true);}
    setSelectedCircle(index);
    resetInactivity();
  };

  const setCustomerType=(type,services)=>{
    if(selectedCircle===null)return;
    const wasQualified=qualifiesForFastStarter;
    const nc=[...customers];
    nc[selectedCircle]={type,services:services||0,isPartner:nc[selectedCircle].isPartner};
    setCustomers(nc);setSelectedCircle(null);setShowBestGuess(false);
    const nowAllFilled=nc.every(c=>c.type!==null);
    const nowHasPartner=nc.some((c,i)=>includeYou?i>0&&c.isPartner:c.isPartner);
    const nowQualifies=nowAllFilled&&nowHasPartner;
    if(!wasQualified&&nowQualifies&&!previouslyQualified.current){previouslyQualified.current=true;setTimeout(triggerCelebration,200);}
    if(!nowQualifies)previouslyQualified.current=false;
    resetInactivity();
  };

  const removeCustomer=()=>{if(selectedCircle===null)return;const nc=[...customers];nc[selectedCircle]={type:null,services:0,isPartner:false};setCustomers(nc);setSelectedCircle(null);previouslyQualified.current=false;setShowBestGuess(false);};

  const resetTracking=()=>{
    setCustomers([{type:includeYou?'own':null,services:0,isPartner:false},{type:null,services:0,isPartner:false},{type:null,services:0,isPartner:false},{type:null,services:0,isPartner:false},{type:null,services:0,isPartner:false},{type:null,services:0,isPartner:false}]);
    setSelectedCircle(null);setShowResetConfirm(false);
    previouslyQualified.current=false;qdShown.current=false;mixShown.current=false;
    setHasInteracted(false);setShowBestGuess(false);setCoachMsg(null);setCoachArrow(false);
    setTabColoured(false);setFastStarterAchieved(false);setInfoBulbPulsed(false);
    setStageRevealShown(false);setYouBulbPulsed(false);
    if(inactivityTimer.current)clearTimeout(inactivityTimer.current);
  };

  const toggleIncludeYou=()=>{const niy=!includeYou;setIncludeYou(niy);const nc=[...customers];nc[0]={type:niy?'own':null,services:0,isPartner:false};setCustomers(nc);setSelectedCircle(null);previouslyQualified.current=false;resetInactivity();};

  /* â”€â”€ Render â”€â”€ */
  return(
    <div style={{minHeight:'100vh',background:'linear-gradient(135deg,#fdf2f8,#f5f3ff)',padding:'1rem'}}>
      {showIntro&&<IntroModal onClose={()=>setShowIntro(false)}/>}
      <ProfileBubble/>
      <ContactPanel grandTotal={grandTotal} isOpen={showContactPanel} onClose={()=>setShowContactPanel(false)} tabColoured={tabColoured} onTabClick={()=>setShowContactPanel(o=>!o)}/>
      {showCelebration&&(<div style={{position:'fixed',inset:0,pointerEvents:'none',zIndex:50}}>{[...Array(50)].map((_,i)=>(<div key={i} className="animate-confetti" style={{position:'absolute',left:`${Math.random()*100}%`,top:'-10%',animationDelay:`${Math.random()*0.5}s`,animationDuration:`${2+Math.random()}s`}}><div style={{color:'#facc15',fontSize:`${Math.random()*20+10}px`,transform:`rotate(${Math.random()*360}deg)`}}>âœ¨</div></div>))}</div>)}

      <div style={{maxWidth:'42rem',margin:'0 auto'}}>
        {/* Header */}
        <div style={{marginBottom:'1.5rem'}}>
          <h1 style={{fontSize:'1.5rem',fontWeight:'700',color:'#1f2937',marginBottom:'0.5rem',textAlign:'center'}}>UW Partner Earnings Tool</h1>
          <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',gap:'1rem'}}>
            <div style={{display:'flex',alignItems:'center',gap:'0.5rem',position:'relative'}}>
              <button onClick={toggleIncludeYou} style={{position:'relative',display:'inline-flex',height:'1.5rem',width:'2.75rem',alignItems:'center',borderRadius:'9999px',border:'none',cursor:'pointer',background:includeYou?'#22c55e':'#d1d5db',transition:'background 0.2s'}}>
                <span style={{display:'inline-block',height:'1rem',width:'1rem',transform:includeYou?'translateX(1.5rem)':'translateX(0.25rem)',borderRadius:'50%',background:'white',transition:'transform 0.2s',boxShadow:'0 1px 3px rgba(0,0,0,0.2)'}}></span>
              </button>
              <span style={{fontSize:'0.875rem',fontWeight:'600',color:'#374151'}}>You</span>
              {/* Item 3A â€” Toggle lightbulb, yellow emoji, tooltip auto-dismiss 5s, softer bg */}
              <div className="tooltip-wrap" style={{marginLeft:'0.2rem'}}>
                <button onClick={()=>{setYouTooltipVisible(v=>!v);if(!youTooltipVisible){setTimeout(()=>setYouTooltipVisible(false),5000);}}} style={{background:'none',border:'none',cursor:'pointer',padding:'0.15rem',display:'flex',alignItems:'center',lineHeight:1}}>
                  {!youBulbPulsed?<PulsingBulb size="0.95rem" onDone={()=>setYouBulbPulsed(true)}/>:<Bulb size="0.95rem"/>}
                </button>
                {youTooltipVisible&&(
                  <div className="tooltip-box" style={{minWidth:'220px',background:'#78716c',borderRadius:'0.5rem'}}>
                    ğŸ’¡ Most Partners also use UW themselves to save on their own household bills.<br/>Toggle this off any time.
                    <span style={{position:'absolute',top:'100%',left:'50%',transform:'translateX(-50%)',border:'5px solid transparent',borderTopColor:'#78716c',display:'block'}}></span>
                  </div>
                )}
              </div>
            </div>
            <p style={{fontSize:'0.875rem',color:'#6b7280',flex:1,textAlign:'center'}}>Explore what <strong>{includeYou?'five':'six'}</strong> customers could earn you in the first 30 days</p>
            <div style={{width:'5rem'}}></div>
          </div>
        </div>

        {/* Main card */}
        <div style={{background:'white',borderRadius:'1rem',boxShadow:'0 4px 16px rgba(0,0,0,0.08)',padding:'1.5rem'}}>

          {/* Customer circles */}
          <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:'1rem',marginBottom:'1rem'}}>
            {customers.map((customer,index)=>{
              const col=circleColor(customer);const cb=calculateCB(customer,index);
              const showHAB=customer.type==='homeowner'&&(customer.services===3||customer.services===4)&&highActivityCustomers>=2;
              return(
                <div key={index} style={{display:'flex',flexDirection:'column',alignItems:'center',position:'relative'}}>
                  <div onClick={()=>handleCircleClick(index)} style={{width:'5rem',height:'5rem',borderRadius:'50%',border:`4px solid ${col.border}`,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',fontSize:'1.125rem',fontWeight:'700',position:'relative',background:col.bg,color:col.text,cursor:canSelectCircle(index)?'pointer':'not-allowed',opacity:getCircleOpacity(index),transition:'transform 0.15s',boxSizing:'border-box'}}>
                    {(index===0&&includeYou)?<span style={{fontSize:'1rem',fontWeight:'700'}}>You</span>
                    :customer.type?(
                      <><span style={{fontSize:'0.875rem',fontWeight:'700'}}>Â£{cb.toLocaleString()}</span>
                      {showHAB&&<div style={{position:'absolute',top:'-0.25rem',right:'-0.25rem',padding:'0.125rem 0.25rem',background:'#f97316',color:'white',fontSize:'0.625rem',fontWeight:'700',borderRadius:'0.25rem',zIndex:10}}>+Â£{habPerCustomer}</div>}
                      <div onClick={(e)=>handlePartnerBadgeClick(e,index)} style={{position:'absolute',bottom:'-0.25rem',right:'-0.25rem',width:'1.5rem',height:'1.5rem',borderRadius:'50%',border:`2px solid ${customer.isPartner?'#ca8a04':'#9ca3af'}`,display:'flex',alignItems:'center',justifyContent:'center',zIndex:10,cursor:'pointer',background:customer.isPartner?'#facc15':'#e5e7eb',transition:'transform 0.15s'}}>
                        <span style={{fontSize:'0.625rem',fontWeight:'700',color:customer.isPartner?'#713f12':'#6b7280'}}>P</span>
                      </div></>
                    ):(
                      <><span style={{fontSize:'0.875rem'}}>{includeYou?ordinal(index):ordinal(index+1)}</span>
                      <div style={{position:'absolute',bottom:'-0.25rem',right:'-0.25rem',width:'1.5rem',height:'1.5rem',borderRadius:'50%',border:'2px solid #9ca3af',display:'flex',alignItems:'center',justifyContent:'center',zIndex:10,background:'#e5e7eb'}}>
                        <span style={{fontSize:'0.625rem',fontWeight:'700',color:'#6b7280'}}>P</span>
                      </div></>
                    )}
                  </div>
                </div>
              );
            })}
          </div>

          {/* Item 4 â€” Coaching lane (fixed space below circles) */}
          <CoachingLane message={coachMsg} showArrow={coachArrow}/>

          <div style={{display:'flex',flexDirection:'column',gap:'0.75rem'}}>
            {/* Customer Bonus */}
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'0.75rem 1rem',borderRadius:'0.5rem',border:`4px solid ${totalCB>0?'#7c3aed':'#d1d5db'}`,background:totalCB>0?'#f5f3ff':'#f9fafb'}}>
              <div style={{display:'flex',alignItems:'center',gap:'0.5rem'}}><span style={{fontSize:'1.25rem',filter:totalCB>0?'none':'grayscale(1)',opacity:totalCB>0?1:0.4}}>ğŸ’·</span><span style={{fontWeight:'600',color:totalCB>0?'#7c3aed':'#4b5563'}}>Customer Bonus:</span></div>
              <span style={{fontSize:'1.25rem',fontWeight:'700',color:totalCB>0?'#6d28d9':'#9ca3af'}}>Â£{totalCB.toLocaleString()}</span>
            </div>

            {/* High Activity Bonus */}
            {highActivityCustomers>=2&&(
              <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'0.75rem 1rem',borderRadius:'0.5rem',border:'4px solid #f97316',background:'#fff7ed'}}>
                <div style={{display:'flex',alignItems:'center',gap:'0.5rem'}}><span style={{fontSize:'1.25rem'}}>ğŸ”¥</span><span style={{fontWeight:'600',color:'#ea580c'}}>High Activity Bonus:</span></div>
                <span style={{fontSize:'1.25rem',fontWeight:'700',color:'#ea580c'}}>Â£{totalHAB.toLocaleString()}</span>
              </div>
            )}

            {/* Fast Starter */}
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'0.75rem 1rem',borderRadius:'0.5rem',border:`2px solid ${qualifiesForFastStarter?'#86efac':'#e5e7eb'}`,background:qualifiesForFastStarter?'#f0fdf4':'#f9fafb'}}>
              <div style={{display:'flex',alignItems:'center',gap:'0.5rem'}}><TrendingUp style={{...MD,color:qualifiesForFastStarter?'#16a34a':'#9ca3af'}}/><span style={{fontWeight:'600',color:qualifiesForFastStarter?'#16a34a':'#374151'}}>Fast Starter Bonus:</span></div>
              <span style={{fontSize:'1.25rem',fontWeight:'700',color:qualifiesForFastStarter?'#16a34a':'#9ca3af'}}>Â£{fastStarterBonus.toLocaleString()}</span>
            </div>

            {/* Total Earnings â€” item 3B: yellow ğŸ’¡ icon */}
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'1rem',borderRadius:'0.5rem',boxShadow:'0 2px 8px rgba(0,0,0,0.15)',color:'white',position:'relative',overflow:'hidden'}}>
              <div style={{position:'absolute',inset:0,background:grandTotal>0?'linear-gradient(to right,#7c3aed,#db2777)':'#9ca3af'}}></div>
              <div style={{display:'flex',alignItems:'center',gap:'0.5rem',position:'relative',zIndex:1}}>
                <span style={{fontWeight:'700',fontSize:'1.125rem'}}>TOTAL EARNINGS:</span>
                <button onClick={(e)=>{e.stopPropagation();setShowInfoPopup(true);}} style={{width:'1.5rem',height:'1.5rem',borderRadius:'50%',background:'rgba(255,255,255,0.3)',border:'none',cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',padding:0,fontSize:'0.9rem',lineHeight:1}}>
                  {fastStarterAchieved&&!infoBulbPulsed?<PulsingBulb size="0.9rem" onDone={()=>setInfoBulbPulsed(true)}/>:'ğŸ’¡'}
                </button>
              </div>
              <span style={{fontSize:'1.5rem',fontWeight:'700',position:'relative',zIndex:1}}>Â£{grandTotal.toLocaleString()}</span>
            </div>

            {/* Item 14 â€” Recurring Income always visible, greyed when inactive */}
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'0.75rem 1rem',borderRadius:'0.5rem',border:`4px solid ${recurringActive?'#2563eb':'#d1d5db'}`,background:recurringActive?'#eff6ff':'#f9fafb',opacity:recurringActive?1:0.5,transition:'opacity 0.3s,border-color 0.3s'}}>
              <div style={{display:'flex',alignItems:'center',gap:'0.5rem'}}>
                <RefreshCw style={{...MD,color:recurringActive?'#2563eb':'#9ca3af'}}/>
                <span style={{fontWeight:'600',color:recurringActive?'#374151':'#6b7280'}}>Recurring Income:</span>
              </div>
              <div style={{textAlign:'right'}}>
                <span style={{fontSize:'1.25rem',fontWeight:'700',color:recurringActive?'#2563eb':'#9ca3af'}}>{recurringActive?`Â£${residualIncome.toFixed(2)}/m`:'â€”'}</span>
                {recurringActive&&<span style={{display:'block',fontSize:'0.75rem',color:'#3b82f6'}}>(Â£{(residualIncome*12).toLocaleString()}/yr)</span>}
                {!recurringActive&&<span style={{display:'block',fontSize:'0.72rem',color:'#9ca3af',fontStyle:'italic'}}>Add a tenant to activate</span>}
              </div>
            </div>

            {/* Item 15 â€” Revenue Stream Panel (replaces flip card) */}
            <div className={`revenue-panel ${qualifiesForFastStarter?'unlocked':'locked'}`}>
              {/* Locked state */}
              {!qualifiesForFastStarter&&(
                <div style={{padding:'1rem',background:'#f3f4f6',display:'flex',alignItems:'center',gap:'0.5rem'}}>
                  <Lock style={{...SM,color:'#9ca3af'}}/>
                  <span style={{fontWeight:'700',fontSize:'0.95rem',color:'#9ca3af'}}>Three revenue streams (locked)</span>
                </div>
              )}
              {/* Unlocked state â€” always shows content once FS achieved, no flip needed */}
              {qualifiesForFastStarter&&(
                <div style={{background:'linear-gradient(to right,#7c3aed,#db2777)'}}>
                  {/* Header */}
                  <div style={{padding:'1rem 1rem 0.75rem',display:'flex',alignItems:'center',gap:'0.5rem'}}>
                    <span style={{fontSize:'1.1rem',lineHeight:1}}>ğŸ”“</span>
                    <span style={{fontWeight:'700',fontSize:'0.95rem',color:'white'}}>Three revenue streams unlocked</span>
                  </div>
                  {/* Streams */}
                  <div style={{padding:'0 1rem 0.75rem',display:'flex',flexDirection:'column',gap:'0.35rem'}}>
                    {[
                      {icon:'ğŸ¤',label:'Supporting Bonus'},
                      {icon:'ğŸ“',label:'Mentor Bonus'},
                      {icon:null,label:'Fast Starter Mentor Bonus'},
                    ].map(s=>(
                      <div key={s.label} style={{display:'flex',alignItems:'center',gap:'0.5rem',fontSize:'0.875rem',color:'#fbcfe8'}}>
                        {s.icon?<span style={{fontSize:'1rem',lineHeight:1}}>{s.icon}</span>:<TrendingUp style={{...SM,color:'#fbcfe8'}}/>}
                        <span>{s.label}</span>
                      </div>
                    ))}
                  </div>
                  {/* Worked example (existing maths) */}
                  <div style={{margin:'0 1rem 1rem',background:'rgba(255,255,255,0.12)',borderRadius:'0.5rem',padding:'0.75rem'}}>
                    <p style={{color:'white',fontWeight:'600',fontSize:'0.78rem',margin:'0 0 0.5rem'}}>Worked example â€” for each Partner you support to QD*:</p>
                    <div style={{display:'flex',justifyContent:'space-between',color:'white',fontSize:'0.85rem',marginBottom:'0.2rem'}}><span>They earn (same as you above)</span><span style={{fontWeight:'700'}}>Â£{grandTotal.toLocaleString()}</span></div>
                    <div style={{borderTop:'1px solid rgba(255,255,255,0.3)',paddingTop:'0.2rem',display:'flex',justifyContent:'space-between',fontSize:'0.85rem'}}><span style={{color:'#fbcfe8'}}>You earn</span><span style={{fontWeight:'700',color:'#fde68a'}}>Â£{partnerTotalEarnings.toLocaleString()}</span></div>
                    <div style={{marginTop:'0.5rem',display:'flex',flexDirection:'column',gap:'0.2rem'}}>
                      {[{icon:'ğŸ¤',label:'Supporting Customer Bonuses',val:supportingBonus},{icon:'ğŸ“',label:'Mentor Bonus',val:100},{icon:null,label:'Fast Starter Mentor Bonus',val:300}].map(r=>(
                        <div key={r.label} style={{display:'flex',justifyContent:'space-between',fontSize:'0.8rem',background:'rgba(255,255,255,0.08)',borderRadius:'0.25rem',padding:'0.2rem 0.45rem'}}>
                          <span style={{color:'#fbcfe8',display:'flex',alignItems:'center',gap:'0.3rem'}}>{r.icon?<span>{r.icon}</span>:<TrendingUp style={{width:'0.7rem',height:'0.7rem',color:'#fbcfe8'}}/>}{r.label}</span>
                          <span style={{color:'white',fontWeight:'700'}}>Â£{r.val.toLocaleString()}</span>
                        </div>
                      ))}
                    </div>
                  </div>
                </div>
              )}
            </div>
          </div>
        </div>

        {/* Item 13 â€” Reset button */}
        <div style={{marginTop:'1rem'}}>
          <button onClick={()=>setShowResetConfirm(true)} style={{width:'100%',padding:'0.75rem',background:'#e5e7eb',border:'none',borderRadius:'0.5rem',fontWeight:'600',color:'#374151',cursor:'pointer',fontSize:'1rem'}}>Reset</button>
        </div>
      </div>

      {/* Info popup */}
      {showInfoPopup&&<HowPaidPopup onClose={()=>setShowInfoPopup(false)}/>}

      {/* Customer selection modal */}
      {selectedCircle!==null&&(
        <div style={{position:'fixed',inset:0,background:'rgba(0,0,0,0.3)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:50,padding:'1rem'}} onClick={()=>{setSelectedCircle(null);setShowBestGuess(false);}}>
          <div className="animate-slideDown" style={{background:'white',borderRadius:'0.75rem',padding:'1.5rem',boxShadow:'0 20px 50px rgba(0,0,0,0.3)',maxWidth:'24rem',width:'100%'}} onClick={e=>e.stopPropagation()}>
            <p style={{fontSize:'0.875rem',fontWeight:'600',color:'#111827',marginBottom:'0.5rem',textAlign:'center'}}>{includeYou?`Customer ${selectedCircle}`:`Customer ${selectedCircle+1}`}: Homeowner with how many services?</p>
            {showBestGuess&&(
              <p style={{fontSize:'0.8rem',color:'#374151',fontWeight:'700',fontStyle:'italic',textAlign:'center',margin:'0 0 0.85rem',background:'#fef9c3',padding:'0.4rem 0.6rem',borderRadius:'0.4rem'}}>
                ğŸ’¡ Just make your best guess â€” you can change this later.
              </p>
            )}
            <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:'0.5rem',marginBottom:'0.75rem'}}>
              {[1,2,3,4].map(num=>{const cb=[50,100,250,300][num-1];const active=customers[selectedCircle]&&customers[selectedCircle].type==='homeowner'&&customers[selectedCircle].services===num;return(
                <button key={num} onClick={()=>setCustomerType('homeowner',num)} style={{padding:'1rem 0.5rem',border:`2px solid ${active?'#7c3aed':'#c4b5fd'}`,borderRadius:'0.5rem',background:active?'#7c3aed':'#f5f3ff',color:active?'white':'#6d28d9',cursor:'pointer',fontWeight:'600'}}>
                  <div style={{fontSize:'1rem',fontWeight:'700'}}>{num}</div><div style={{fontSize:'0.75rem',marginTop:'0.25rem'}}>(Â£{cb})</div>
                </button>);})}
            </div>
            <p style={{textAlign:'center',fontSize:'0.875rem',color:'#6b7280',marginBottom:'0.75rem'}}>or</p>
            <button onClick={()=>setCustomerType('renting')} style={{width:'100%',padding:'0.75rem',border:`2px solid ${customers[selectedCircle]&&customers[selectedCircle].type==='renting'?'#2563eb':'#93c5fd'}`,borderRadius:'0.5rem',background:customers[selectedCircle]&&customers[selectedCircle].type==='renting'?'#2563eb':'#eff6ff',color:customers[selectedCircle]&&customers[selectedCircle].type==='renting'?'white':'#1d4ed8',cursor:'pointer',fontWeight:'600',marginBottom:'0.75rem'}}>
              <div style={{fontSize:'1rem',fontWeight:'700'}}>Tenant/Renting</div><div style={{fontSize:'0.75rem',fontWeight:'400'}}>(No customer bonus, just recurring income)</div>
            </button>
            {customers[selectedCircle]&&customers[selectedCircle].type!==null&&(
              <button onClick={removeCustomer} style={{width:'100%',padding:'0.75rem',border:'2px solid #fca5a5',borderRadius:'0.5rem',background:'#fef2f2',color:'#b91c1c',cursor:'pointer',fontWeight:'600'}}>Remove Customer</button>
            )}
          </div>
        </div>
      )}

      {/* Reset confirm */}
      {showResetConfirm&&(
        <div style={{position:'fixed',inset:0,background:'rgba(0,0,0,0.3)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:50,padding:'1rem'}}>
          <div className="animate-slideDown" style={{background:'white',borderRadius:'0.75rem',padding:'1.5rem',boxShadow:'0 20px 50px rgba(0,0,0,0.3)',maxWidth:'24rem',width:'100%'}}>
            <p style={{fontSize:'1.125rem',fontWeight:'600',color:'#111827',marginBottom:'1rem',textAlign:'center'}}>Are you sure?</p>
            <p style={{fontSize:'0.875rem',color:'#6b7280',marginBottom:'1.5rem',textAlign:'center'}}>This will reset all customer data and cannot be undone.</p>
            <div style={{display:'flex',gap:'0.75rem'}}>
              <button onClick={()=>setShowResetConfirm(false)} style={{flex:1,padding:'0.5rem',background:'#e5e7eb',border:'none',borderRadius:'0.5rem',fontWeight:'600',color:'#374151',cursor:'pointer'}}>No</button>
              <button onClick={resetTracking} style={{flex:1,padding:'0.5rem',background:'#ef4444',border:'none',borderRadius:'0.5rem',fontWeight:'600',color:'white',cursor:'pointer'}}>Yes, Reset</button>
            </div>
          </div>
        </div>
      )}

      {/* Item 9 â€” Fast Starter celebration modal */}
      {showCelebration&&(
        <div style={{position:'fixed',inset:0,background:'rgba(0,0,0,0.5)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:40,padding:'1rem'}}>
          <div className="animate-bounceOnce" style={{background:'white',borderRadius:'1rem',padding:'2rem',maxWidth:'28rem',textAlign:'center'}}>
            <div style={{fontSize:'3.75rem',marginBottom:'1rem'}}>ğŸ‰</div>
            <h2 style={{fontSize:'1.875rem',fontWeight:'700',color:'#7c3aed',marginBottom:'1rem'}}>Congratulations!</h2>
            <p style={{fontSize:'1.25rem',color:'#374151',marginBottom:'0.5rem'}}>You've qualified for the</p>
            <p style={{fontSize:'2.25rem',fontWeight:'700',color:'#16a34a',marginBottom:'0.25rem',lineHeight:1.15}}>Â£500 fast</p>
            <p style={{fontSize:'2.25rem',fontWeight:'700',color:'#16a34a',marginBottom:'1rem',lineHeight:1.15}}>starter bonus</p>
          </div>
        </div>
      )}
    </div>
  );
};

const root=ReactDOM.createRoot(document.getElementById('root'));
root.render(React.createElement(UWTracker));
</script>
</body>
</html>
