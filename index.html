
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>UW Partner Earnings Tool</title>
<script src="https://cdn.tailwindcss.com"></script>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<style>
  @keyframes slideDown { 0%{opacity:0;transform:scale(0.95)} 100%{opacity:1;transform:scale(1)} }
  @keyframes confetti { 0%{transform:translateY(0) rotate(0deg);opacity:1} 100%{transform:translateY(100vh) rotate(360deg);opacity:0} }
  @keyframes bounceOnce { 0%,100%{transform:translateY(0)} 25%{transform:translateY(-20px)} 50%{transform:translateY(0)} 75%{transform:translateY(-10px)} }
  @keyframes pulseTwice { 0%,100%{transform:scale(1);opacity:1} 25%{transform:scale(1.4);opacity:0.65} 50%{transform:scale(1);opacity:1} 75%{transform:scale(1.4);opacity:0.65} }
  @keyframes tabPulse { 0%,100%{box-shadow:3px 0 14px rgba(124,58,237,0.35)} 25%{box-shadow:3px 0 26px rgba(219,39,119,0.85)} 50%{box-shadow:3px 0 14px rgba(124,58,237,0.35)} 75%{box-shadow:3px 0 26px rgba(219,39,119,0.85)} }
  @keyframes coachFadeIn { 0%{opacity:0;transform:translateY(6px)} 100%{opacity:1;transform:translateY(0)} }
  @keyframes coachFadeOut { 0%{opacity:1;transform:translateY(0)} 100%{opacity:0;transform:translateY(-4px)} }
  @keyframes badgeGlow {
    0%   { box-shadow: 0 0 0 0px rgba(168,85,247,0.7), 0 0 0 0px rgba(168,85,247,0.2); }
    50%  { box-shadow: 0 0 0 6px rgba(168,85,247,0.4), 0 0 0 12px rgba(168,85,247,0.1); }
    100% { box-shadow: 0 0 0 0px rgba(168,85,247,0), 0 0 0 0px rgba(168,85,247,0); }
  }
  @keyframes circleGlowAnim {
    0%,100% { box-shadow: 0 0 0 0 rgba(124,58,237,0); }
    50%     { box-shadow: 0 0 0 8px rgba(124,58,237,0.3); }
  }
  @keyframes revenueSlideIn {
    0%   { opacity:0; transform: translateX(80px) scale(0.96); }
    100% { opacity:1; transform: translateX(0) scale(1); }
  }
  @keyframes revenueWiggle {
    0%   { transform: translateX(0); }
    20%  { transform: translateX(-5px); }
    40%  { transform: translateX(5px); }
    60%  { transform: translateX(-3px); }
    80%  { transform: translateX(3px); }
    100% { transform: translateX(0); }
  }
  /* Double pulse â€” two gentle waves */
  @keyframes linePulse {
    0%   { transform:scale(1); }
    20%  { transform:scale(1.055); }
    40%  { transform:scale(1); }
    65%  { transform:scale(1.04); }
    85%  { transform:scale(1); }
    100% { transform:scale(1); }
  }
  /* Slow gentle tab shimmer â€” not urgent */
  @keyframes tabShimmer {
    0%,100% { box-shadow:3px 0 14px rgba(124,58,237,0.3); opacity:1; }
    40%     { box-shadow:3px 0 22px rgba(219,39,119,0.6); opacity:0.88; }
  }
  /* Synchronized gentle pulse â€” used by arrow, revenue tab, and coaching lines together */
  @keyframes gentlePulse {
    0%,100% { transform:scale(1); opacity:1; }
    50%     { transform:scale(1.22); opacity:0.78; }
  }
  /* Arrow emoji pulse â€” same timing as gentlePulse */
  @keyframes arrowPulse {
    0%,100% { transform:scale(1); opacity:1; }
    50%     { transform:scale(1.25); opacity:0.75; }
  }
  /* Revenue tab unlock pulse â€” synced with arrow */
  @keyframes revTabPulse {
    0%,100% { box-shadow:-3px 0 12px rgba(124,58,237,0.3); }
    50%     { box-shadow:-8px 0 32px rgba(219,39,119,0.85); }
  }
  /* Tab shimmer â€” more pronounced */
  @keyframes tabShimmerStrong {
    0%,100% { box-shadow:3px 0 14px rgba(124,58,237,0.3); filter:brightness(1); }
    50%     { box-shadow:3px 0 28px rgba(219,39,119,0.85); filter:brightness(1.18); }
  }
  .animate-slideDown { animation: slideDown 0.2s ease-out forwards; }
  .animate-confetti { animation: confetti 3s ease-in forwards; }
  .animate-bounceOnce { animation: bounceOnce 0.6s ease-in-out; }
  .pulse-twice { animation: pulseTwice 0.9s ease-in-out 1 forwards; }
  .tab-pulse { animation: tabPulse 0.95s ease-in-out 2; }
  .coach-in  { animation: coachFadeIn  0.55s ease-out forwards; }
  .coach-out { animation: coachFadeOut 0.45s ease-in  forwards; }
  .p-badge-glow { animation: badgeGlow 1.4s ease-in-out 3; animation-fill-mode: forwards; }
  .circle-glow-anim { animation: circleGlowAnim 1.2s ease-in-out 2; }
  .revenue-slide-in { animation: revenueSlideIn 1.6s cubic-bezier(0.22,1,0.36,1) forwards; }
  .revenue-wiggle { animation: revenueWiggle 0.5s ease-in-out 1; }
  .line-pulse { animation: gentlePulse 1.4s ease-in-out 1; }
  .line-pulse-double { animation: gentlePulse 1.4s ease-in-out 2; }
  .tab-shimmer { animation: tabShimmerStrong 1.4s ease-in-out 2; }
  .rev-tab-pulse { animation: revTabPulse 1.4s ease-in-out 3; }
  .rev-tab-pulse-double { animation: revTabPulse 1.4s ease-in-out 2; }
  .rev-tab-pulse-single { animation: revTabPulse 1.4s ease-in-out 1; }
  .arrow-pulse { animation: arrowPulse 1.4s ease-in-out 3; }
  .bulb-pulse-double { animation: gentlePulse 1.4s ease-in-out 2; }
  .bulb-pulse-single { animation: gentlePulse 1.4s ease-in-out 1; }
  .tab-pulse-double { animation: tabShimmerStrong 1.4s ease-in-out 2; }
  .tab-pulse-single { animation: tabShimmerStrong 1.4s ease-in-out 1; }
  * { box-sizing: border-box; }
  @media (orientation: landscape) and (max-height: 500px) {
    .accordion-list { display: grid !important; grid-template-columns: 1fr 1fr !important; gap: 0.4rem !important; align-items: start !important; }
    .accordion-list > div { overflow: visible !important; }
  }
  .profile-bubble-wrap { position:fixed;top:0.75rem;right:0.75rem;z-index:100;display:flex;flex-direction:column;align-items:flex-end;gap:0.3rem; }
  .profile-photo-btn { width:3.25rem;height:3.25rem;border-radius:50%;overflow:hidden;border:2.5px solid #fff;box-shadow:0 4px 16px rgba(124,58,237,0.35),0 2px 6px rgba(0,0,0,0.18);cursor:pointer;background:linear-gradient(135deg,#7c3aed,#db2777);display:flex;align-items:center;justify-content:center;transition:transform 0.18s;flex-shrink:0;align-self:flex-end; }
  .profile-photo-btn:hover { transform:scale(1.07); }
  .profile-photo-btn img { width:100%;height:100%;object-fit:cover; }
  .profile-photo-btn .initials { color:white;font-weight:800;font-size:1.1rem;letter-spacing:-0.02em; }
  .bubble-name-wrap { text-align:right;transition:opacity 0.35s ease,max-height 0.35s ease,margin 0.35s ease;max-height:3rem;overflow:hidden;margin-bottom:0; }
  .bubble-name-wrap.hidden { opacity:0;max-height:0;pointer-events:none;margin-bottom:-0.3rem; }
  .bubble-name-primary { font-size:0.78rem;font-weight:700;color:#1f2937;line-height:1.3; }
  .bubble-name-secondary { font-size:0.68rem;color:#6b7280;line-height:1.3; }
  .fab-actions { display:flex;flex-direction:column;align-items:flex-end;gap:0.4rem;max-height:0;opacity:0;overflow:hidden;transform:translateY(-12px);transition:max-height 0.35s ease,opacity 0.3s ease,transform 0.3s ease; }
  .fab-actions.open { max-height:16rem;opacity:1;transform:translateY(0); }
  .fab-action-btn { display:flex;align-items:center;gap:0.45rem;padding:0.45rem 0.75rem;border-radius:2rem;border:none;cursor:pointer;font-size:0.8rem;font-weight:700;white-space:nowrap;background:white;color:#1f2937;text-decoration:none;transition:transform 0.15s; }
  .fab-action-btn:hover { transform:scale(1.04); }
  .fab-btn-jumpin { box-shadow:3px 3px 10px rgba(109,40,217,0.3); }
  .fab-btn-bookin { box-shadow:3px 3px 10px rgba(168,85,247,0.3); }
  .fab-btn-sayhi  { box-shadow:3px 3px 10px rgba(219,39,119,0.3); }
  .fab-icon { font-size:1rem;line-height:1; }
  .sayhi-icons-row { display:flex;justify-content:flex-end;gap:0.4rem;max-height:0;opacity:0;overflow:hidden;transform:translateY(-6px);transition:max-height 0.3s ease,opacity 0.25s ease,transform 0.25s ease; }
  .sayhi-icons-row.open { max-height:3rem;opacity:1;transform:translateY(0); }
  .fab-icon-circle { width:2.2rem;height:2.2rem;border-radius:50%;background:white;border:1.5px solid #e5e7eb;box-shadow:2px 2px 8px rgba(219,39,119,0.2);display:flex;align-items:center;justify-content:center;cursor:pointer;flex-shrink:0;text-decoration:none;transition:transform 0.15s,background 0.15s; }
  .fab-icon-circle:hover { transform:scale(1.1);background:#fdf2f8; }
  .fab-icon-circle svg { width:1rem;height:1rem; }
  .contact-panel-overlay { position:fixed;inset:0;background:rgba(0,0,0,0.35);opacity:0;pointer-events:none;transition:opacity 0.35s ease;z-index:150; }
  .contact-panel-overlay.visible { opacity:1;pointer-events:auto; }
  .contact-panel { position:fixed;top:0;left:0;height:100%;width:min(22rem,88vw);background:white;box-shadow:6px 0 32px rgba(0,0,0,0.22);transform:translateX(-100%);transition:transform 0.38s cubic-bezier(0.4,0,0.2,1);z-index:151;display:flex;flex-direction:column;overflow-y:auto; }
  .contact-panel.open { transform:translateX(0); }
  .left-pull-tab { position:fixed;top:50%;left:0;transform:translateY(-50%);z-index:165;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:0.2rem;color:white;border-radius:0 0.6rem 0.6rem 0;padding:0.7rem 0.45rem;cursor:pointer;transition:transform 0.38s cubic-bezier(0.4,0,0.2,1),filter 0.2s,background 0.45s;user-select:none; }
  .left-pull-tab.tab-grey { background:#9ca3af;box-shadow:3px 0 10px rgba(0,0,0,0.15); }
  .left-pull-tab.tab-coloured { background:linear-gradient(135deg,#7c3aed,#db2777);box-shadow:3px 0 14px rgba(124,58,237,0.35); }
  .left-pull-tab:hover { filter:brightness(1.1); }
  .left-pull-tab.panel-open { transform:translateY(-50%) translateX(min(22rem,88vw)); }
  .pull-tab-emoji { font-size:1.15rem;line-height:1;margin-bottom:0.3rem; }
  .pull-tab-label { writing-mode:vertical-rl;text-orientation:mixed;font-size:0.65rem;font-weight:400;letter-spacing:0.08em;text-transform:uppercase;line-height:1.2; }
  .intro-modal-overlay { position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:300;padding:1rem; }
  .coaching-lane { border-radius:0.6rem;padding:0.5rem 0.75rem;margin-bottom:0.5rem;height:4.8rem;display:flex;align-items:center;gap:0.45rem;transition:border-color 0.3s,background 0.3s;flex-shrink:0; }
  .coaching-lane.inactive { border:1.5px dashed #d1d5db;background:#f9fafb; }
  .coaching-lane.active   { border:1.5px solid #c4b5fd;background:linear-gradient(135deg,#f5f3ff,#eff6ff); }
  .p-badge { width:1.35rem;height:1.35rem;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;font-size:0.6rem;font-weight:800;flex-shrink:0;vertical-align:middle; }
  .p-badge-grey { background:#e5e7eb;border:2px solid #9ca3af;color:#6b7280; }
  .p-badge-gold { background:#facc15;border:2px solid #ca8a04;color:#713f12; }
  .revenue-card-wrap { position:fixed;right:0;z-index:140;width:2.8rem;transition:width 0.4s cubic-bezier(0.22,1,0.36,1); }
  .revenue-card-wrap.expanded { width:min(28rem,90vw); }
  .revenue-card-locked { background:#9ca3af;border-radius:0.6rem 0 0 0.6rem;overflow:hidden;box-shadow:-3px 0 10px rgba(0,0,0,0.15); }
  .revenue-card-unlocked { background:linear-gradient(135deg,#7c3aed,#db2777);border-radius:0.6rem 0 0 0.6rem;overflow:hidden;box-shadow:-4px 0 24px rgba(124,58,237,0.4);cursor:pointer; }
  .earnings-banner { min-height:3.5rem;display:flex;flex-direction:column;justify-content:center; }
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useRef, useCallback, useEffect } = React;

const CONTACT = {
  displayName:'Adrian', fullName:'Adrian Croft', title:'UW Partner',
  photoUrl:'https://raw.githubusercontent.com/aqcroft/UW_PET_GH_v2/main/Adrian_Croft.jpg',
  whatsappNumber:'447787400800',
  whatsappMessage:"Hi Adrian, I've just used your earnings tool and I'd like to know more",
  email:'adrian.croft@uw.partners', emailSubject:'Your UW earnings tool',
  emailBody:"Hi Adrian, I've just used your earnings tool and I'd like to know more",
  phone:'+447787400800', calendarUrl:'https://tidycal.com/aqcroft/uwcost',
  registrationUrl:'https://uw.partners/adrian.croft/partner/join',
  savingsUrl:'https://uw.partners/adrian.croft/join',
};
const whatsappUrl=()=>`https://wa.me/${CONTACT.whatsappNumber}?text=${encodeURIComponent(CONTACT.whatsappMessage)}`;
const emailUrl=()=>`mailto:${CONTACT.email}?subject=${encodeURIComponent(CONTACT.emailSubject)}&body=${encodeURIComponent(CONTACT.emailBody)}`;
const phoneUrl=()=>`tel:${CONTACT.phone}`;

const TrendingUp=({style})=>(<svg style={style||{width:'1rem',height:'1rem',flexShrink:0}} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/></svg>);
const RefreshCw=({style})=>(<svg style={style||{width:'1rem',height:'1rem',flexShrink:0}} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>);
const X=({style})=>(<svg style={style||{width:'1rem',height:'1rem',flexShrink:0}} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12"/></svg>);
const ChevronDown=({style})=>(<svg style={style||{width:'1rem',height:'1rem',flexShrink:0}} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7"/></svg>);
const ChevronUp=({style})=>(<svg style={style||{width:'1rem',height:'1rem',flexShrink:0}} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 15l7-7 7 7"/></svg>);
const ChevronLeft=({style})=>(<svg style={style||{width:'1rem',height:'1rem',flexShrink:0}} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7"/></svg>);
const ChevronRight=({style})=>(<svg style={style||{width:'1rem',height:'1rem',flexShrink:0}} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7"/></svg>);
const SM={width:'1rem',height:'1rem',flexShrink:0};
const MD={width:'1.25rem',height:'1.25rem',flexShrink:0};
const XS={width:'0.875rem',height:'0.875rem',flexShrink:0};

const PulsingBulb=({size='1rem',onDone})=>{
  const [pulsing,setPulsing]=useState(true);
  useEffect(()=>{const t=setTimeout(()=>{setPulsing(false);if(onDone)onDone();},950);return()=>clearTimeout(t);},[]);
  return <span className={pulsing?'pulse-twice':''} style={{display:'inline-flex',alignItems:'center',fontSize:size,lineHeight:1,flexShrink:0}}>ğŸ’¡</span>;
};
const Bulb=({size='1rem',grey=false})=><span style={{fontSize:size,lineHeight:1,flexShrink:0,filter:grey?'grayscale(1)':'none',opacity:grey?0.4:1}}>ğŸ’¡</span>;

const WaIcon=()=>(<svg viewBox="0 0 24 24" fill="#374151" style={{width:'1.15rem',height:'1.15rem'}}><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>);
const EmailIcon=()=>(<svg viewBox="0 0 24 24" fill="none" stroke="#374151" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={{width:'1.15rem',height:'1.15rem'}}><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>);
const PhoneIcon=()=>(<svg viewBox="0 0 24 24" fill="none" stroke="#374151" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={{width:'1.15rem',height:'1.15rem'}}><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07A19.5 19.5 0 013.07 9.81a19.79 19.79 0 01-3.07-8.69A2 2 0 012.18 1h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L6.91 8.09a16 16 0 006 6l.56-.56a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 16.92z"/></svg>);

const IntroModal=({onClose})=>(
  <div className="intro-modal-overlay">
    <div className="animate-slideDown" style={{background:'white',borderRadius:'1rem',overflow:'hidden',maxWidth:'26rem',width:'100%',boxShadow:'0 20px 60px rgba(0,0,0,0.35)'}}>
      <div style={{background:'linear-gradient(135deg,#7c3aed,#db2777)',padding:'1.4rem 1.5rem 1.25rem',textAlign:'center'}}>
        <div style={{fontSize:'1.6rem',marginBottom:'0.35rem'}}>ğŸ‘‹</div>
        <h2 style={{fontSize:'1.3rem',fontWeight:'800',color:'white',margin:'0 0 0.05rem',lineHeight:1.25}}>Welcome to this</h2>
        <h2 style={{fontSize:'1.3rem',fontWeight:'800',color:'white',margin:0,lineHeight:1.25}}>interactive earnings tool</h2>
      </div>
      <div style={{padding:'1.25rem 1.5rem 1.5rem',textAlign:'center'}}>
        <p style={{fontWeight:'700',color:'#92400e',fontSize:'0.95rem',margin:'0 0 1.1rem',background:'#fefce8',padding:'0.5rem 0.75rem',borderRadius:'0.5rem',border:'1px solid #fde68a'}}>5 conversations up to Â£2000? Explore how</p>
        <p style={{fontSize:'0.875rem',color:'#374151',margin:'0 0 0.7rem',lineHeight:1.65}}>UW Partners help people save on essential services they already use: broadband, energy and mobile.</p>
        <p style={{fontSize:'0.875rem',color:'#374151',fontWeight:'700',margin:'0 0 0.7rem',lineHeight:1.65}}>Bundles build benefits â€” for customers and Partners.<br/>When customers win, Partners win. ğŸ†</p>
        <p style={{fontSize:'0.875rem',color:'#374151',margin:'0 0 0.85rem',lineHeight:1.65}}>Add customers and watch the numbers change.</p>
        <p style={{fontSize:'0.875rem',color:'#374151',fontWeight:'700',fontStyle:'italic',margin:'0 0 1.4rem',lineHeight:1.5}}>ğŸ’¡ Explore, experiment and learn as you play.</p>
        <button onClick={onClose} style={{width:'100%',padding:'0.85rem',background:'linear-gradient(135deg,#7c3aed,#db2777)',border:'none',borderRadius:'0.6rem',color:'white',fontWeight:'800',fontSize:'1.05rem',cursor:'pointer',boxShadow:'0 4px 14px rgba(124,58,237,0.4)'}}>Let's go ğŸš€</button>
      </div>
    </div>
  </div>
);

const CoachingLane=({message,showArrow,stagedActiveCount,stagedPulseIndex,postCelebArrow,postCelebArrowPulseKey,stagedIsFirstReveal})=>{
  const [visible,setVisible]=useState(false);
  const [displayed,setDisplayed]=useState(null);
  const [fading,setFading]=useState(false);
  const [arrowPulseKey,setArrowPulseKey]=useState(0);
  const autoTimer=useRef(null);
  const fadeTimer=useRef(null);
  const clearAll=()=>{clearTimeout(autoTimer.current);clearTimeout(fadeTimer.current);};
  const isPermanent=(msg)=>msg&&(msg==='__staged__');
  const show=(msg,keepAlive)=>{
    clearAll();setFading(false);setDisplayed(msg);setVisible(true);
    if(!keepAlive&&!isPermanent(msg)){
      autoTimer.current=setTimeout(()=>{setFading(true);fadeTimer.current=setTimeout(()=>{setVisible(false);setDisplayed(null);setFading(false);},450);},10000);
    }
  };
  const hide=()=>{clearAll();setFading(true);fadeTimer.current=setTimeout(()=>{setVisible(false);setDisplayed(null);setFading(false);},450);};
  useEffect(()=>{if(message){show(message,showArrow||isPermanent(message));}else{if(visible)hide();}return clearAll;},[message]);
  useEffect(()=>{
    if(!showArrow&&visible&&displayed&&!isPermanent(displayed)){
      clearAll();
      autoTimer.current=setTimeout(()=>{setFading(true);fadeTimer.current=setTimeout(()=>{setVisible(false);setDisplayed(null);setFading(false);},450);},10000);
    }
  },[showArrow]);
  useEffect(()=>{if(showArrow&&visible)setArrowPulseKey(k=>k+1);},[showArrow,visible]);

  const isStaged=displayed==='__staged__';
  const isActive=visible&&displayed;

  // "So... what's next?" header appears immediately; lines build after 2.5s pause
  // stagedActiveCount drives visibility: 0=header only, 1/2/3=lines visible
  const lineData=[
    {text:'ğŸ” Keep exploring customer types'},
    {text:'ğŸ” Understand how we\'re paid'},
    {text:'ğŸ§­ See Next Steps'},
  ];

  return(
    <div className={`coaching-lane ${isActive?'active':'inactive'}`}>
      <span style={{fontSize:'1.5rem',lineHeight:1,flexShrink:0,filter:isActive?'none':'grayscale(1)',opacity:isActive?1:0.25,transition:'none'}}>ğŸ’¡</span>
      {isActive&&(
        <span className={fading?'coach-out':'coach-in'} style={{display:'flex',alignItems:'center',flex:1}}>
          {showArrow?(
            /* Partner prompt â€” 3 lines */
            <span style={{display:'flex',flexDirection:'column',gap:'0.15rem',width:'100%',textAlign:'center'}}>
              <span style={{fontSize:'0.78rem',fontWeight:'700',fontStyle:'italic',color:'#374151',lineHeight:1.5}}>ğŸ™Œ Six customers done â€” nearly there!</span>
              <span style={{fontSize:'0.78rem',fontWeight:'700',fontStyle:'italic',color:'#374151',lineHeight:1.5}}>Upgrade one to Partner to unlock QD*</span>
              <span style={{display:'flex',flexWrap:'wrap',alignItems:'center',gap:'0.3rem',justifyContent:'center',lineHeight:1.8}}>
                <span style={{fontSize:'0.78rem',fontWeight:'700',fontStyle:'italic',color:'#374151'}}>Tap a</span>
                <span className="p-badge p-badge-grey">P</span>
                <span style={{fontSize:'0.78rem',fontWeight:'700',fontStyle:'italic',color:'#374151'}}>to upgrade:</span>
                <span key={`arrow-${arrowPulseKey}`} className={`p-badge p-badge-grey${arrowPulseKey>0?' p-badge-glow':''}`}>P</span>
                <span style={{fontSize:'1.1rem',lineHeight:1}}>â¡ï¸</span>
                <span className="p-badge p-badge-gold">P</span>
              </span>
            </span>
          ):isStaged?(
            /* 3 fixed rows. stagedActiveCount=0: "So... what's next?" in row 2.
               stagedActiveCount 1/2/3: option lines fill rows 1/2/3, header gone */
            <span style={{display:'flex',flexDirection:'column',width:'100%',textAlign:'center',height:'100%',justifyContent:'space-between'}}>
              {stagedActiveCount===0?(
                /* Header phase â€” centred in the middle row */
                <>
                  <span style={{display:'block',fontSize:'0.78rem',lineHeight:1.5,color:'transparent',userSelect:'none'}}>placeholder</span>
                  <span className="coach-in" style={{display:'block',fontSize:'1.17rem',fontWeight:'700',fontStyle:'italic',color:'#374151',lineHeight:1.4,textAlign:'center'}}>
                    So... what's next?
                  </span>
                  <span style={{display:'block',fontSize:'0.78rem',lineHeight:1.5,color:'transparent',userSelect:'none'}}>placeholder</span>
                </>
              ):(
                /* Option lines phase â€” 3 rows, each reveals in turn */
                lineData.map((line,i)=>{
                  const isPulsing=stagedPulseIndex===i;
                  const isVisible=i<stagedActiveCount;
                  return(
                    <span key={i} className={isPulsing?(stagedIsFirstReveal?'line-pulse-double':'line-pulse'):''} style={{
                      display:'block',fontSize:'0.78rem',fontWeight:'700',fontStyle:'italic',
                      color:isVisible?'#374151':'transparent',
                      lineHeight:1.5,transformOrigin:'center center',
                      transition:'color 0.5s ease',
                      userSelect:'none'
                    }}>{line.text}</span>
                  );
                })
              )}
            </span>
          ):(
            /* Standard message â€” check for post-celebration arrow */
            <span style={{fontSize:'0.78rem',fontWeight:'700',fontStyle:'italic',color:'#374151',textAlign:'center',width:'100%'}}>
              {displayed&&displayed.split('\n').map((line,i,arr)=>{
                const isLast=i===arr.length-1;
                return(
                  <span key={i} style={{display:'block',lineHeight:1.55}}>
                    {line}
                    {isLast&&postCelebArrow&&(
                      <span key={`pcArrow-${postCelebArrowPulseKey}`} className={postCelebArrowPulseKey>0?'arrow-pulse':''} style={{fontSize:'1.1rem',marginLeft:'0.3rem',display:'inline-block',lineHeight:1,verticalAlign:'middle'}}>â¡ï¸</span>
                    )}
                  </span>
                );
              })}
            </span>
          )}
        </span>
      )}
      {/* Ghost â€” always reserves fixed 3-row height, invisible */}
      {!isActive&&(
        <span style={{display:'flex',flexDirection:'column',width:'100%',height:'100%',justifyContent:'space-between',visibility:'hidden',pointerEvents:'none'}}>
          {lineData.map((_,i)=>(<span key={i} style={{display:'block',fontSize:'0.78rem',lineHeight:1.5}}>placeholder</span>))}
        </span>
      )}
    </div>
  );
};

const ContactPanel=({grandTotal,isOpen,onClose,tabColoured,onTabClick,tabPulseExternal,tabPulseCount})=>{
  const initials=CONTACT.fullName.split(' ').map(n=>n[0]).join('').slice(0,2);
  const [tabPulseKey,setTabPulseKey]=useState(0);
  const prevColoured=useRef(false);
  useEffect(()=>{if(tabColoured&&!prevColoured.current){setTimeout(()=>setTabPulseKey(k=>k+1),300);}prevColoured.current=tabColoured;},[tabColoured]);
  useEffect(()=>{if(tabPulseExternal>0)setTabPulseKey(k=>k+1);},[tabPulseExternal]);
  const tabClass=`left-pull-tab${isOpen?' panel-open':''} ${tabColoured?'tab-coloured':'tab-grey'}`;
  const pulseClass=tabPulseKey>0?(tabPulseCount>=2?'tab-pulse-double':'tab-pulse-single'):'';
  return(
    <>
      <div className={`contact-panel-overlay${isOpen?' visible':''}`} onClick={onClose}/>
      <div key={`tab-${tabPulseKey}`} className={`${tabClass}${pulseClass?' '+pulseClass:''}`} onClick={onTabClick}>
        <span style={{fontSize:'1.1rem',lineHeight:1,display:'block',marginBottom:'0.25rem',filter:tabColoured?'none':'grayscale(1)',opacity:tabColoured?1:0.6,transform:'rotate(90deg)'}}>{isOpen?'':tabColoured?'ğŸ”“':'ğŸ”'}</span>
        <span className="pull-tab-label" style={{transform:'none'}}>{isOpen?'Close':tabColoured?'Next Steps':'Get in touch'}</span>
      </div>
      <div className={`contact-panel${isOpen?' open':''}`}>
        <div style={{background:'linear-gradient(135deg,rgba(124,58,237,0.75),rgba(219,39,119,0.75))',padding:'1.6rem 1.25rem 1.3rem',textAlign:'center',position:'relative',flexShrink:0}}>
          <button onClick={onClose} style={{position:'absolute',top:'0.75rem',right:'0.75rem',width:'1.75rem',height:'1.75rem',borderRadius:'50%',background:'rgba(255,255,255,0.15)',border:'none',cursor:'pointer',color:'rgba(255,255,255,0.8)',fontSize:'0.9rem',display:'flex',alignItems:'center',justifyContent:'center'}}>âœ•</button>
          <img src={CONTACT.photoUrl} alt={CONTACT.fullName} style={{width:'4rem',height:'4rem',borderRadius:'50%',border:'2.5px solid rgba(255,255,255,0.7)',objectFit:'cover',margin:'0 auto 0.5rem',display:'block'}} onError={e=>{e.currentTarget.style.display='none';e.currentTarget.nextSibling.style.display='flex';}}/>
          <div style={{width:'4rem',height:'4rem',borderRadius:'50%',border:'2.5px solid rgba(255,255,255,0.7)',background:'rgba(124,58,237,0.6)',margin:'0 auto 0.5rem',display:'none',alignItems:'center',justifyContent:'center',fontWeight:'800',fontSize:'1.2rem',color:'white'}}>{initials}</div>
          <p style={{color:'white',fontWeight:'700',fontSize:'0.85rem',margin:'0 0 0.75rem',lineHeight:1.3}}>{CONTACT.fullName} Â· {CONTACT.title}</p>
          <span style={{color:'rgba(255,255,255,0.85)',fontWeight:'700',fontSize:'0.95rem',display:'block',marginBottom:'0.2rem'}}>What would an extra</span>
          <span style={{display:'block',fontWeight:'800',fontSize:'0.95rem',marginBottom:'0.45rem',lineHeight:'1.3'}}><span style={{color:'#fde68a'}}>Â£{grandTotal.toLocaleString()} </span><span style={{color:'rgba(255,255,255,0.85)'}}>mean to you?</span></span>
          <span style={{color:'rgba(255,255,255,0.72)',fontSize:'0.82rem',fontStyle:'italic',lineHeight:'1.4',display:'block'}}>Are you ready to make it happen?</span>
        </div>
        <div style={{padding:'1rem',display:'flex',flexDirection:'column',gap:'0.5rem',flex:1}}>
          {[
            {href:CONTACT.registrationUrl,icon:'ğŸ”¥',title:'Jump in',sub:"'I'm ready to get registered and start earning'",shadow:'rgba(109,40,217,0.3)'},
            {href:CONTACT.calendarUrl,icon:'ğŸ—“ï¸',title:'Book in',sub:"'I've got questions and I'd love a chat'",shadow:'rgba(168,85,247,0.3)'},
            {href:CONTACT.savingsUrl,icon:'ğŸ’¡',title:'Explore Savings',sub:"'I'd like to see the customer benefits.'",shadow:'rgba(234,179,8,0.3)'},
          ].map(btn=>(
            <a key={btn.title} href={btn.href} target="_blank" rel="noopener noreferrer" style={{minHeight:'5.5rem',borderRadius:'0.75rem',display:'flex',alignItems:'center',gap:'0.7rem',padding:'0.8rem 0.9rem',background:'white',boxShadow:`3px 3px 10px ${btn.shadow}`,textDecoration:'none',transition:'transform 0.15s'}} onMouseEnter={e=>e.currentTarget.style.transform='scale(1.02)'} onMouseLeave={e=>e.currentTarget.style.transform='scale(1)'} onClick={onClose}>
              <span style={{fontSize:'1.3rem',lineHeight:1,flexShrink:0}}>{btn.icon}</span>
              <span style={{flex:1}}><span style={{fontWeight:'700',fontSize:'0.9rem',display:'block',color:'#1f2937'}}>{btn.title}</span><span style={{fontSize:'0.73rem',marginTop:'0.2rem',display:'block',fontStyle:'italic',lineHeight:'1.35',color:'#6b7280'}}>{btn.sub}</span></span>
            </a>
          ))}
          <div style={{borderRadius:'0.75rem',background:'white',boxShadow:'3px 3px 10px rgba(219,39,119,0.3)',padding:'0.8rem 0.9rem 0.85rem',transition:'transform 0.15s'}} onMouseEnter={e=>e.currentTarget.style.transform='scale(1.02)'} onMouseLeave={e=>e.currentTarget.style.transform='scale(1)'}>
            <div style={{display:'flex',alignItems:'center',gap:'0.7rem',marginBottom:'0.65rem'}}>
              <span style={{fontSize:'1.3rem',lineHeight:1,flexShrink:0}}>ğŸ‘‹</span>
              <span style={{flex:1}}><span style={{fontWeight:'700',fontSize:'0.9rem',display:'block',color:'#1f2937'}}>Say hi</span><span style={{fontSize:'0.73rem',marginTop:'0.2rem',display:'block',fontStyle:'italic',lineHeight:'1.35',color:'#6b7280'}}>'I'd love help with my next step'</span></span>
            </div>
            <div style={{display:'flex',gap:'0.6rem',justifyContent:'center'}}>
              {[{href:whatsappUrl(),icon:<WaIcon/>,title:'WhatsApp'},{href:emailUrl(),icon:<EmailIcon/>,title:'Email'},{href:phoneUrl(),icon:<PhoneIcon/>,title:'Call'}].map(btn=>(
                <a key={btn.title} href={btn.href} target="_blank" rel="noopener noreferrer" title={btn.title} style={{width:'2.5rem',height:'2.5rem',borderRadius:'50%',background:'#f3f4f6',border:'1.5px solid #e5e7eb',display:'flex',alignItems:'center',justifyContent:'center',transition:'background 0.15s,transform 0.15s',flexShrink:0,textDecoration:'none'}} onMouseEnter={e=>{e.currentTarget.style.background='#e5e7eb';e.currentTarget.style.transform='scale(1.1)';}} onMouseLeave={e=>{e.currentTarget.style.background='#f3f4f6';e.currentTarget.style.transform='scale(1)';}} onClick={onClose}>{btn.icon}</a>
              ))}
            </div>
          </div>
        </div>
      </div>
    </>
  );
};

const ProfileBubble=()=>{
  const [open,setOpen]=useState(false);
  const [sayhiOpen,setSayhiOpen]=useState(false);
  const toggle=()=>{const n=!open;setOpen(n);if(!n)setSayhiOpen(false);};
  return(
    <div className="profile-bubble-wrap">
      <button className="profile-photo-btn" onClick={toggle} aria-label={open?'Close menu':'Open menu'}>
        <img src={CONTACT.photoUrl} alt={CONTACT.fullName} onError={e=>{e.currentTarget.style.display='none';e.currentTarget.nextSibling.style.display='flex';}}/>
        <span className="initials" style={{display:'none'}}>{CONTACT.fullName.split(' ').map(n=>n[0]).join('').slice(0,2)}</span>
      </button>
      <div className={`bubble-name-wrap${open?' hidden':''}`}><div className="bubble-name-primary">{CONTACT.fullName}</div><div className="bubble-name-secondary">{CONTACT.title}</div></div>
      <div className={`fab-actions${open?' open':''}`}>
        <a href={CONTACT.registrationUrl} target="_blank" rel="noopener noreferrer" className="fab-action-btn fab-btn-jumpin" onClick={()=>setOpen(false)}><span className="fab-icon">ğŸ”¥</span><span>Jump in</span></a>
        <a href={CONTACT.calendarUrl} target="_blank" rel="noopener noreferrer" className="fab-action-btn fab-btn-bookin" onClick={()=>setOpen(false)}><span className="fab-icon">ğŸ—“ï¸</span><span>Book in</span></a>
        <div style={{display:'flex',flexDirection:'column',alignItems:'flex-end',gap:'0.3rem'}}>
          <button className="fab-action-btn fab-btn-sayhi" onClick={e=>{e.stopPropagation();setSayhiOpen(s=>!s);}}><span className="fab-icon">ğŸ‘‹</span><span>Say hi</span></button>
          <div className={`sayhi-icons-row${sayhiOpen?' open':''}`}>
            <a href={whatsappUrl()} target="_blank" rel="noopener noreferrer" className="fab-icon-circle"><svg viewBox="0 0 24 24" fill="#374151"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg></a>
            <a href={emailUrl()} className="fab-icon-circle"><svg viewBox="0 0 24 24" fill="none" stroke="#374151" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a>
            <a href={phoneUrl()} className="fab-icon-circle"><svg viewBox="0 0 24 24" fill="none" stroke="#374151" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07A19.5 19.5 0 013.07 9.81a19.79 19.79 0 01-3.07-8.69A2 2 0 012.18 1h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L6.91 8.09a16 16 0 006 6l.56-.56a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 16.92z"/></svg></a>
          </div>
        </div>
      </div>
    </div>
  );
};

const box={background:'#fdf8f0',borderRadius:'0.5rem',padding:'0.75rem',marginBottom:'0.5rem',border:'1px solid #f3e8d0'};
const closing={fontStyle:'italic',fontWeight:'700',color:'#374151',margin:0};
const scbSummary=(isOpen)=>(<span>Upfront payment when we support a Partner to introduce a homeowner.{' '}<span style={{fontStyle:'italic',fontSize:'0.72rem',color:'#7c3aed',opacity:isOpen?1:0,transition:'opacity 0.15s'}}>ğŸ”“ Unlocks at 6 Personal Customers.</span></span>);
const mbSummary=(isOpen)=>(<span>Up to Â£400 when a Partner we introduce reaches QD.<br/><span style={{fontStyle:'italic',fontSize:'0.72rem',color:'#7c3aed',opacity:isOpen?1:0,transition:'opacity 0.15s'}}>ğŸ”“ Unlocks at 3 Personal Customers.</span></span>);
const sections=[
  {id:'cb',icon:<span style={{fontSize:'1.1rem'}}>ğŸ’·</span>,title:'Customer Bonus',summary:'Upfront payment when we introduce a homeowner customer.',detail:(<div style={{fontSize:'0.875rem',color:'#374151'}}><p style={{marginBottom:'0.5rem'}}>Paid when services go live:</p><div style={{...box,display:'grid',gridTemplateColumns:'1fr 1fr',gap:'0.25rem'}}><span>1ï¸âƒ£ service â€” Â£50</span><span>3ï¸âƒ£ services â€” Â£250</span><span>2ï¸âƒ£ services â€” Â£100</span><span>4ï¸âƒ£ services â€” Â£300</span></div><p style={closing}>ğŸ’¡ The more customers we introduce, the more we earn.</p></div>)},
  {id:'hab',icon:<span style={{fontSize:'1.1rem'}}>ğŸ”¥</span>,title:'High Activity Bonus',summary:'Extra reward for multiple 3+ service homeowners in one calendar month.',detail:(<div style={{fontSize:'0.875rem',color:'#374151'}}><p style={{marginBottom:'0.5rem'}}>On top of Customer Bonus:</p><div style={box}><div>2ï¸âƒ£ or more homeowners â€” Â£50 each</div><div>4ï¸âƒ£ or more homeowners â€” Â£100 each</div></div><p style={closing}>ğŸ’¡ With Customer Bonus that's up to Â£400 per homeowner.</p></div>)},
  {id:'ri',icon:<RefreshCw style={{...SM,color:'#2563eb'}}/>,title:'Recurring (Residual) Income',summary:"Ongoing monthly income from our personal customers and our team's customers.",detail:(<div style={{fontSize:'0.875rem',color:'#374151'}}><p style={{marginBottom:'0.5rem'}}>A recurring profit share of customers' bills which increases as customers add more services.</p><div style={{...box,marginBottom:'0.5rem'}}><p style={{fontStyle:'italic',fontSize:'0.72rem',color:'#7c3aed',margin:'0 0 0.5rem',lineHeight:'1.3'}}>ğŸ”“ Unlocks at 3 personal customers (QD)</p><p style={{margin:'0 0 0.3rem',display:'flex',alignItems:'center',gap:'0.3rem',flexWrap:'wrap'}}><RefreshCw style={{width:'0.75rem',height:'0.75rem',flexShrink:0,color:'#2563eb'}}/><span style={{fontSize:'0.8rem'}}>ğŸ‘¤</span><strong>Personal Customers</strong><span style={{fontWeight:'400',fontStyle:'italic',color:'#6b7280',fontSize:'0.78rem'}}>â€” % of bill, typically</span></p><div style={{marginBottom:'0.45rem',paddingLeft:'0.3rem',fontSize:'0.82rem'}}><div>â€¢ Tenant â€” Â£2â€“Â£3 /month <span style={{color:'#6b7280',fontSize:'0.72rem'}}>(after first bill paid)</span></div><div>â€¢ Homeowner â€” Â£3â€“Â£5 /month <span style={{color:'#6b7280',fontSize:'0.72rem'}}>(after a set period)</span></div></div><div style={{borderTop:'1px solid #c4b5fd',paddingTop:'0.4rem'}}><p style={{margin:'0 0 0.3rem',display:'flex',alignItems:'center',gap:'0.3rem',flexWrap:'wrap'}}><RefreshCw style={{width:'0.75rem',height:'0.75rem',flexShrink:0,color:'#2563eb'}}/><span style={{fontSize:'0.8rem'}}>ğŸ‘¥</span><strong>Team (Group) Customers</strong><span style={{fontWeight:'400',fontStyle:'italic',color:'#6b7280',fontSize:'0.78rem'}}>â€” pence per service, typically</span></p><div style={{paddingLeft:'0.3rem',fontSize:'0.82rem'}}>â€¢ 30â€“50p /month per customer</div></div></div><p style={closing}>ğŸ’¡ Grows steadily as our customers and team expand.</p></div>)},
  {id:'scb',icon:<span style={{fontSize:'1.1rem'}}>ğŸ¤</span>,title:'Supporting Customer Bonus',summary:scbSummary,detail:(<div style={{fontSize:'0.875rem',color:'#374151'}}><p style={{marginBottom:'0.5rem'}}>We receive <strong>50%</strong> of the full Customer Bonus.</p><div style={{...box,fontSize:'0.8rem',marginBottom:'0.5rem'}}><div style={{marginBottom:'0.25rem'}}>â±ï¸ <strong>First 45 days</strong> â€” in addition to their Customer Bonus</div><div style={{marginBottom:'0.4rem'}}>â¡ï¸ <strong>After 45 days</strong> â€” Customer Bonus is shared 50:50</div><div style={{borderTop:'1px solid #c4b5fd',paddingTop:'0.4rem',display:'grid',gridTemplateColumns:'1fr 1fr',gap:'0.25rem'}}><span>1ï¸âƒ£ service â€” Â£25</span><span>3ï¸âƒ£ services â€” Â£125</span><span>2ï¸âƒ£ services â€” Â£50</span><span>4ï¸âƒ£ services â€” Â£150</span></div></div><p style={closing}>ğŸ’¡ An extra income stream from helping Partners introduce homeowners.</p></div>)},
  {id:'mb',icon:<span style={{fontSize:'1.1rem'}}>ğŸ“</span>,title:'Mentor Bonus',summary:mbSummary,detail:(<div style={{fontSize:'0.875rem',color:'#374151'}}><p style={{marginBottom:'0.5rem',fontWeight:'600'}}>QD = 3 Personal Customers + 1 Partner introduced</p><div style={box}><div style={{display:'flex',alignItems:'center',gap:'0.4rem'}}><span>ğŸ“</span><span>Mentor Bonus â€” Â£100</span></div><div style={{display:'flex',alignItems:'center',gap:'0.4rem',marginTop:'0.25rem'}}><TrendingUp style={{width:'0.75rem',height:'0.75rem',color:'#374151'}}/><span>30 days Mentor Fast Starter Bonus â€” Â£300</span></div><div style={{borderTop:'1px solid #c4b5fd',marginTop:'0.5rem',paddingTop:'0.5rem',paddingLeft:'1.5rem'}}>Total â€” Â£400 per Partner</div></div><p style={closing}>ğŸ’¡ Rewarding us for developing new Partners â€” with even more for Fast Starter.</p></div>)},
];

const HowPaidPopup=({onClose,fastStarterAchieved,revenueExplored})=>{
  const [openId,setOpenId]=useState(null);
  const headerRefs=useRef({});
  const toggle=useCallback((id)=>{const opening=openId!==id;setOpenId(opening?id:null);if(opening&&headerRefs.current[id])headerRefs.current[id].scrollIntoView({behavior:'instant',block:'start'});},[openId]);
  const bulbMsg=fastStarterAchieved&&revenueExplored?null:fastStarterAchieved&&!revenueExplored?"ğŸ’¡ You've explored your earnings. Next, see how helping others unlocks three new revenue streams.":"ğŸ’¡ Have a play with the Partner Earnings Tool to explore and understand what's possible.";
  return(
    <div style={{position:'fixed',inset:0,background:'rgba(0,0,0,0.5)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:200,padding:'0.75rem'}} onClick={onClose}>
      <div style={{background:'white',borderRadius:'0.75rem',boxShadow:'0 20px 50px rgba(0,0,0,0.3)',maxWidth:'28rem',width:'100%',display:'flex',flexDirection:'column',height:'85vh'}} onClick={e=>e.stopPropagation()}>
        <div style={{background:'linear-gradient(135deg,#7c3aed,#db2777)',padding:'1rem 1rem 0.85rem',borderRadius:'0.75rem 0.75rem 0 0',flexShrink:0}}>
          <div style={{display:'flex',alignItems:'center',justifyContent:'space-between'}}>
            <h3 style={{fontSize:'1.05rem',fontWeight:'700',color:'white',margin:0}}>ğŸ” Understanding how partners are paid</h3>
            <button onClick={onClose} style={{marginLeft:'0.75rem',width:'1.75rem',height:'1.75rem',borderRadius:'50%',background:'rgba(255,255,255,0.2)',border:'none',cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',flexShrink:0}}><X style={{...XS,color:'white'}}/></button>
          </div>
        </div>
        <div style={{background:'white',padding:'0.6rem 1rem',borderBottom:'1px solid #e5e7eb',flexShrink:0,display:'flex',justifyContent:'center'}}>
          <div style={{background:'#fefce8',border:'1px solid #fde68a',borderRadius:'0.5rem',padding:'0.45rem 0.85rem',boxShadow:'0 2px 6px rgba(0,0,0,0.1)',maxWidth:'fit-content'}}>
            <p style={{fontSize:'0.78rem',color:'#92400e',margin:0,lineHeight:1.4,fontWeight:'600',textAlign:'center'}}>See how different income streams build as customer and partner numbers grow.</p>
          </div>
        </div>
        <div className="accordion-list" style={{overflowY:'auto',flex:1,padding:'0.6rem',display:'flex',flexDirection:'column',gap:'0.4rem'}}>
          {sections.map(s=>{const isOpen=openId===s.id;return(
            <div key={s.id} style={{border:'1px solid #e5e7eb',borderRadius:'0.6rem',overflow:'hidden',background:'white'}}>
              <button ref={el=>headerRefs.current[s.id]=el} style={{width:'100%',display:'flex',alignItems:'center',gap:'0.6rem',padding:'0.6rem 0.75rem',textAlign:'left',background:'none',border:'none',cursor:'pointer'}} onClick={()=>toggle(s.id)}>
                <span style={{flexShrink:0,display:'flex',alignItems:'center'}}>{s.icon}</span>
                <div style={{flex:1,minWidth:0}}><p style={{fontWeight:'600',fontSize:'0.85rem',color:'#111827',margin:'0 0 0.1rem'}}>{s.title}</p><p style={{fontSize:'0.78rem',color:'#6b7280',margin:0,lineHeight:'1.4'}}>{typeof s.summary==='function'?s.summary(isOpen):s.summary}</p></div>
                {isOpen?<ChevronUp style={{...SM,color:'#9ca3af'}}/>:<ChevronDown style={{...SM,color:'#9ca3af'}}/>}
              </button>
              {isOpen&&<div style={{padding:'0.25rem 0.75rem 0.75rem',borderTop:'1px solid #f3f4f6',background:'#fdf9ff'}}>{s.detail}</div>}
            </div>
          );})}
          {bulbMsg&&(<div style={{margin:'0.25rem 0 0',padding:'0.55rem 0.8rem',borderRadius:'0.5rem',background:'#fdf3e3',border:'1px solid #f9d49c'}}><p style={{margin:0,fontSize:'0.78rem',fontWeight:'700',fontStyle:'italic',color:'#92400e',lineHeight:1.5}}>{bulbMsg}</p></div>)}
        </div>
      </div>
    </div>
  );
};

// Right-side revenue tab â€” always present, grey until unlocked, expands on tap. Never disappears.
const RevenueCard=({grandTotal,supportingBonus,partnerTotalEarnings,onInteracted,wiggle,topOffset,cardHeight,unlocked,revTabPulseKey,revTabPulseCount,closeKey})=>{
  const [expanded,setExpanded]=useState(false);
  useEffect(()=>{if(closeKey>0)setExpanded(false);},[closeKey]);
  const handleToggle=()=>{
    if(!unlocked)return;
    if(!expanded){setExpanded(true);onInteracted&&onInteracted();}
    else{setExpanded(false);}
  };
  return(
    <div
      className={`revenue-card-wrap${expanded?' expanded':''}${wiggle?' revenue-wiggle':''}`}
      style={{top:`${topOffset}px`,height:`${cardHeight}px`,transition:'width 0.4s cubic-bezier(0.22,1,0.36,1)'}}
    >
      {unlocked?(
        /* Unlocked â€” gradient */
        <div className="revenue-card-unlocked" style={{height:'100%',display:'flex',overflow:'hidden'}}>
          <div key={`rtab-${revTabPulseKey}`} className={revTabPulseKey>0?(revTabPulseCount>=2?'rev-tab-pulse-double':'rev-tab-pulse-single'):''} onClick={handleToggle} style={{flexShrink:0,width:'2.8rem',display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',gap:'0.35rem',cursor:'pointer',userSelect:'none'}}>
            {expanded
              ?<ChevronRight style={{...SM,color:'rgba(255,255,255,0.9)'}}/>
              :<ChevronLeft style={{...SM,color:'rgba(255,255,255,0.9)'}}/>
            }
            {!expanded&&(
              <span style={{writingMode:'vertical-rl',textOrientation:'mixed',fontSize:'0.62rem',fontWeight:'400',color:'rgba(255,255,255,0.95)',letterSpacing:'0.08em',textTransform:'uppercase',lineHeight:1.3,textAlign:'center'}}>
                ğŸ”“ 3 Revenue Streams
              </span>
            )}
          </div>
          <div style={{flex:1,overflowY:'auto',opacity:expanded?1:0,transition:'opacity 0.3s 0.1s',pointerEvents:expanded?'auto':'none',minWidth:0}}>
            <div style={{padding:'0.75rem 0.9rem 0.9rem'}}>
              <p style={{color:'white',fontWeight:'700',fontSize:'0.82rem',margin:'0 0 0.5rem',lineHeight:1.3}}>ğŸ”“ Three new revenue streams unlocked!</p>
              <div style={{display:'flex',flexDirection:'column',gap:'0.25rem',marginBottom:'0.65rem'}}>
                {[
                  {icon:'ğŸ¤',label:'Supporting Customer Bonus',val:`Â£${supportingBonus.toLocaleString()}`},
                  {icon:'ğŸ“',label:'Mentor Bonus',val:'Â£100'},
                  {icon:null,label:'Fast Starter Mentor Bonus',val:'Â£300'}
                ].map(s=>(
                  <div key={s.label} style={{display:'flex',alignItems:'center',justifyContent:'space-between',gap:'0.4rem',fontSize:'0.78rem',background:'rgba(255,255,255,0.12)',borderRadius:'0.4rem',padding:'0.3rem 0.6rem'}}>
                    <span style={{color:'#fbcfe8',display:'flex',alignItems:'center',gap:'0.35rem'}}>{s.icon?<span style={{fontSize:'0.85rem',lineHeight:1,flexShrink:0}}>{s.icon}</span>:<TrendingUp style={{width:'0.75rem',height:'0.75rem',flexShrink:0,color:'#fbcfe8'}}/>}{s.label}</span>
                    <span style={{color:'#fde68a',fontWeight:'700',flexShrink:0}}>{s.val}</span>
                  </div>
                ))}
              </div>
              <div style={{background:'rgba(255,255,255,0.1)',borderRadius:'0.5rem',padding:'0.55rem 0.65rem'}}>
                <p style={{color:'white',fontWeight:'600',fontSize:'0.72rem',margin:'0 0 0.35rem'}}>For each Partner you recruit and support to QD*:</p>
                <div style={{display:'flex',justifyContent:'space-between',color:'white',fontSize:'0.76rem',marginBottom:'0.15rem'}}><span style={{color:'#fbcfe8'}}>You earn (in this example)</span><span style={{fontWeight:'700',color:'#fde68a'}}>Â£{partnerTotalEarnings.toLocaleString()}</span></div>
                <div style={{borderTop:'1px solid rgba(255,255,255,0.25)',paddingTop:'0.2rem',display:'flex',justifyContent:'space-between',fontSize:'0.8rem'}}><span style={{color:'#fbcfe8'}}>They earn (same as you did)</span><span style={{fontWeight:'700',color:'#fde68a'}}>Â£{grandTotal.toLocaleString()}</span></div>
              </div>
            </div>
          </div>
        </div>
      ):(
        /* Locked â€” same grey as left tab, padlock at top then text */
        <div className="revenue-card-locked" style={{height:'100%',display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',padding:'0.5rem 0.2rem',gap:'0.4rem'}}>
          <span style={{fontSize:'1.05rem',lineHeight:1,filter:'grayscale(1)',opacity:0.5,transform:'rotate(90deg)',display:'block',marginBottom:'0.3rem'}}>ğŸ”</span>
          <span style={{writingMode:'vertical-rl',textOrientation:'mixed',fontSize:'0.62rem',fontWeight:'400',color:'#f9fafb',letterSpacing:'0.08em',textTransform:'uppercase',lineHeight:1.3,textAlign:'center',opacity:0.85}}>
            3 New Revenue Streams
          </span>
        </div>
      )}
    </div>
  );
};

const UWTracker=()=>{
  const [showIntro,setShowIntro]=useState(true);
  const [showCelebration,setShowCelebration]=useState(false);
  const [showContactPanel,setShowContactPanel]=useState(false);
  const [tabColoured,setTabColoured]=useState(false);
  const [tabPulseExternal,setTabPulseExternal]=useState(0);
  const [tabPulseCount,setTabPulseCount]=useState(2);
  const [selectedCircle,setSelectedCircle]=useState(null);
  const [showResetConfirm,setShowResetConfirm]=useState(false);
  const [showInfoPopup,setShowInfoPopup]=useState(false);
  const [includeYou,setIncludeYou]=useState(true);
  const [youTooltipVisible,setYouTooltipVisible]=useState(false);
  const [youBulbPulsed,setYouBulbPulsed]=useState(false);
  const [fastStarterAchieved,setFastStarterAchieved]=useState(false);
  const [infoBulbPulsed,setInfoBulbPulsed]=useState(false);
  const [infoBulbPulseKey,setInfoBulbPulseKey]=useState(0);
  const [infoBulbPulseCount,setInfoBulbPulseCount]=useState(2);
  const [infoBulbColoured,setInfoBulbColoured]=useState(false);
  const [showBestGuess,setShowBestGuess]=useState(false);
  const [hasInteracted,setHasInteracted]=useState(false);
  const [firstCustomerDone,setFirstCustomerDone]=useState(false);
  const [coachMsg,setCoachMsg]=useState(null);
  const [coachArrow,setCoachArrow]=useState(false);
  const [revenueExplored,setRevenueExplored]=useState(false);
  const [revenueCardVisible,setRevenueCardVisible]=useState(false);
  const [revenueWiggle,setRevenueWiggle]=useState(false);
  const [circleGlowKey,setCircleGlowKey]=useState(0);
  const [circleGlowCount,setCircleGlowCount]=useState(2);
  const [pBadgeGlow,setPBadgeGlow]=useState(false);
  const [postCelebArrow,setPostCelebArrow]=useState(false);
  const [postCelebArrowPulseKey,setPostCelebArrowPulseKey]=useState(0);
  const [revTabPulseKey,setRevTabPulseKey]=useState(0);
  const [revTabPulseCount,setRevTabPulseCount]=useState(2);
  const [revenueCloseKey,setRevenueCloseKey]=useState(0);

  // Staged coaching sequence
  const [stagedActiveCount,setStagedActiveCount]=useState(0);
  const [stagedPulseIndex,setStagedPulseIndex]=useState(-1);
  const [stagedIsFirstReveal,setStagedIsFirstReveal]=useState(true);
  const stagedStarted=useRef(false);

  // Separate refs for precise right-card positioning: top of CB banner â†’ bottom of RI banner
  const cbBannerRef=useRef(null);
  const riBannerRef=useRef(null);
  const bannersRef=useRef(null);
  const [cardTopOffset,setCardTopOffset]=useState(200);
  const [cardHeight,setCardHeight]=useState(200);

  useEffect(()=>{
    const updatePos=()=>{
      if(!cbBannerRef.current||!riBannerRef.current)return;
      const cbRect=cbBannerRef.current.getBoundingClientRect();
      const riRect=riBannerRef.current.getBoundingClientRect();
      setCardTopOffset(cbRect.top+window.scrollY);
      setCardHeight(riRect.bottom-cbRect.top);
    };
    updatePos();
    window.addEventListener('resize',updatePos);
    window.addEventListener('scroll',updatePos,{passive:true});
    return()=>{window.removeEventListener('resize',updatePos);window.removeEventListener('scroll',updatePos);};
  },[]);

  const qdShown=useRef(false);
  const mixShown=useRef(false);
  const habAShown=useRef(false);
  const habBShown=useRef(false);
  const habCShown=useRef(false);
  const previouslyQualified=useRef(false);
  const tooltipTimer=useRef(null);
  const stageRevealTimer=useRef(null);

  const [customers,setCustomers]=useState([
    {type:'own',services:0,isPartner:false},{type:null,services:0,isPartner:false},{type:null,services:0,isPartner:false},
    {type:null,services:0,isPartner:false},{type:null,services:0,isPartner:false},{type:null,services:0,isPartner:false},
  ]);

  const calculateCB=(customer,index)=>{
    if(!includeYou&&index===0){if(customer.type==='homeowner'){if(customer.services===1)return 50;if(customer.services===2)return 100;if(customer.services===3)return 250;if(customer.services===4)return 300;}return 0;}
    if(customer.type==='own'||customer.type==='renting')return 0;
    if(customer.type==='homeowner'){if(customer.services===1)return 50;if(customer.services===2)return 100;if(customer.services===3)return 250;if(customer.services===4)return 300;}
    return 0;
  };
  const highActivityCustomers=customers.filter((c,i)=>includeYou?i>0&&c.type==='homeowner'&&(c.services===3||c.services===4):c.type==='homeowner'&&(c.services===3||c.services===4)).length;
  const habPerCustomer=highActivityCustomers>=4?100:highActivityCustomers>=2?50:0;
  const totalHAB=highActivityCustomers*habPerCustomer;
  const totalCB=customers.reduce((sum,c,i)=>sum+calculateCB(c,i),0);
  const hasPartner=customers.some((c,i)=>includeYou?i>0&&c.isPartner:c.isPartner);
  const allCirclesFilled=customers.every(c=>c.type!==null);
  const qualifiesForFastStarter=allCirclesFilled&&hasPartner;
  const fastStarterBonus=qualifiesForFastStarter?500:0;
  const grandTotal=totalCB+totalHAB+fastStarterBonus;
  const tenantCount=customers.filter((c,i)=>includeYou?i>0&&c.type==='renting':c.type==='renting').length;
  const residualIncome=tenantCount*2.5;
  const supportingBonus=Math.round(totalCB/2);
  const partnerTotalEarnings=supportingBonus+100+300;
  const filledNonYou=customers.filter((c,i)=>includeYou?i>0&&c.type!==null:c.type!==null).length;
  const totalForQD=(includeYou?1:0)+filledNonYou;
  const recurringActive=tenantCount>0&&totalForQD>=3;
  const nonYouFilled=customers.filter((c,i)=>includeYou?i>0&&c.type!==null:c.type!==null);
  const totalCircles=includeYou?5:6;
  const fourFilledForHAB=nonYouFilled.length===(totalCircles-2);  // 4th circle just filled
  const fiveFilled=nonYouFilled.length===(totalCircles-1);         // 5th circle just filled (mix message)
  const allHomeowners=nonYouFilled.length>0&&nonYouFilled.every(c=>c.type==='homeowner');
  const allTenants=nonYouFilled.length>0&&nonYouFilled.every(c=>c.type==='renting');

  useEffect(()=>{
    // QD message
    if(!qdShown.current&&totalForQD>=3){
      qdShown.current=true;setCoachArrow(false);
      setTimeout(()=>setCoachMsg("That's 3 customers = QD achieved! ğŸ‰\nRecurring (residual) income unlocked.\nNow your income builds!"),500);
      return;
    }
    // Trigger A â€” circle 4 just filled, no HAB yet â€” fire once only
    if(!habAShown.current&&fourFilledForHAB&&!fiveFilled&&highActivityCustomers===0&&!qualifiesForFastStarter){
      habAShown.current=true;setCoachArrow(false);
      setTimeout(()=>setCoachMsg("Consider making your last two customers\n3+ service homeowners to activate\nthe Â£50 High Activity Bonus â¬‡ï¸"),500);
      return;
    }
    // Mix message â€” 5th circle, all same type
    if(!mixShown.current&&fiveFilled&&!qualifiesForFastStarter){
      if(allHomeowners){
        mixShown.current=true;setCoachArrow(false);
        // If HAB already active, nudge tenant specifically
        if(highActivityCustomers>=2){
          setTimeout(()=>setCoachMsg("All homeowners so far â€” why not try a tenant?\nSee what happens to Recurring Income â¬‡ï¸"),500);
        } else {
          setTimeout(()=>setCoachMsg("All homeowners so far.\nTry adding a tenant.\nSee what changes. â¬‡ï¸"),500);
        }
      }
      else if(allTenants){mixShown.current=true;setCoachArrow(false);setTimeout(()=>setCoachMsg("All tenants so far.\nTry adding a homeowner.\nSee what changes."),500);}
    }
  },[totalForQD,fourFilledForHAB,fiveFilled,allHomeowners,allTenants,qualifiesForFastStarter,highActivityCustomers]);

  // Reactive HAB threshold messages â€” only fire once circle 4 is reached
  useEffect(()=>{
    if(nonYouFilled.length<totalCircles-2)return;
    if(highActivityCustomers===1&&!habBShown.current){
      habBShown.current=true;setCoachArrow(false);
      setTimeout(()=>setCoachMsg("You've got one homeowner with 3+ services â€”\nadd a second to unlock\nthe Â£50 High Activity Bonus â¬‡ï¸"),500);
    }
    else if(highActivityCustomers>=2&&!habCShown.current){
      habCShown.current=true;setCoachArrow(false);
      setTimeout(()=>setCoachMsg("Â£50 High Activity Bonus activated! ğŸ”¥\nIntroduce 4 homeowners with 3+ services\nto jump to Â£100 â¬‡ï¸"),500);
    }
  },[highActivityCustomers,nonYouFilled.length]);

  useEffect(()=>{
    if(allCirclesFilled&&!hasPartner&&!qualifiesForFastStarter){
      const msgTimer=setTimeout(()=>{
        setCoachArrow(true);setCoachMsg('__partner_prompt__');
        setTimeout(()=>{
          setPBadgeGlow(true);setTimeout(()=>setPBadgeGlow(false),2100);
        },3000);
      },1500);
      return()=>clearTimeout(msgTimer);
    }
    else if(allCirclesFilled&&hasPartner){setCoachArrow(false);if(coachMsg==='__partner_prompt__')setCoachMsg(null);}
  },[allCirclesFilled,hasPartner,qualifiesForFastStarter]);

  // Staged sequence â€” fires 9s after first revenue card interaction
  const startStagedSequence=useCallback(()=>{
    if(stagedStarted.current)return;
    stagedStarted.current=true;
    setCoachMsg('__staged__');
    setCoachArrow(false);
    setPostCelebArrow(false);

    // Helper: pulse a line + its paired element
    const pulse=(lineIdx,circleCount,bulb,tab)=>{
      setStagedPulseIndex(lineIdx);
      if(circleCount)setCircleGlowKey(k=>k+1);
      if(bulb)setInfoBulbPulseKey(k=>k+1);
      if(tab)setRevTabPulseKey(k=>k+1);
      setTimeout(()=>setStagedPulseIndex(-1),1400);
    };

    // FIRST REVEAL â€” 2 pulses on all elements
    setCircleGlowCount(2);
    setInfoBulbPulseCount(2);
    setTimeout(()=>{ setStagedActiveCount(1); pulse(0,true,false,false); },2500);
    setTimeout(()=>{ setStagedActiveCount(2); setInfoBulbColoured(true); pulse(1,false,true,false); },5000);
    setTimeout(()=>{ setStagedActiveCount(3); setTabColoured(true); pulse(2,false,false,true); },7500);

    // Switch to 1 pulse for repeat cycles
    setTimeout(()=>{ setCircleGlowCount(1); setInfoBulbPulseCount(1); setRevTabPulseCount(1); setTabPulseCount(1); setStagedIsFirstReveal(false); },10500);

    // REPEAT CYCLES â€” 1 pulse each
    const repeat=(baseT)=>{
      setTimeout(()=>pulse(0,true,false,false),baseT);
      setTimeout(()=>pulse(1,false,true,false),baseT+2500);
      setTimeout(()=>pulse(2,false,false,true),baseT+5000);
    };
    repeat(11000);
    repeat(19500);
    repeat(28000);
  },[]);

  const circleColor=(c)=>{if(c.type===null)return{border:'#d1d5db',text:'#9ca3af',bg:'#f9fafb'};if(c.type==='own')return{border:'#9ca3af',text:'#374151',bg:'#f3f4f6'};if(c.type==='renting')return{border:'#2563eb',text:'#1d4ed8',bg:'#eff6ff'};return{border:'#7c3aed',text:'#6d28d9',bg:'#f5f3ff'};};
  const getCircleOpacity=(index)=>{if(index===0&&includeYou)return 1;if(!includeYou){for(let i=0;i<index;i++)if(customers[i].type===null)return 0.3;return 1;}for(let i=1;i<index;i++)if(customers[i].type===null)return 0.3;return 1;};
  const canSelectCircle=(index)=>{if(index===0&&includeYou)return false;if(!includeYou){if(allCirclesFilled)return true;for(let i=0;i<index;i++)if(customers[i].type===null)return false;return true;}if(allCirclesFilled)return true;for(let i=1;i<index;i++)if(customers[i].type===null)return false;return true;};
  const ordinal=(n)=>n===1?'1st':n===2?'2nd':n===3?'3rd':`${n}th`;

  const triggerCelebration=()=>{
    setShowCelebration(true);setCoachMsg(null);setCoachArrow(false);clearTimeout(stageRevealTimer.current);
    setTimeout(()=>{
      setShowCelebration(false);setFastStarterAchieved(true);
      setTimeout(()=>{
        setCoachMsg("You've seen what you can earn.\nNow see what happens when you help others.\nExplore the three unlocked revenue streams");
        setPostCelebArrow(true);
        stageRevealTimer.current=setTimeout(()=>{
          setRevenueCardVisible(true);
          // Synced: arrow pulses + revenue tab pulses together
          const syncPulse=()=>{
            setPostCelebArrowPulseKey(k=>k+1);
            setRevTabPulseKey(k=>k+1);
          };
          setTimeout(syncPulse,600);
        },2000);
      },2500);
    },3000);
  };

  // Revenue interacted: mark explored, 9s later start staged sequence
  const handleRevenueInteracted=()=>{
    if(revenueExplored)return;
    setRevenueExplored(true);
    setTimeout(startStagedSequence,9000);
  };

  const handlePartnerBadgeClick=(e,index)=>{
    e.stopPropagation();
    if((index===0&&includeYou)||customers[index].type===null)return;
    const wasQualified=qualifiesForFastStarter;
    const nc=[...customers];nc[index]={...nc[index],isPartner:!nc[index].isPartner};setCustomers(nc);
    const nowQualifies=nc.every(c=>c.type!==null)&&nc.some((c,i)=>includeYou?i>0&&c.isPartner:c.isPartner);
    if(!wasQualified&&nowQualifies&&!previouslyQualified.current){previouslyQualified.current=true;setTimeout(triggerCelebration,200);}
    if(!nowQualifies)previouslyQualified.current=false;
  };

  const handleCircleClick=(index)=>{
    if((index===0&&includeYou)||!canSelectCircle(index))return;
    if(!hasInteracted){setHasInteracted(true);setShowBestGuess(true);}
    setSelectedCircle(index);
  };

  const setCustomerType=(type,services)=>{
    if(selectedCircle===null)return;
    const wasQualified=qualifiesForFastStarter;
    const nc=[...customers];nc[selectedCircle]={type,services:services||0,isPartner:nc[selectedCircle].isPartner};
    setCustomers(nc);setSelectedCircle(null);setShowBestGuess(false);
    const nonYouCount=nc.filter((c,i)=>includeYou?i>0&&c.type!==null:c.type!==null).length;
    if(!firstCustomerDone&&nonYouCount===1){setFirstCustomerDone(true);setTimeout(()=>setCoachMsg("ğŸ™Œ Nice work! ğŸ™Œ\nNow keep going â€” try different customer types\nand watch your income grow."),500);}
    const nowAllFilled=nc.every(c=>c.type!==null);
    const nowHasPartner=nc.some((c,i)=>includeYou?i>0&&c.isPartner:c.isPartner);
    const nowQualifies=nowAllFilled&&nowHasPartner;
    if(!wasQualified&&nowQualifies&&!previouslyQualified.current){previouslyQualified.current=true;setTimeout(triggerCelebration,200);}
    if(!nowQualifies)previouslyQualified.current=false;
  };

  const removeCustomer=()=>{if(selectedCircle===null)return;const nc=[...customers];nc[selectedCircle]={type:null,services:0,isPartner:false};setCustomers(nc);setSelectedCircle(null);previouslyQualified.current=false;setShowBestGuess(false);};

  const resetTracking=()=>{
    setCustomers([{type:includeYou?'own':null,services:0,isPartner:false},{type:null,services:0,isPartner:false},{type:null,services:0,isPartner:false},{type:null,services:0,isPartner:false},{type:null,services:0,isPartner:false},{type:null,services:0,isPartner:false}]);
    setSelectedCircle(null);setShowResetConfirm(false);
    previouslyQualified.current=false;qdShown.current=false;mixShown.current=false;stagedStarted.current=false;
    habAShown.current=false;habBShown.current=false;habCShown.current=false;
    setHasInteracted(false);setShowBestGuess(false);setCoachMsg(null);setCoachArrow(false);
    setTabColoured(false);setTabPulseExternal(0);setTabPulseCount(2);setFastStarterAchieved(false);setInfoBulbPulsed(false);setInfoBulbPulseKey(0);setInfoBulbColoured(false);setInfoBulbPulseCount(2);setRevTabPulseCount(2);setCircleGlowCount(2);
    setYouBulbPulsed(false);setRevenueCardVisible(false);setRevenueExplored(false);
    setFirstCustomerDone(false);setCircleGlowKey(0);setRevenueWiggle(false);setPBadgeGlow(false);
    setStagedActiveCount(0);setStagedPulseIndex(-1);setStagedIsFirstReveal(true);
    setPostCelebArrow(false);setPostCelebArrowPulseKey(0);setRevTabPulseKey(0);
    clearTimeout(tooltipTimer.current);clearTimeout(stageRevealTimer.current);
    setYouTooltipVisible(false);
  };

  const toggleIncludeYou=()=>{const niy=!includeYou;setIncludeYou(niy);const nc=[...customers];nc[0]={type:niy?'own':null,services:0,isPartner:false};setCustomers(nc);setSelectedCircle(null);previouslyQualified.current=false;};
  const openYouTooltip=()=>{clearTimeout(tooltipTimer.current);setYouTooltipVisible(v=>{if(!v){tooltipTimer.current=setTimeout(()=>setYouTooltipVisible(false),5000);}return!v;});};

  // Bulb only activates after all 3 staged lines are fully visible
  const infoBulbActive=fastStarterAchieved&&revenueExplored&&stagedActiveCount>=3;

  return(
    <div style={{minHeight:'100vh',background:'linear-gradient(135deg,#fdf2f8,#f5f3ff)',padding:'1rem'}}>
      {showIntro&&<IntroModal onClose={()=>setShowIntro(false)}/>}
      <ProfileBubble/>
      <ContactPanel
        grandTotal={grandTotal}
        isOpen={showContactPanel}
        onClose={()=>setShowContactPanel(false)}
        tabColoured={tabColoured}
        onTabClick={()=>setShowContactPanel(o=>!o)}
        tabPulseExternal={tabPulseExternal}
        tabPulseCount={tabPulseCount}
      />
      {showCelebration&&(<div style={{position:'fixed',inset:0,pointerEvents:'none',zIndex:50}}>{[...Array(50)].map((_,i)=>(<div key={i} className="animate-confetti" style={{position:'absolute',left:`${Math.random()*100}%`,top:'-10%',animationDelay:`${Math.random()*0.5}s`,animationDuration:`${2+Math.random()}s`}}><div style={{color:'#facc15',fontSize:`${Math.random()*20+10}px`,transform:`rotate(${Math.random()*360}deg)`}}>âœ¨</div></div>))}</div>)}

      <div style={{maxWidth:'36rem',margin:'0 auto',paddingLeft:'2.5rem',paddingRight:'2.5rem'}} onClick={()=>setRevenueCloseKey(k=>k+1)}>
        <div style={{marginBottom:'0.6rem'}}>
          <h1 style={{fontSize:'1.3rem',fontWeight:'700',color:'#1f2937',marginBottom:'0.25rem',textAlign:'center'}}>UW Partner Earnings Tool</h1>
          <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',gap:'1rem'}}>
            <div style={{display:'flex',flexDirection:'column',alignItems:'flex-start',gap:'0.3rem',position:'relative'}}>
              <div style={{display:'flex',flexDirection:'column',alignItems:'flex-start',gap:'0.15rem'}}>
                <button onClick={()=>setShowResetConfirm(true)} style={{background:'none',border:'1px solid #d1d5db',borderRadius:'0.3rem',cursor:'pointer',padding:'0.1rem 0.4rem',fontSize:'0.65rem',fontWeight:'600',color:'#9ca3af',lineHeight:1.4,marginBottom:'0.1rem'}}>Reset</button>
                <button onClick={openYouTooltip} style={{background:'none',border:'none',cursor:'pointer',padding:'0.1rem',display:'flex',alignItems:'center',lineHeight:1}}>
                  {!youBulbPulsed?<PulsingBulb size="0.95rem" onDone={()=>setYouBulbPulsed(true)}/>:<Bulb size="0.95rem"/>}
                </button>
                <div style={{display:'flex',alignItems:'center',gap:'0.5rem'}}>
                  <button onClick={toggleIncludeYou} style={{position:'relative',display:'inline-flex',height:'1.5rem',width:'2.75rem',alignItems:'center',borderRadius:'9999px',border:'none',cursor:'pointer',background:includeYou?'#22c55e':'#d1d5db',transition:'background 0.2s'}}>
                    <span style={{display:'inline-block',height:'1rem',width:'1rem',transform:includeYou?'translateX(1.5rem)':'translateX(0.25rem)',borderRadius:'50%',background:'white',transition:'transform 0.2s',boxShadow:'0 1px 3px rgba(0,0,0,0.2)'}}></span>
                  </button>
                  <span style={{fontSize:'0.875rem',fontWeight:'600',color:'#374151'}}>You</span>
                </div>
              </div>
              {/* Tooltip â€” now matches coaching lane colour scheme */}
              {youTooltipVisible&&(<div style={{position:'fixed',top:'3.5rem',left:'0.75rem',right:'0.75rem',maxWidth:'260px',background:'linear-gradient(135deg,#f5f3ff,#eff6ff)',border:'1.5px solid #c4b5fd',color:'#374151',fontSize:'0.75rem',borderRadius:'0.5rem',padding:'0.55rem 0.8rem',lineHeight:1.5,zIndex:400,boxShadow:'0 4px 14px rgba(124,58,237,0.18)',textAlign:'center',animation:'slideDown 0.2s ease-out forwards',fontWeight:'700',fontStyle:'italic'}}>ğŸ’¡ Most Partners also use UW themselves to save on their own household bills. Toggle this off any time.</div>)}
            </div>
            <p style={{fontSize:'0.875rem',color:'#6b7280',flex:1,textAlign:'center'}}>Explore what <strong>{includeYou?'five':'six'}</strong> customers could earn you in the first 30 days</p>
            <div style={{width:'5rem'}}></div>
          </div>
        </div>

        <div style={{background:'white',borderRadius:'1rem',boxShadow:'0 4px 16px rgba(0,0,0,0.08)',padding:'0.85rem'}}>
          <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:'0.6rem',marginBottom:'0.6rem'}}>
            {customers.map((customer,index)=>{
              const col=circleColor(customer);const cb=calculateCB(customer,index);
              const showHAB=customer.type==='homeowner'&&(customer.services===3||customer.services===4)&&highActivityCustomers>=2;
              const glowStyle=circleGlowKey>0&&customer.type!==null?{animation:`circleGlowAnim 1.2s ease-in-out ${circleGlowCount}`}:{};
              const badgeGlowClass=pBadgeGlow&&!customer.isPartner&&customer.type!==null?'p-badge-glow':'';
              const partnerClickable=allCirclesFilled;
              return(
                <div key={`${index}-${circleGlowKey}`} style={{display:'flex',flexDirection:'column',alignItems:'center',position:'relative'}}>
                  <div onClick={()=>handleCircleClick(index)} style={{width:'5rem',height:'5rem',borderRadius:'50%',border:`4px solid ${col.border}`,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',fontSize:'1.125rem',fontWeight:'700',position:'relative',background:col.bg,color:col.text,cursor:canSelectCircle(index)?'pointer':'not-allowed',opacity:getCircleOpacity(index),transition:'transform 0.15s',boxSizing:'border-box',...glowStyle}}>
                    {(index===0&&includeYou)?<span style={{fontSize:'1rem',fontWeight:'700'}}>You</span>
                    :customer.type?(
                      <><span style={{fontSize:'0.875rem',fontWeight:'700'}}>Â£{cb.toLocaleString()}</span>
                      {showHAB&&<div style={{position:'absolute',top:'-0.25rem',right:'-0.25rem',padding:'0.125rem 0.25rem',background:'#f97316',color:'white',fontSize:'0.625rem',fontWeight:'700',borderRadius:'0.25rem',zIndex:10}}>+Â£{habPerCustomer}</div>}
                      <div onClick={(e)=>{if(partnerClickable)handlePartnerBadgeClick(e,index);}} className={badgeGlowClass} style={{position:'absolute',bottom:'-0.25rem',right:'-0.25rem',width:'1.5rem',height:'1.5rem',borderRadius:'50%',border:`2px solid ${customer.isPartner?'#ca8a04':'#9ca3af'}`,display:'flex',alignItems:'center',justifyContent:'center',zIndex:10,cursor:partnerClickable?'pointer':'default',background:customer.isPartner?'#facc15':'#e5e7eb',transition:'transform 0.15s',opacity:partnerClickable?1:0.5}}>
                        <span style={{fontSize:'0.625rem',fontWeight:'700',color:customer.isPartner?'#713f12':'#6b7280'}}>P</span>
                      </div></>
                    ):(
                      <><span style={{fontSize:'0.875rem'}}>{includeYou?ordinal(index):ordinal(index+1)}</span>
                      <div style={{position:'absolute',bottom:'-0.25rem',right:'-0.25rem',width:'1.5rem',height:'1.5rem',borderRadius:'50%',border:'2px solid #9ca3af',display:'flex',alignItems:'center',justifyContent:'center',zIndex:10,background:'#e5e7eb'}}>
                        <span style={{fontSize:'0.625rem',fontWeight:'700',color:'#6b7280'}}>P</span>
                      </div></>
                    )}
                  </div>
                </div>
              );
            })}
          </div>

          <CoachingLane
            message={coachMsg}
            showArrow={coachArrow}
            stagedActiveCount={stagedActiveCount}
            stagedPulseIndex={stagedPulseIndex}
            postCelebArrow={postCelebArrow}
            postCelebArrowPulseKey={postCelebArrowPulseKey}
            stagedIsFirstReveal={stagedIsFirstReveal}
          />

          {/* Banners area â€” ref drives right-side card position */}
          <div ref={bannersRef} style={{display:'flex',flexDirection:'column',gap:'0.4rem'}}>
            <div ref={cbBannerRef} className="earnings-banner" style={{padding:'0.5rem 0.75rem',borderRadius:'0.5rem',border:`${totalCB>0?'4px':'2px'} solid ${totalCB>0?'#7c3aed':'#d1d5db'}`,background:totalCB>0?'#f5f3ff':'#f9fafb'}}>
              <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                <div style={{display:'flex',alignItems:'center',gap:'0.4rem'}}><span style={{fontSize:'1.1rem',filter:totalCB>0?'none':'grayscale(1)',opacity:totalCB>0?1:0.4}}>ğŸ’·</span><span style={{fontWeight:'600',fontSize:'0.85rem',color:totalCB>0?'#7c3aed':'#6b7280'}}>Customer Bonus:</span></div>
                <span style={{fontSize:'1.1rem',fontWeight:'700',color:totalCB>0?'#6d28d9':'#9ca3af'}}>Â£{totalCB.toLocaleString()}</span>
              </div>
            </div>

            <div className="earnings-banner" style={{padding:'0.5rem 0.75rem',borderRadius:'0.5rem',border:`${highActivityCustomers>=2?'4px':'2px'} solid ${highActivityCustomers>=2?'#f97316':'#e5e7eb'}`,background:highActivityCustomers>=2?'#fff7ed':'#f9fafb',opacity:highActivityCustomers>=2?1:0.5,transition:'opacity 0.3s,border-color 0.3s,background 0.3s'}}>
              <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                <div style={{display:'flex',alignItems:'center',gap:'0.4rem',flex:1,minWidth:0}}>
                  <span style={{fontSize:'1.1rem',filter:highActivityCustomers>=2?'none':'grayscale(1)',opacity:highActivityCustomers>=2?1:0.4,flexShrink:0}}>ğŸ”¥</span>
                  <span style={{fontWeight:'600',fontSize:'0.85rem',color:highActivityCustomers>=2?'#ea580c':'#6b7280',flexShrink:0}}>
                    {highActivityCustomers>=4?'Â£100 High Activity Bonus:':highActivityCustomers>=2?'Â£50 High Activity Bonus:':'High Activity Bonus:'}
                  </span>
                  {!highActivityCustomers&&<span style={{fontSize:'0.7rem',color:'#9ca3af',fontStyle:'italic',marginLeft:'0.3rem',whiteSpace:'nowrap',overflow:'hidden',textOverflow:'ellipsis'}}>Rewarding multiple 3+ service homeowners</span>}
                </div>
                <span style={{fontSize:'1.1rem',fontWeight:'700',color:highActivityCustomers>=2?'#ea580c':'#9ca3af',flexShrink:0}}>{highActivityCustomers>=2?`Â£${totalHAB.toLocaleString()}`:'â€”'}</span>
              </div>
            </div>

            <div className="earnings-banner" style={{padding:'0.5rem 0.75rem',borderRadius:'0.5rem',border:`${qualifiesForFastStarter?'4px':'2px'} solid ${qualifiesForFastStarter?'#86efac':'#e5e7eb'}`,background:qualifiesForFastStarter?'#f0fdf4':'#f9fafb'}}>
              <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                <div style={{display:'flex',alignItems:'center',gap:'0.4rem'}}><TrendingUp style={{...MD,color:qualifiesForFastStarter?'#16a34a':'#d1d5db'}}/><span style={{fontWeight:'600',fontSize:'0.85rem',color:qualifiesForFastStarter?'#16a34a':'#6b7280'}}>Fast Starter Bonus:</span></div>
                <span style={{fontSize:'1.1rem',fontWeight:'700',color:qualifiesForFastStarter?'#16a34a':'#9ca3af'}}>Â£{fastStarterBonus.toLocaleString()}</span>
              </div>
            </div>

            <div ref={riBannerRef} className="earnings-banner" style={{padding:'0.5rem 0.75rem',borderRadius:'0.5rem',border:`${recurringActive?'4px':'2px'} solid ${recurringActive?'#2563eb':'#d1d5db'}`,background:recurringActive?'#eff6ff':'#f9fafb',opacity:recurringActive?1:0.5,transition:'opacity 0.3s,border-color 0.3s'}}>
              <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                <div style={{display:'flex',alignItems:'center',gap:'0.4rem',flex:1,minWidth:0}}>
                  <RefreshCw style={{...MD,color:recurringActive?'#2563eb':'#d1d5db',flexShrink:0}}/>
                  <span style={{fontWeight:'600',fontSize:'0.85rem',color:recurringActive?'#374151':'#6b7280',flexShrink:0}}>Recurring Income:</span>
                  {!recurringActive&&<span style={{fontSize:'0.7rem',color:'#9ca3af',fontStyle:'italic',marginLeft:'0.3rem',whiteSpace:'nowrap',overflow:'hidden',textOverflow:'ellipsis'}}>Paid on tenants / renting customers</span>}
                </div>
                <div style={{textAlign:'right',flexShrink:0}}>
                  <span style={{fontSize:'1.1rem',fontWeight:'700',color:recurringActive?'#2563eb':'#9ca3af'}}>{recurringActive?`Â£${residualIncome.toFixed(2)}/m`:'â€”'}</span>
                  {recurringActive&&<span style={{display:'block',fontSize:'0.7rem',color:'#3b82f6'}}>(Â£{(residualIncome*12).toLocaleString()}/yr)</span>}
                </div>
              </div>
            </div>

            {/* TOTAL EARNINGS â€” z-index above revenue card */}
            <div className="earnings-banner" style={{padding:'0.6rem 0.75rem',borderRadius:'0.5rem',boxShadow:'0 2px 8px rgba(0,0,0,0.15)',color:'white',position:'relative',overflow:'hidden',zIndex:160}}>
              <div style={{position:'absolute',inset:0,background:grandTotal>0?'linear-gradient(to right,#7c3aed,#db2777)':'#9ca3af'}}></div>
              <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',position:'relative',zIndex:1}}>
                <div style={{display:'flex',alignItems:'center',gap:'0.5rem'}}>
                  <span style={{fontWeight:'700',fontSize:'1.125rem'}}>Total Earnings:</span>
                  <button key={`bulb-${infoBulbPulseKey}`} onClick={(e)=>{e.stopPropagation();setShowInfoPopup(true);}} style={{background:'none',border:'none',cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',padding:0,lineHeight:1}}>
                    <span key={`bulb-${infoBulbPulseKey}`} className={infoBulbPulseKey>0?(infoBulbPulseCount>=2?'bulb-pulse-double':'bulb-pulse-single'):''} style={{fontSize:'1.8rem',lineHeight:1,filter:infoBulbColoured?'none':'grayscale(1)',opacity:infoBulbColoured?1:0.5}}>ğŸ”</span>
                  </button>
                </div>
                <span style={{fontSize:'1.5rem',fontWeight:'700'}}>Â£{grandTotal.toLocaleString()}</span>
              </div>
            </div>
          </div>
        </div>


      </div>

      {/* Right-side revenue tab â€” always present, transitions greyâ†’colour on unlock */}
      <RevenueCard
        grandTotal={grandTotal}
        supportingBonus={supportingBonus}
        partnerTotalEarnings={partnerTotalEarnings}
        onInteracted={handleRevenueInteracted}
        wiggle={revenueWiggle}
        topOffset={cardTopOffset}
        cardHeight={cardHeight}
        unlocked={revenueCardVisible}
        revTabPulseKey={revTabPulseKey}
        revTabPulseCount={revTabPulseCount}
        closeKey={revenueCloseKey}
      />

      {showInfoPopup&&<HowPaidPopup onClose={()=>setShowInfoPopup(false)} fastStarterAchieved={fastStarterAchieved} revenueExplored={revenueExplored}/>}

      {selectedCircle!==null&&(
        <div style={{position:'fixed',inset:0,background:'rgba(0,0,0,0.3)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:50,padding:'1rem'}} onClick={()=>{setSelectedCircle(null);setShowBestGuess(false);}}>
          <div className="animate-slideDown" style={{background:'white',borderRadius:'0.75rem',padding:'1.5rem',boxShadow:'0 20px 50px rgba(0,0,0,0.3)',maxWidth:'24rem',width:'100%'}} onClick={e=>e.stopPropagation()}>
            <p style={{fontSize:'1rem',fontWeight:'700',color:'#111827',marginBottom:'0.15rem',textAlign:'center'}}>Choose a customer example</p>
            <p style={{fontSize:'0.82rem',color:'#6b7280',marginBottom:'0.75rem',textAlign:'center',fontStyle:'italic'}}>Homeowner or tenant â€” what would you like to try first?</p>
            {showBestGuess&&(
              <p style={{fontSize:'0.82rem',color:'#374151',fontWeight:'700',fontStyle:'italic',textAlign:'center',margin:'0 0 0.85rem',background:'#fef9c3',padding:'0.45rem 0.65rem',borderRadius:'0.4rem',lineHeight:'1.6'}}>
                ğŸ’¡ Just make your best guess<br/>â€” you can change this later.
              </p>
            )}
            <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:'0.5rem',marginBottom:'0.75rem'}}>
              {[1,2,3,4].map(num=>{const cb=[50,100,250,300][num-1];const active=customers[selectedCircle]&&customers[selectedCircle].type==='homeowner'&&customers[selectedCircle].services===num;return(
                <button key={num} onClick={()=>setCustomerType('homeowner',num)} style={{padding:'1rem 0.5rem',border:`2px solid ${active?'#7c3aed':'#c4b5fd'}`,borderRadius:'0.5rem',background:active?'#7c3aed':'#f5f3ff',color:active?'white':'#6d28d9',cursor:'pointer',fontWeight:'600'}}>
                  <div style={{fontSize:'1rem',fontWeight:'700'}}>{num}</div><div style={{fontSize:'0.75rem',marginTop:'0.25rem'}}>(Â£{cb})</div>
                </button>);})}
            </div>
            <p style={{textAlign:'center',fontSize:'0.875rem',color:'#6b7280',marginBottom:'0.75rem'}}>or</p>
            <button onClick={()=>setCustomerType('renting')} style={{width:'100%',padding:'0.75rem',border:`2px solid ${customers[selectedCircle]&&customers[selectedCircle].type==='renting'?'#2563eb':'#93c5fd'}`,borderRadius:'0.5rem',background:customers[selectedCircle]&&customers[selectedCircle].type==='renting'?'#2563eb':'#eff6ff',color:customers[selectedCircle]&&customers[selectedCircle].type==='renting'?'white':'#1d4ed8',cursor:'pointer',fontWeight:'600',marginBottom:'0.75rem'}}>
              <div style={{fontSize:'1rem',fontWeight:'700'}}>Tenant/Renting</div><div style={{fontSize:'0.75rem',fontWeight:'400'}}>(No customer bonus, just recurring income)</div>
            </button>
            {customers[selectedCircle]&&customers[selectedCircle].type!==null&&(
              <button onClick={removeCustomer} style={{width:'100%',padding:'0.75rem',border:'2px solid #fca5a5',borderRadius:'0.5rem',background:'#fef2f2',color:'#b91c1c',cursor:'pointer',fontWeight:'600'}}>Remove Customer</button>
            )}
          </div>
        </div>
      )}

      {showResetConfirm&&(
        <div style={{position:'fixed',inset:0,background:'rgba(0,0,0,0.3)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:50,padding:'1rem'}}>
          <div className="animate-slideDown" style={{background:'white',borderRadius:'0.75rem',padding:'1.5rem',boxShadow:'0 20px 50px rgba(0,0,0,0.3)',maxWidth:'24rem',width:'100%'}}>
            <p style={{fontSize:'1.125rem',fontWeight:'600',color:'#111827',marginBottom:'1rem',textAlign:'center'}}>Are you sure?</p>
            <p style={{fontSize:'0.875rem',color:'#6b7280',marginBottom:'1.5rem',textAlign:'center'}}>This will reset all customer data and cannot be undone.</p>
            <div style={{display:'flex',gap:'0.75rem'}}>
              <button onClick={()=>setShowResetConfirm(false)} style={{flex:1,padding:'0.5rem',background:'#e5e7eb',border:'none',borderRadius:'0.5rem',fontWeight:'600',color:'#374151',cursor:'pointer'}}>No</button>
              <button onClick={resetTracking} style={{flex:1,padding:'0.5rem',background:'#ef4444',border:'none',borderRadius:'0.5rem',fontWeight:'600',color:'white',cursor:'pointer'}}>Yes, Reset</button>
            </div>
          </div>
        </div>
      )}

      {showCelebration&&(
        <div style={{position:'fixed',inset:0,background:'rgba(0,0,0,0.5)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:40,padding:'1rem'}}>
          <div className="animate-bounceOnce" style={{background:'white',borderRadius:'1rem',padding:'2rem',maxWidth:'28rem',textAlign:'center',boxShadow:'0 20px 60px rgba(0,0,0,0.3)'}}>
            <div style={{fontSize:'3.75rem',marginBottom:'1rem'}}>ğŸ‰</div>
            <h2 style={{fontSize:'1.875rem',fontWeight:'700',color:'#7c3aed',marginBottom:'1rem'}}>Congratulations!</h2>
            <p style={{fontSize:'1.25rem',color:'#374151',marginBottom:'0.5rem'}}>You've qualified for the</p>
            <p style={{fontSize:'2.25rem',fontWeight:'700',color:'#16a34a',marginBottom:'0.15rem',lineHeight:1.15}}>Â£500 fast</p>
            <p style={{fontSize:'2.25rem',fontWeight:'700',color:'#16a34a',marginBottom:'1rem',lineHeight:1.15}}>starter bonus</p>
          </div>
        </div>
      )}
    </div>
  );
};

const root=ReactDOM.createRoot(document.getElementById('root'));
root.render(React.createElement(UWTracker));
</script>
</body>
</html>
