<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>UW Partner Earnings Tool</title>
<script src="https://cdn.tailwindcss.com"></script>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<style>
  @keyframes slideDown { 0%{opacity:0;transform:scale(0.95)} 100%{opacity:1;transform:scale(1)} }
  @keyframes confetti { 0%{transform:translateY(0) rotate(0deg);opacity:1} 100%{transform:translateY(100vh) rotate(360deg);opacity:0} }
  @keyframes bounceOnce { 0%,100%{transform:translateY(0)} 25%{transform:translateY(-20px)} 50%{transform:translateY(0)} 75%{transform:translateY(-10px)} }
  .animate-slideDown { animation: slideDown 0.2s ease-out forwards; }
  .animate-confetti { animation: confetti 3s ease-in forwards; }
  .animate-bounceOnce { animation: bounceOnce 0.6s ease-in-out; }
  * { box-sizing: border-box; }

  /* Landscape layout: two-column accordion list */
  @media (orientation: landscape) and (max-height: 500px) {
    .popup-inner {
      max-width: 56rem !important;
      max-height: 95vh !important;
    }
    .accordion-list {
      display: grid !important;
      grid-template-columns: 1fr 1fr !important;
      gap: 0.5rem !important;
      align-items: start !important;
    }
  }
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useRef } = React;

/* â”€â”€ SVG Icons â”€â”€ sized via explicit style prop â”€â”€ */
const defaultIconStyle = { width:'1rem', height:'1rem', flexShrink:0 };
const TrendingUp = ({ style }) => (
  <svg style={style||defaultIconStyle} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
  </svg>
);
const RefreshCw = ({ style }) => (
  <svg style={style||defaultIconStyle} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
  </svg>
);
const Lock = ({ style }) => (
  <svg style={style||defaultIconStyle} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
  </svg>
);
const Info = ({ style }) => (
  <svg style={style||defaultIconStyle} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <circle cx="12" cy="12" r="10" strokeWidth={2} />
    <path strokeLinecap="round" strokeWidth={2} d="M12 16v-4M12 8h.01" />
  </svg>
);
const X = ({ style }) => (
  <svg style={style||defaultIconStyle} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
  </svg>
);
const ChevronDown = ({ style }) => (
  <svg style={style||defaultIconStyle} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
  </svg>
);
const ChevronUp = ({ style }) => (
  <svg style={style||defaultIconStyle} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 15l7-7 7 7" />
  </svg>
);

const SM  = { width:'1rem',    height:'1rem',    flexShrink:0 };
const MD  = { width:'1.25rem', height:'1.25rem', flexShrink:0 };
const XS  = { width:'0.875rem',height:'0.875rem',flexShrink:0 };

/* â”€â”€ shared box style â€” all light purple, no bold in data rows â”€â”€ */
const box = { background:'#f5f3ff', borderRadius:'0.5rem', padding:'0.75rem', marginBottom:'0.5rem' };
const closingItalic = { fontStyle:'italic', fontWeight:'700', color:'#111827', margin:0 };

const sections = [
  {
    id: 'cb', icon: 'ğŸ’·', title: 'Customer Bonus',
    summary: 'Upfront payment when we introduce a homeowner customer.',
    detail: (
      <div style={{fontSize:'0.875rem',color:'#374151'}}>
        <p style={{marginBottom:'0.5rem'}}>Customer Bonus paid when services go live:</p>
        <div style={{...box, display:'grid', gridTemplateColumns:'1fr 1fr', gap:'0.25rem'}}>
          <span>1ï¸âƒ£ service â€” Â£50</span><span>3ï¸âƒ£ services â€” Â£250</span>
          <span>2ï¸âƒ£ services â€” Â£100</span><span>4ï¸âƒ£ services â€” Â£300</span>
        </div>
        <p style={closingItalic}>âœ¨ The more customers we introduce, the more we earn.</p>
      </div>
    ),
  },
  {
    id: 'hab', icon: 'ğŸ”¥', title: 'High Activity Bonus',
    summary: 'Extra reward for multiple 3+ service homeowners in one calendar month.',
    detail: (
      <div style={{fontSize:'0.875rem',color:'#374151'}}>
        <p style={{marginBottom:'0.5rem'}}>Added on top of Customer Bonus:</p>
        <div style={box}>
          <div>2ï¸âƒ£ or more homeowners â€” Â£50 each</div>
          <div>4ï¸âƒ£ or more homeowners â€” Â£100 each</div>
        </div>
        <p style={closingItalic}>ğŸ”¥ Customer Bonus + High Activity Bonus = up to Â£400 per homeowner.</p>
      </div>
    ),
  },
  {
    id: 'ri', icon: 'â™»ï¸', title: 'Residual Income',
    summary: "Ongoing monthly income from our customers â€” and our team's customers.",
    detail: (
      <div style={{fontSize:'0.875rem',color:'#374151'}}>
        <p style={{marginBottom:'0.5rem'}}>A recurring profit share of customers' bills, growing as they add services.</p>
        <div style={{...box, marginBottom:'0.35rem'}}>
          <p style={{fontWeight:'600',marginBottom:'0.35rem',margin:'0 0 0.35rem 0'}}>ğŸ‘¤ Personal Customers <span style={{fontWeight:'400',fontStyle:'italic',color:'#6b7280'}}>â€” % of the bill</span></p>
          <div>â€¢ Tenant â€” Â£2â€“Â£3 /m <span style={{color:'#6b7280',fontSize:'0.7rem'}}>(after first bill is paid)</span></div>
          <div>â€¢ Homeowner â€” Â£3â€“Â£5 /m <span style={{color:'#6b7280',fontSize:'0.7rem'}}>(after a set period of time)</span></div>
        </div>
        <div style={box}>
          <p style={{fontWeight:'600',margin:'0 0 0.35rem 0'}}>ğŸ‘¥ Team (Group) Customers <span style={{fontWeight:'400',fontStyle:'italic',color:'#6b7280'}}>â€” fixed pence per service</span></p>
          <div>â€¢ Typically Â£0.30â€“Â£0.50 per customer /m</div>
        </div>
        <p style={{...closingItalic, marginTop:'0.35rem'}}>â™»ï¸ Residual income grows month by month as our team and customer base grows.</p>
      </div>
    ),
  },
  {
    id: 'scb', icon: 'ğŸ¤', title: 'Supporting Customer Bonus',
    summary: 'Upfront payment when we support a Partner to introduce a homeowner.',
    detail: (
      <div style={{fontSize:'0.875rem',color:'#374151'}}>
        <p style={{marginBottom:'0.5rem'}}>We receive <strong>50%</strong> of the full Customer Bonus.</p>
        <div style={{...box, fontSize:'0.8rem'}}>
          <div style={{marginBottom:'0.2rem'}}>â±ï¸ <strong>First 45 days</strong> â€” in addition to their Customer Bonus</div>
          <div>â¡ï¸ <strong>After 45 days</strong> â€” from within their Customer Bonus</div>
        </div>
        <div style={{...box, display:'grid', gridTemplateColumns:'1fr 1fr', gap:'0.25rem', marginBottom:'0.5rem'}}>
          <span>1ï¸âƒ£ service â€” Â£25</span><span>3ï¸âƒ£ services â€” Â£125</span>
          <span>2ï¸âƒ£ services â€” Â£50</span><span>4ï¸âƒ£ services â€” Â£150</span>
        </div>
        <p style={closingItalic}>ğŸ¤ Supporting Partners is a win-win â€” they grow, we earn.</p>
      </div>
    ),
  },
  {
    id: 'mb', icon: 'ğŸ“', title: 'Mentoring Bonus',
    summary: 'Up to Â£400 when a Partner we introduce reaches QD*.',
    detail: (
      <div style={{fontSize:'0.875rem',color:'#374151'}}>
        <p style={{marginBottom:'0.5rem'}}>When a Partner reaches <strong>QD*</strong>:</p>
        <p style={{fontSize:'0.75rem',color:'#6b7280',marginBottom:'0.5rem',marginTop:'-0.25rem'}}>(6 personal customers + 1 Partner introduced)</p>
        <div style={box}>
          <div>ğŸ“ Mentoring Bonus â€” Â£100</div>
          <div>ğŸš€ Fast Start Bonus (within 30 days) â€” Â£300</div>
          <div style={{borderTop:'1px solid #c4b5fd',marginTop:'0.5rem',paddingTop:'0.5rem'}}>ğŸ“ğŸš€ Total â€” <strong style={{color:'#6d28d9'}}>Â£400</strong></div>
        </div>
        <p style={closingItalic}>ğŸ“ Every Partner we mentor to QD earns us up to Â£400.</p>
      </div>
    ),
  },
];

const HowPaidPopup = ({ onClose }) => {
  /* single-open: store the one open id (or null) */
  const [openId, setOpenId] = useState(null);
  const toggle = (id) => setOpenId(prev => prev === id ? null : id);

  return (
    <div
      style={{position:'fixed',inset:0,background:'rgba(0,0,0,0.5)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:50,padding:'0.75rem'}}
      onClick={onClose}
    >
      <div
        className="popup-inner"
        style={{background:'white',borderRadius:'0.75rem',boxShadow:'0 20px 50px rgba(0,0,0,0.3)',maxWidth:'28rem',width:'100%',display:'flex',flexDirection:'column',maxHeight:'92vh'}}
        onClick={e=>e.stopPropagation()}
      >
        {/* Header */}
        <div style={{padding:'1rem 1rem 0.6rem',borderBottom:'1px solid #f3f4f6',display:'flex',alignItems:'flex-start',justifyContent:'space-between',flexShrink:0}}>
          <div>
            <h3 style={{fontSize:'1.05rem',fontWeight:'700',color:'#111827',margin:0}}>How Are UW Partners Paid?</h3>
            <p style={{fontSize:'0.7rem',color:'#6b7280',marginTop:'0.2rem',marginBottom:0}}>We earn upfront for activity today â€” and ongoing income over time.</p>
          </div>
          <button onClick={onClose} style={{marginLeft:'0.75rem',width:'1.75rem',height:'1.75rem',borderRadius:'50%',background:'#f3f4f6',border:'none',cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',flexShrink:0}}>
            <X style={{...XS, color:'#4b5563'}} />
          </button>
        </div>

        {/* Accordion list â€” becomes 2-col in landscape via CSS */}
        <div className="accordion-list" style={{overflowY:'auto',flex:1,padding:'0.6rem',display:'flex',flexDirection:'column',gap:'0.4rem'}}>
          {sections.map(s => (
            <div key={s.id} style={{border:'1px solid #e5e7eb',borderRadius:'0.6rem',overflow:'hidden'}}>
              <button
                style={{width:'100%',display:'flex',alignItems:'center',gap:'0.6rem',padding:'0.6rem 0.75rem',textAlign:'left',background:'none',border:'none',cursor:'pointer'}}
                onClick={()=>toggle(s.id)}
              >
                <span style={{fontSize:'1.1rem',flexShrink:0}}>{s.icon}</span>
                <div style={{flex:1,minWidth:0}}>
                  <p style={{fontWeight:'600',fontSize:'0.825rem',color:'#111827',margin:'0 0 0.1rem 0'}}>{s.title}</p>
                  <p style={{fontSize:'0.7rem',color:'#6b7280',margin:0,lineHeight:'1.4',whiteSpace:'normal'}}>{s.summary}</p>
                </div>
                {openId === s.id
                  ? <ChevronUp style={{...SM, color:'#9ca3af'}} />
                  : <ChevronDown style={{...SM, color:'#9ca3af'}} />
                }
              </button>
              {openId === s.id && (
                <div style={{padding:'0.25rem 0.75rem 0.75rem',borderTop:'1px solid #f3f4f6',background:'#faf9ff'}}>
                  {s.detail}
                </div>
              )}
            </div>
          ))}
        </div>

        {/* Footer */}
        <div style={{padding:'0.5rem 1rem',flexShrink:0,borderTop:'1px solid #f3f4f6'}}>
          <p style={{fontSize:'0.65rem',color:'#9ca3af',textAlign:'center',margin:0}}>*QD = Qualified Distributor</p>
        </div>
      </div>
    </div>
  );
};

const UWTracker = () => {
  const [showCelebration, setShowCelebration] = useState(false);
  const [selectedCircle, setSelectedCircle] = useState(null);
  const [showPartnerPrompt, setShowPartnerPrompt] = useState(false);
  const [showResetConfirm, setShowResetConfirm] = useState(false);
  const [showInfoPopup, setShowInfoPopup] = useState(false);
  const [cardFlipped, setCardFlipped] = useState(false);
  const [includeYou, setIncludeYou] = useState(true);
  const previouslyQualified = useRef(false);

  const [customers, setCustomers] = useState([
    { type: 'own', services: 0, isPartner: false },
    { type: null, services: 0, isPartner: false },
    { type: null, services: 0, isPartner: false },
    { type: null, services: 0, isPartner: false },
    { type: null, services: 0, isPartner: false },
    { type: null, services: 0, isPartner: false }
  ]);

  const calculateCB = (customer, index) => {
    if (!includeYou && index === 0) {
      if (customer.type === 'homeowner') {
        if (customer.services === 1) return 50;
        if (customer.services === 2) return 100;
        if (customer.services === 3) return 250;
        if (customer.services === 4) return 300;
      }
      return 0;
    }
    if (customer.type === 'own' || customer.type === 'renting') return 0;
    if (customer.type === 'homeowner') {
      if (customer.services === 1) return 50;
      if (customer.services === 2) return 100;
      if (customer.services === 3) return 250;
      if (customer.services === 4) return 300;
    }
    return 0;
  };

  const highActivityCustomers = customers.filter((c, i) => {
    if (includeYou) return i > 0 && c.type === 'homeowner' && (c.services === 3 || c.services === 4);
    return c.type === 'homeowner' && (c.services === 3 || c.services === 4);
  }).length;
  const habPerCustomer = highActivityCustomers >= 4 ? 100 : highActivityCustomers >= 2 ? 50 : 0;
  const totalHAB = highActivityCustomers * habPerCustomer;
  const totalCB = customers.reduce((sum, c, i) => sum + calculateCB(c, i), 0);
  const hasPartner = customers.some((c, i) => includeYou ? i > 0 && c.isPartner : c.isPartner);
  const allCirclesFilled = customers.every(c => c.type !== null);
  const qualifiesForFastStart = allCirclesFilled && hasPartner;
  const fastStartBonus = qualifiesForFastStart ? 500 : 0;
  const grandTotal = totalCB + totalHAB + fastStartBonus;
  const tenantCount = customers.filter((c, i) => includeYou ? i > 0 && c.type === 'renting' : c.type === 'renting').length;
  const residualIncome = tenantCount * 2.5;
  const supportingBonus = Math.round(totalCB / 2);
  const partnerTotalEarnings = supportingBonus + 100 + 300;

  const getCircleOpacity = (index) => {
    if (index === 0 && includeYou) return 1;
    if (!includeYou) {
      for (let i = 0; i < index; i++) if (customers[i].type === null) return 0.3;
      return 1;
    }
    for (let i = 1; i < index; i++) if (customers[i].type === null) return 0.3;
    return 1;
  };

  const canSelectCircle = (index) => {
    if (index === 0 && includeYou) return false;
    if (!includeYou) {
      if (allCirclesFilled) return true;
      for (let i = 0; i < index; i++) if (customers[i].type === null) return false;
      return true;
    }
    if (allCirclesFilled) return true;
    for (let i = 1; i < index; i++) if (customers[i].type === null) return false;
    return true;
  };

  const handlePartnerBadgeClick = (e, index) => {
    e.stopPropagation();
    if ((index === 0 && includeYou) || customers[index].type === null) return;
    const wasQualified = qualifiesForFastStart;
    const nc = [...customers];
    nc[index] = {...nc[index], isPartner: !nc[index].isPartner};
    setCustomers(nc);
    const nowAllFilled = nc.every(c => c.type !== null);
    const nowHasPartner = nc.some((c, i) => includeYou ? i > 0 && c.isPartner : c.isPartner);
    const nowQualifies = nowAllFilled && nowHasPartner;
    if (!wasQualified && nowQualifies && !previouslyQualified.current) {
      previouslyQualified.current = true;
      setTimeout(() => { setShowCelebration(true); setTimeout(() => setShowCelebration(false), 3000); }, 200);
    }
    if (!nowQualifies) previouslyQualified.current = false;
    setShowPartnerPrompt(false);
  };

  const handleCircleClick = (index) => {
    if ((index === 0 && includeYou) || !canSelectCircle(index)) return;
    setSelectedCircle(index);
  };

  const setCustomerType = (type, services) => {
    if (selectedCircle === null) return;
    const wasQualified = qualifiesForFastStart;
    const nc = [...customers];
    nc[selectedCircle] = { type, services: services || 0, isPartner: nc[selectedCircle].isPartner };
    setCustomers(nc);
    setSelectedCircle(null);
    const nowAllFilled = nc.every(c => c.type !== null);
    const nowHasPartner = nc.some((c, i) => includeYou ? i > 0 && c.isPartner : c.isPartner);
    const nowQualifies = nowAllFilled && nowHasPartner;
    if (!wasQualified && nowQualifies && !previouslyQualified.current) {
      previouslyQualified.current = true;
      setTimeout(() => { setShowCelebration(true); setTimeout(() => setShowCelebration(false), 3000); }, 200);
    } else if (nowAllFilled && !nowHasPartner) {
      setShowPartnerPrompt(true);
    }
    if (!nowQualifies) previouslyQualified.current = false;
  };

  const removeCustomer = () => {
    if (selectedCircle === null) return;
    const nc = [...customers];
    nc[selectedCircle] = { type: null, services: 0, isPartner: false };
    setCustomers(nc);
    setSelectedCircle(null);
    previouslyQualified.current = false;
  };

  const resetTracking = () => {
    setCustomers([
      { type: includeYou ? 'own' : null, services: 0, isPartner: false },
      { type: null, services: 0, isPartner: false },
      { type: null, services: 0, isPartner: false },
      { type: null, services: 0, isPartner: false },
      { type: null, services: 0, isPartner: false },
      { type: null, services: 0, isPartner: false }
    ]);
    setSelectedCircle(null); setShowPartnerPrompt(false);
    setShowResetConfirm(false); setCardFlipped(false);
    previouslyQualified.current = false;
  };

  const toggleIncludeYou = () => {
    const niy = !includeYou;
    setIncludeYou(niy);
    const nc = [...customers];
    nc[0] = { type: niy ? 'own' : null, services: 0, isPartner: false };
    setCustomers(nc);
    setSelectedCircle(null);
    previouslyQualified.current = false;
  };

  const ordinal = (n) => n === 1 ? '1st' : n === 2 ? '2nd' : n === 3 ? '3rd' : `${n}th`;

  const circleColor = (c) => {
    if (c.type === null) return { border: '#d1d5db', text: '#9ca3af', bg: '#f9fafb' };
    if (c.type === 'own') return { border: '#9ca3af', text: '#374151', bg: '#f3f4f6' };
    if (c.type === 'renting') return { border: '#2563eb', text: '#1d4ed8', bg: '#eff6ff' };
    return { border: '#7c3aed', text: '#6d28d9', bg: '#f5f3ff' };
  };

  return (
    <div style={{minHeight:'100vh',background:'linear-gradient(135deg, #fdf2f8, #f5f3ff)',padding:'1rem'}}>
      {showCelebration && (
        <div style={{position:'fixed',inset:0,pointerEvents:'none',zIndex:50}}>
          {[...Array(50)].map((_, i) => (
            <div key={i} className="animate-confetti" style={{position:'absolute',left:`${Math.random()*100}%`,top:'-10%',animationDelay:`${Math.random()*0.5}s`,animationDuration:`${2+Math.random()}s`}}>
              <div style={{color:'#facc15',fontSize:`${Math.random()*20+10}px`,transform:`rotate(${Math.random()*360}deg)`}}>âœ¨</div>
            </div>
          ))}
        </div>
      )}

      <div style={{maxWidth:'42rem',margin:'0 auto'}}>
        <div style={{marginBottom:'1.5rem'}}>
          <h1 style={{fontSize:'1.5rem',fontWeight:'700',color:'#1f2937',marginBottom:'0.5rem',textAlign:'center'}}>UW Partner Earnings Tool</h1>
          <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',gap:'1rem'}}>
            <div style={{display:'flex',alignItems:'center',gap:'0.5rem'}}>
              <button onClick={toggleIncludeYou} style={{position:'relative',display:'inline-flex',height:'1.5rem',width:'2.75rem',alignItems:'center',borderRadius:'9999px',border:'none',cursor:'pointer',background:includeYou?'#22c55e':'#d1d5db',transition:'background 0.2s'}}>
                <span style={{display:'inline-block',height:'1rem',width:'1rem',transform:includeYou?'translateX(1.5rem)':'translateX(0.25rem)',borderRadius:'50%',background:'white',transition:'transform 0.2s',boxShadow:'0 1px 3px rgba(0,0,0,0.2)'}}></span>
              </button>
              <span style={{fontSize:'0.875rem',fontWeight:'600',color:'#374151'}}>You</span>
            </div>
            <p style={{fontSize:'0.875rem',color:'#6b7280',flex:1,textAlign:'center'}}>
              Explore what <strong>{includeYou ? 'five' : 'six'}</strong> customers could earn you in the first 30 days
            </p>
            <div style={{width:'5rem'}}></div>
          </div>
        </div>

        <div style={{background:'white',borderRadius:'1rem',boxShadow:'0 4px 16px rgba(0,0,0,0.08)',padding:'1.5rem'}}>
          <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:'1rem',marginBottom:'1rem'}}>
            {customers.map((customer, index) => {
              const col = circleColor(customer);
              const cb = calculateCB(customer, index);
              const showHAB = customer.type === 'homeowner' && (customer.services === 3 || customer.services === 4) && highActivityCustomers >= 2;
              return (
                <div key={index} style={{display:'flex',flexDirection:'column',alignItems:'center',position:'relative'}}>
                  <div
                    onClick={() => handleCircleClick(index)}
                    style={{width:'5rem',height:'5rem',borderRadius:'50%',border:`4px solid ${col.border}`,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',fontSize:'1.125rem',fontWeight:'700',position:'relative',background:col.bg,color:col.text,cursor:canSelectCircle(index)?'pointer':'not-allowed',opacity:getCircleOpacity(index),transition:'transform 0.15s',boxSizing:'border-box'}}
                  >
                    {(index === 0 && includeYou) ? (
                      <span style={{fontSize:'1rem',fontWeight:'700'}}>You</span>
                    ) : customer.type ? (
                      <>
                        <span style={{fontSize:'0.875rem',fontWeight:'700'}}>Â£{cb.toLocaleString()}</span>
                        {showHAB && (
                          <div style={{position:'absolute',top:'-0.25rem',right:'-0.25rem',padding:'0.125rem 0.25rem',background:'#f97316',color:'white',fontSize:'0.625rem',fontWeight:'700',borderRadius:'0.25rem',zIndex:10}}>+Â£{habPerCustomer}</div>
                        )}
                        <div
                          onClick={(e) => handlePartnerBadgeClick(e, index)}
                          style={{position:'absolute',bottom:'-0.25rem',right:'-0.25rem',width:'1.5rem',height:'1.5rem',borderRadius:'50%',border:`2px solid ${customer.isPartner?'#ca8a04':'#9ca3af'}`,display:'flex',alignItems:'center',justifyContent:'center',zIndex:10,cursor:'pointer',background:customer.isPartner?'#facc15':'#e5e7eb',transition:'transform 0.15s'}}
                        >
                          <span style={{fontSize:'0.625rem',fontWeight:'700',color:customer.isPartner?'#713f12':'#6b7280'}}>P</span>
                        </div>
                      </>
                    ) : (
                      <>
                        <span style={{fontSize:'0.875rem'}}>{includeYou ? ordinal(index) : ordinal(index+1)}</span>
                        <div style={{position:'absolute',bottom:'-0.25rem',right:'-0.25rem',width:'1.5rem',height:'1.5rem',borderRadius:'50%',border:'2px solid #9ca3af',display:'flex',alignItems:'center',justifyContent:'center',zIndex:10,background:'#e5e7eb'}}>
                          <span style={{fontSize:'0.625rem',fontWeight:'700',color:'#6b7280'}}>P</span>
                        </div>
                      </>
                    )}
                  </div>
                </div>
              );
            })}
          </div>

          {showPartnerPrompt && allCirclesFilled && !hasPartner && (
            <div style={{marginBottom:'1rem',padding:'1rem',background:'linear-gradient(to right,#facc15,#f59e0b)',borderRadius:'0.5rem',boxShadow:'0 2px 8px rgba(0,0,0,0.1)'}}>
              <div style={{display:'flex',alignItems:'center',justifyContent:'center',gap:'0.75rem',flexWrap:'wrap'}}>
                <span style={{fontSize:'0.875rem',fontWeight:'700',color:'#713f12'}}>Press above to upgrade one customer to Partner:</span>
                <div style={{display:'flex',alignItems:'center',gap:'0.5rem'}}>
                  <div style={{width:'1.5rem',height:'1.5rem',borderRadius:'50%',background:'#e5e7eb',border:'2px solid #9ca3af',display:'flex',alignItems:'center',justifyContent:'center'}}><span style={{fontSize:'0.625rem',fontWeight:'700',color:'#6b7280'}}>P</span></div>
                  <span style={{fontSize:'1.25rem'}}>â†’</span>
                  <div style={{width:'1.5rem',height:'1.5rem',borderRadius:'50%',background:'#facc15',border:'2px solid #ca8a04',display:'flex',alignItems:'center',justifyContent:'center'}}><span style={{fontSize:'0.625rem',fontWeight:'700',color:'#713f12'}}>P</span></div>
                </div>
              </div>
            </div>
          )}

          <div style={{display:'flex',flexDirection:'column',gap:'0.75rem'}}>
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'0.75rem 1rem',borderRadius:'0.5rem',border:`4px solid ${totalCB>0?'#7c3aed':'#d1d5db'}`,background:totalCB>0?'#f5f3ff':'#f9fafb'}}>
              <div style={{display:'flex',alignItems:'center',gap:'0.5rem'}}>
                <span style={{fontSize:'1.25rem',filter:totalCB>0?'none':'grayscale(1)',opacity:totalCB>0?1:0.4}}>ğŸ’·</span>
                <span style={{fontWeight:'600',color:totalCB>0?'#7c3aed':'#4b5563'}}>Customer Bonus:</span>
              </div>
              <span style={{fontSize:'1.25rem',fontWeight:'700',color:totalCB>0?'#6d28d9':'#9ca3af'}}>Â£{totalCB.toLocaleString()}</span>
            </div>

            {highActivityCustomers >= 2 && (
              <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'0.75rem 1rem',borderRadius:'0.5rem',border:'4px solid #f97316',background:'#fff7ed'}}>
                <div style={{display:'flex',alignItems:'center',gap:'0.5rem'}}>
                  <span style={{fontSize:'1.25rem'}}>ğŸ”¥</span>
                  <span style={{fontWeight:'600',color:'#ea580c'}}>High Activity Bonus:</span>
                </div>
                <span style={{fontSize:'1.25rem',fontWeight:'700',color:'#ea580c'}}>Â£{totalHAB.toLocaleString()}</span>
              </div>
            )}

            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'0.75rem 1rem',borderRadius:'0.5rem',border:`2px solid ${qualifiesForFastStart?'#86efac':'#e5e7eb'}`,background:qualifiesForFastStart?'#f0fdf4':'#f9fafb'}}>
              <div style={{display:'flex',alignItems:'center',gap:'0.5rem'}}>
                <TrendingUp style={{...MD, color:qualifiesForFastStart?'#16a34a':'#9ca3af'}} />
                <span style={{fontWeight:'600',color:qualifiesForFastStart?'#16a34a':'#374151'}}>Fast Start Bonus:</span>
              </div>
              <span style={{fontSize:'1.25rem',fontWeight:'700',color:qualifiesForFastStart?'#16a34a':'#9ca3af'}}>Â£{fastStartBonus.toLocaleString()}</span>
            </div>

            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'1rem',borderRadius:'0.5rem',boxShadow:'0 2px 8px rgba(0,0,0,0.15)',color:'white',position:'relative',overflow:'hidden'}}>
              <div style={{position:'absolute',inset:0,background:grandTotal>0?'linear-gradient(to right,#7c3aed,#db2777)':'#9ca3af'}}></div>
              <div style={{display:'flex',alignItems:'center',gap:'0.5rem',position:'relative',zIndex:1}}>
                <span style={{fontWeight:'700',fontSize:'1.125rem'}}>TOTAL EARNINGS:</span>
                <button onClick={(e) => { e.stopPropagation(); setShowInfoPopup(true); }} style={{width:'1.5rem',height:'1.5rem',borderRadius:'50%',background:'rgba(255,255,255,0.3)',border:'none',cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',padding:0}}>
                  <Info style={{...XS, color:'white'}} />
                </button>
              </div>
              <span style={{fontSize:'1.5rem',fontWeight:'700',position:'relative',zIndex:1}}>Â£{grandTotal.toLocaleString()}</span>
            </div>

            {tenantCount > 0 && (
              <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'0.75rem 1rem',borderRadius:'0.5rem',border:'4px solid #2563eb',background:'#eff6ff'}}>
                <div style={{display:'flex',alignItems:'center',gap:'0.5rem'}}>
                  <RefreshCw style={{...MD, color:'#2563eb'}} />
                  <span style={{fontWeight:'600',color:'#374151'}}>Recurring Income:</span>
                </div>
                <div style={{textAlign:'right'}}>
                  <span style={{fontSize:'1.25rem',fontWeight:'700',color:'#2563eb'}}>Â£{residualIncome.toFixed(2)}/m</span>
                  <span style={{display:'block',fontSize:'0.75rem',color:'#3b82f6'}}>(Â£{(residualIncome*12).toLocaleString()}/yr)</span>
                </div>
              </div>
            )}

            <div
              onClick={() => qualifiesForFastStart && setCardFlipped(!cardFlipped)}
              style={{borderRadius:'0.75rem',border:`2px solid ${qualifiesForFastStart?'#a78bfa':'#e5e7eb'}`,overflow:'hidden',cursor:qualifiesForFastStart?'pointer':'not-allowed'}}
            >
              {!cardFlipped ? (
                <div style={{padding:'1rem',background:qualifiesForFastStart?'linear-gradient(to right,#7c3aed,#db2777)':'#f3f4f6'}}>
                  <div style={{display:'flex',alignItems:'center',gap:'0.5rem',marginBottom:'0.75rem'}}>
                    {qualifiesForFastStart
                      ? <span style={{fontSize:'1.125rem',lineHeight:1}}>ğŸ”“</span>
                      : <Lock style={{...SM, color:'#9ca3af'}} />
                    }
                    <span style={{fontWeight:'700',fontSize:'1rem',color:qualifiesForFastStart?'white':'#9ca3af'}}>New Revenue Streams Unlocked</span>
                  </div>
                  <div style={{fontSize:'0.875rem',color:qualifiesForFastStart?'#fbcfe8':'#9ca3af',display:'flex',flexDirection:'column',gap:'0.25rem'}}>
                    <div style={{display:'flex',alignItems:'center',gap:'0.5rem'}}><span>ğŸ¤</span><span>Supporting Bonuses</span></div>
                    <div style={{display:'flex',alignItems:'center',gap:'0.5rem'}}><span>ğŸ“</span><span>Mentoring Bonus</span></div>
                    <div style={{display:'flex',alignItems:'center',gap:'0.5rem'}}>
                      <TrendingUp style={{...SM, color:qualifiesForFastStart?'#fbcfe8':'#9ca3af'}} />
                      <span>Fast Start Mentoring Bonus</span>
                    </div>
                  </div>
                  {qualifiesForFastStart && <p style={{fontSize:'0.75rem',color:'#fbcfe8',fontStyle:'italic',textAlign:'center',marginTop:'0.75rem',marginBottom:0}}>Tap to see worked example</p>}
                </div>
              ) : (
                <div style={{padding:'1rem',background:'linear-gradient(to right,#7c3aed,#db2777)'}}>
                  <p style={{color:'white',fontWeight:'700',fontSize:'0.875rem',marginBottom:'0.25rem',marginTop:0}}>ğŸ”“ New Revenue Streams Unlocked â€” Worked Example</p>
                  <p style={{color:'#fbcfe8',fontSize:'0.75rem',marginBottom:'0.75rem'}}>For each Partner you recruit and support to their QD* Fast Start Bonus:</p>
                  <div style={{background:'rgba(255,255,255,0.15)',borderRadius:'0.5rem',padding:'0.75rem',marginBottom:'0.75rem'}}>
                    <div style={{display:'flex',justifyContent:'space-between',color:'white',fontSize:'0.875rem',marginBottom:'0.25rem'}}>
                      <span>They earn (just like you, above)</span>
                      <span style={{fontWeight:'700'}}>Â£{grandTotal.toLocaleString()}</span>
                    </div>
                    <div style={{borderTop:'1px solid rgba(255,255,255,0.3)',paddingTop:'0.25rem',display:'flex',justifyContent:'space-between',fontSize:'0.875rem'}}>
                      <span style={{color:'#fbcfe8'}}>You earn (in this example)</span>
                      <span style={{fontWeight:'700',color:'#fde68a'}}>Â£{partnerTotalEarnings.toLocaleString()}</span>
                    </div>
                  </div>
                  <p style={{color:'white',fontSize:'0.75rem',fontWeight:'600',marginBottom:'0.25rem'}}>Made up of:</p>
                  {[
                    {icon:'ğŸ¤',label:'Supporting Bonuses',val:supportingBonus},
                    {icon:'ğŸ“',label:'Mentoring Bonus',val:100},
                    {icon:null,label:'Fast Start Mentoring',val:300},
                  ].map(r => (
                    <div key={r.label} style={{display:'flex',justifyContent:'space-between',alignItems:'center',fontSize:'0.875rem',background:'rgba(255,255,255,0.1)',borderRadius:'0.25rem',padding:'0.25rem 0.5rem',marginBottom:'0.25rem'}}>
                      <span style={{display:'flex',alignItems:'center',gap:'0.375rem',color:'#fbcfe8'}}>
                        {r.icon
                          ? <span>{r.icon}</span>
                          : <TrendingUp style={{...XS, color:'#fbcfe8'}} />
                        }
                        {r.label}
                      </span>
                      <span style={{color:'white',fontWeight:'700'}}>Â£{r.val.toLocaleString()}</span>
                    </div>
                  ))}
                  <p style={{fontSize:'0.75rem',color:'#fbcfe8',fontStyle:'italic',textAlign:'center',marginTop:'0.5rem',marginBottom:0}}>Tap to flip back</p>
                </div>
              )}
            </div>
          </div>
        </div>

        <div style={{marginTop:'1rem'}}>
          <button onClick={() => setShowResetConfirm(true)} style={{width:'100%',padding:'0.75rem',background:'#e5e7eb',border:'none',borderRadius:'0.5rem',fontWeight:'600',color:'#374151',cursor:'pointer',fontSize:'1rem'}}>Reset Tracker</button>
        </div>
      </div>

      {showInfoPopup && <HowPaidPopup onClose={() => setShowInfoPopup(false)} />}

      {selectedCircle !== null && (
        <div style={{position:'fixed',inset:0,background:'rgba(0,0,0,0.3)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:50,padding:'1rem'}} onClick={() => setSelectedCircle(null)}>
          <div className="animate-slideDown" style={{background:'white',borderRadius:'0.75rem',padding:'1.5rem',boxShadow:'0 20px 50px rgba(0,0,0,0.3)',maxWidth:'24rem',width:'100%'}} onClick={e => e.stopPropagation()}>
            <p style={{fontSize:'0.875rem',fontWeight:'600',color:'#111827',marginBottom:'1rem',textAlign:'center'}}>
              {includeYou ? `Customer ${selectedCircle}` : `Customer ${selectedCircle+1}`}: Homeowner with how many services?
            </p>
            <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:'0.5rem',marginBottom:'0.75rem'}}>
              {[1,2,3,4].map(num => {
                const cb = [50,100,250,300][num-1];
                const active = customers[selectedCircle] && customers[selectedCircle].type === 'homeowner' && customers[selectedCircle].services === num;
                return (
                  <button key={num} onClick={() => setCustomerType('homeowner', num)} style={{padding:'1rem 0.5rem',border:`2px solid ${active?'#7c3aed':'#c4b5fd'}`,borderRadius:'0.5rem',background:active?'#7c3aed':'#f5f3ff',color:active?'white':'#6d28d9',cursor:'pointer',fontWeight:'600'}}>
                    <div style={{fontSize:'1rem',fontWeight:'700'}}>{num}</div>
                    <div style={{fontSize:'0.75rem',marginTop:'0.25rem'}}>(Â£{cb})</div>
                  </button>
                );
              })}
            </div>
            <p style={{textAlign:'center',fontSize:'0.875rem',color:'#6b7280',marginBottom:'0.75rem'}}>or</p>
            <button onClick={() => setCustomerType('renting')} style={{width:'100%',padding:'0.75rem',border:`2px solid ${customers[selectedCircle]&&customers[selectedCircle].type==='renting'?'#2563eb':'#93c5fd'}`,borderRadius:'0.5rem',background:customers[selectedCircle]&&customers[selectedCircle].type==='renting'?'#2563eb':'#eff6ff',color:customers[selectedCircle]&&customers[selectedCircle].type==='renting'?'white':'#1d4ed8',cursor:'pointer',fontWeight:'600',marginBottom:'0.75rem'}}>
              <div style={{fontSize:'1rem',fontWeight:'700'}}>Tenant/Renting</div>
              <div style={{fontSize:'0.75rem',fontWeight:'400'}}>(No customer bonus, just recurring income)</div>
            </button>
            {customers[selectedCircle] && customers[selectedCircle].type !== null && (
              <button onClick={removeCustomer} style={{width:'100%',padding:'0.75rem',border:'2px solid #fca5a5',borderRadius:'0.5rem',background:'#fef2f2',color:'#b91c1c',cursor:'pointer',fontWeight:'600'}}>Remove Customer</button>
            )}
          </div>
        </div>
      )}

      {showResetConfirm && (
        <div style={{position:'fixed',inset:0,background:'rgba(0,0,0,0.3)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:50,padding:'1rem'}}>
          <div className="animate-slideDown" style={{background:'white',borderRadius:'0.75rem',padding:'1.5rem',boxShadow:'0 20px 50px rgba(0,0,0,0.3)',maxWidth:'24rem',width:'100%'}}>
            <p style={{fontSize:'1.125rem',fontWeight:'600',color:'#111827',marginBottom:'1rem',textAlign:'center'}}>Are you sure?</p>
            <p style={{fontSize:'0.875rem',color:'#6b7280',marginBottom:'1.5rem',textAlign:'center'}}>This will reset all customer data and cannot be undone.</p>
            <div style={{display:'flex',gap:'0.75rem'}}>
              <button onClick={() => setShowResetConfirm(false)} style={{flex:1,padding:'0.5rem',background:'#e5e7eb',border:'none',borderRadius:'0.5rem',fontWeight:'600',color:'#374151',cursor:'pointer'}}>No</button>
              <button onClick={resetTracking} style={{flex:1,padding:'0.5rem',background:'#ef4444',border:'none',borderRadius:'0.5rem',fontWeight:'600',color:'white',cursor:'pointer'}}>Yes, Reset</button>
            </div>
          </div>
        </div>
      )}

      {showCelebration && (
        <div style={{position:'fixed',inset:0,background:'rgba(0,0,0,0.5)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:40,padding:'1rem'}}>
          <div className="animate-bounceOnce" style={{background:'white',borderRadius:'1rem',padding:'2rem',maxWidth:'28rem',textAlign:'center'}}>
            <div style={{fontSize:'3.75rem',marginBottom:'1rem'}}>ğŸ‰</div>
            <h2 style={{fontSize:'1.875rem',fontWeight:'700',color:'#7c3aed',marginBottom:'1rem'}}>Congratulations!</h2>
            <p style={{fontSize:'1.25rem',color:'#374151',marginBottom:'0.5rem'}}>You've qualified for the</p>
            <p style={{fontSize:'2.25rem',fontWeight:'700',color:'#16a34a',marginBottom:'1rem'}}>Â£500 Fast Start Bonus!</p>
          </div>
        </div>
      )}
    </div>
  );
};

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(React.createElement(UWTracker));
</script>
</body>
</html>
